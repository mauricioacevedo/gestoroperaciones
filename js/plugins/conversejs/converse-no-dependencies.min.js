/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */

/**
 * @license text 2.0.15 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/text/LICENSE
 */

// RequireJS UnderscoreJS template plugin
// http://github.com/jfparadis/requirejs-tpl
//
// An alternative to http://github.com/ZeeAgency/requirejs-tpl
//
// Using UnderscoreJS micro-templates at http://underscorejs.org/#template
// Using and RequireJS text.js at http://requirejs.org/docs/api.html#text
// @author JF Paradis
// @version 0.0.2
//
// Released under the MIT license
//
// Usage:
//   require(['backbone', 'tpl!mytemplate'], function (Backbone, mytemplate) {
//     return Backbone.View.extend({
//       initialize: function(){
//         this.render();
//       },
//       render: function(){
//         this.$el.html(mytemplate({message: 'hello'}));
//     });
//   });
//
// Configuration: (optional)
//   require.config({
//     tpl: {
//       extension: '.tpl' // default = '.html'
//     }
//   });

// Converse.js (A browser based XMPP chat client)
// http://conversejs.org
//
// Copyright (c) 2012-2016, Jan-Carel Brand <jc@opkode.com>
// Licensed under the Mozilla Public License (MPLv2)
//

/*
jed.js
v0.5.0beta

https://github.com/SlexAxton/Jed
-----------
A gettext compatible i18n library for modern JavaScript Applications

by Alex Sexton - AlexSexton [at] gmail - @SlexAxton
WTFPL license for use
Dojo CLA for contributions

Jed offers the entire applicable GNU gettext spec'd set of
functions, but also offers some nicer wrappers around them.
The api for gettext was written for a language with no function
overloading, so Jed allows a little more of that.

Many thanks to Joshua I. Miller - unrtst@cpan.org - who wrote
gettext.js back in 2008. I was able to vet a lot of my ideas
against his. I also made sure Jed passed against his tests
in order to offer easy upgrades -- jsgettext.berlios.de
*/

// Underscore 1.3.0 was used to port and is licensed

/**
   sprintf() for JavaScript 0.7-beta1
   http://www.diveintojavascript.com/projects/javascript-sprintf

   Copyright (c) Alexandru Marasteanu <alexaholic [at) gmail (dot] com>
   All rights reserved.

   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions are met:
       * Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.
       * Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in the
         documentation and/or other materials provided with the distribution.
       * Neither the name of sprintf() for JavaScript nor the
         names of its contributors may be used to endorse or promote products
         derived from this software without specific prior written permission.

   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
   ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
   WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   DISCLAIMED. IN NO EVENT SHALL Alexandru Marasteanu BE LIABLE FOR ANY
   DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
   (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
   LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
   ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  */

var requirejs,require,define;!function(e){function t(e,t){return v.call(e,t)}function n(e,t){var n,i,o,s,a,r,l,c,d,u,h,p,_=t&&t.split("/"),m=f.map,g=m&&m["*"]||{};if(e){for(e=e.split("/"),a=e.length-1,f.nodeIdCompat&&y.test(e[a])&&(e[a]=e[a].replace(y,"")),"."===e[0].charAt(0)&&_&&(p=_.slice(0,_.length-1),e=p.concat(e)),d=0;d<e.length;d++)if(h=e[d],"."===h)e.splice(d,1),d-=1;else if(".."===h){if(0===d||1===d&&".."===e[2]||".."===e[d-1])continue;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}if((_||g)&&m){for(n=e.split("/"),d=n.length;d>0;d-=1){if(i=n.slice(0,d).join("/"),_)for(u=_.length;u>0;u-=1)if(o=m[_.slice(0,u).join("/")],o&&(o=o[i])){s=o,r=d;break}if(s)break;!l&&g&&g[i]&&(l=g[i],c=d)}!s&&l&&(s=l,r=c),s&&(n.splice(0,r,s),e=n.join("/"))}return e}function i(t,n){return function(){var i=b.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),u.apply(e,i.concat([t,n]))}}function o(e){return function(t){return n(t,e)}}function s(e){return function(t){_[e]=t}}function a(n){if(t(m,n)){var i=m[n];delete m[n],g[n]=!0,d.apply(e,i)}if(!t(_,n)&&!t(g,n))throw new Error("No "+n);return _[n]}function r(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function l(e){return e?r(e):[]}function c(e){return function(){return f&&f.config&&f.config[e]||{}}}var d,u,h,p,_={},m={},f={},g={},v=Object.prototype.hasOwnProperty,b=[].slice,y=/\.js$/;h=function(e,t){var i,s=r(e),l=s[0],c=t[1];return e=s[1],l&&(l=n(l,c),i=a(l)),l?e=i&&i.normalize?i.normalize(e,o(c)):n(e,c):(e=n(e,c),s=r(e),l=s[0],e=s[1],l&&(i=a(l))),{f:l?l+"!"+e:e,n:e,pr:l,p:i}},p={require:function(e){return i(e)},exports:function(e){var t=_[e];return"undefined"!=typeof t?t:_[e]={}},module:function(e){return{id:e,uri:"",exports:_[e],config:c(e)}}},d=function(n,o,r,c){var d,u,f,v,b,y,w,x=[],C=typeof r;if(c=c||n,y=l(c),"undefined"===C||"function"===C){for(o=!o.length&&r.length?["require","exports","module"]:o,b=0;b<o.length;b+=1)if(v=h(o[b],y),u=v.f,"require"===u)x[b]=p.require(n);else if("exports"===u)x[b]=p.exports(n),w=!0;else if("module"===u)d=x[b]=p.module(n);else if(t(_,u)||t(m,u)||t(g,u))x[b]=a(u);else{if(!v.p)throw new Error(n+" missing "+u);v.p.load(v.n,i(c,!0),s(u),{}),x[b]=_[u]}f=r?r.apply(_[n],x):void 0,n&&(d&&d.exports!==e&&d.exports!==_[n]?_[n]=d.exports:f===e&&w||(_[n]=f))}else n&&(_[n]=r)},requirejs=require=u=function(t,n,i,o,s){if("string"==typeof t)return p[t]?p[t](n):a(h(t,l(n)).f);if(!t.splice){if(f=t,f.deps&&u(f.deps,f.callback),!n)return;n.splice?(t=n,n=i,i=null):t=e}return n=n||function(){},"function"==typeof i&&(i=o,o=s),o?d(e,t,n,i):setTimeout(function(){d(e,t,n,i)},4),u},u.config=function(e){return u(e)},requirejs._defined=_,define=function(e,n,i){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");n.splice||(i=n,n=[]),t(_,e)||t(m,e)||(m[e]=[e,n,i])},define.amd={jQuery:!0}}(),define("almond",function(){}),define("text",["module"],function(e){"use strict";function t(e,t){return void 0===e||""===e?t:e}function n(e,n,i,o){if(n===o)return!0;if(e===i){if("http"===e)return t(n,"80")===t(o,"80");if("https"===e)return t(n,"443")===t(o,"443")}return!1}var i,o,s,a,r,l=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],c=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,d=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,u="undefined"!=typeof location&&location.href,h=u&&location.protocol&&location.protocol.replace(/\:/,""),p=u&&location.hostname,_=u&&(location.port||void 0),m={},f=e.config&&e.config()||{};return i={version:"2.0.15",strip:function(e){if(e){e=e.replace(c,"");var t=e.match(d);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){n=l[t];try{e=new ActiveXObject(n)}catch(e){}if(e){l=[n];break}}return e},parseName:function(e){var t,n,i,o=!1,s=e.lastIndexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return s!==-1&&(!a||s>1)?(t=e.substring(0,s),n=e.substring(s+1)):t=e,i=n||t,s=i.indexOf("!"),s!==-1&&(o="strip"===i.substring(s+1),i=i.substring(0,s),n?n=i:t=i),{moduleName:t,ext:n,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,o,s){var a,r,l,c=i.xdRegExp.exec(e);return!c||(a=c[2],r=c[3],r=r.split(":"),l=r[1],r=r[0],(!a||a===t)&&(!r||r.toLowerCase()===o.toLowerCase())&&(!l&&!r||n(a,l,t,s)))},finishLoad:function(e,t,n,o){n=t?i.strip(n):n,f.isBuild&&(m[e]=n),o(n)},load:function(e,t,n,o){if(o&&o.isBuild&&!o.inlineText)return void n();f.isBuild=o&&o.isBuild;var s=i.parseName(e),a=s.moduleName+(s.ext?"."+s.ext:""),r=t.toUrl(a),l=f.useXhr||i.useXhr;return 0===r.indexOf("empty:")?void n():void(!u||l(r,h,p,_)?i.get(r,function(t){i.finishLoad(e,s.strip,t,n)},function(e){n.error&&n.error(e)}):t([a],function(e){i.finishLoad(s.moduleName+"."+s.ext,s.strip,e,n)}))},write:function(e,t,n,o){if(m.hasOwnProperty(t)){var s=i.jsEscape(m[t]);n.asModule(e+"!"+t,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,t,n,o,s){var a=i.parseName(t),r=a.ext?"."+a.ext:"",l=a.moduleName+r,c=n.toUrl(a.moduleName+r)+".js";i.load(l,n,function(t){var n=function(e){return o(c,e)};n.asModule=function(e,t){return o.asModule(e,c,t)},i.write(e,l,n,s)},s)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(o=require.nodeRequire("fs"),i.get=function(e,t,n){try{var i=o.readFileSync(e,"utf8");"\ufeff"===i[0]&&(i=i.substring(1)),t(i)}catch(e){n&&n(e)}}):"xhr"===f.env||!f.env&&i.createXhr()?i.get=function(e,t,n,o){var s,a=i.createXhr();if(a.open("GET",e,!0),o)for(s in o)o.hasOwnProperty(s)&&a.setRequestHeader(s.toLowerCase(),o[s]);f.onXhr&&f.onXhr(a,e),a.onreadystatechange=function(i){var o,s;4===a.readyState&&(o=a.status||0,o>399&&o<600?(s=new Error(e+" HTTP status: "+o),s.xhr=a,n&&n(s)):t(a.responseText),f.onXhrComplete&&f.onXhrComplete(a,e))},a.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?i.get=function(e,t){var n,i,o="utf-8",s=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),r=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),o)),l="";try{for(n=new java.lang.StringBuffer,i=r.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=r.readLine());)n.append(a),n.append(i);l=String(n.toString())}finally{r.close()}t(l)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(s=Components.classes,a=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),r="@mozilla.org/windows-registry-key;1"in s,i.get=function(e,t){var n,i,o,l={};r&&(e=e.replace(/\//g,"\\")),o=new FileUtils.File(e);try{n=s["@mozilla.org/network/file-input-stream;1"].createInstance(a.nsIFileInputStream),n.init(o,1,0,!1),i=s["@mozilla.org/intl/converter-input-stream;1"].createInstance(a.nsIConverterInputStream),i.init(n,"utf-8",n.available(),a.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),i.readString(n.available(),l),i.close(),n.close(),t(l.value)}catch(e){throw new Error((o&&o.path||"")+": "+e)}}),i}),define("tpl",["text","underscore"],function(e,t){"use strict";var n={},i="define('{pluginName}!{moduleName}', function () { return {source}; });\n";return{version:"0.0.2",load:function(i,o,s,a){if(a.tpl&&a.tpl.templateSettings&&(t.templateSettings=a.tpl.templateSettings),n[i])s(n[i]);else{var r=a.tpl&&!t.isUndefined(a.tpl.extension)?a.tpl.extension:".html",l=a.tpl&&a.tpl.path||"";e.load(l+i+r,o,function(e){n[i]=t.template(e),s(n[i])},a)}},write:function(e,t,o){var s=n[t],a=s&&s.source;a&&o.asModule(e+"!"+t,i.replace("{pluginName}",e).replace("{moduleName}",t).replace("{source}",a))}}}),define("tpl!field",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<field var="'+(null==(__t=name)?"":__t)+'">',_.isArray(value)?(__p+="\n    ",_.each(value,function(e){__p+="<value>"+(null==(__t=e)?"":__t)+"</value>"}),__p+="\n"):__p+="\n    <value>"+(null==(__t=value)?"":__t)+"</value>\n",__p+="</field>\n";return __p}}),define("tpl!select_option",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<option value="'+(null==(__t=value)?"":__t)+'" ',selected&&(__p+=' selected="selected" '),__p+=" >"+(null==(__t=label)?"":__t)+"</option>\n";return __p}}),define("tpl!form_select",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<label>"+(null==(__t=label)?"":__t)+'</label>\n<select name="'+(null==(__t=name)?"":__t)+'"  ',multiple&&(__p+=' multiple="multiple" '),__p+=">"+(null==(__t=options)?"":__t)+"</select>\n";return __p}}),define("tpl!form_textarea",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<label class="label-ta">'+(null==(__t=label)?"":__t)+'</label>\n<textarea name="'+(null==(__t=name)?"":__t)+'">'+(null==(__t=value)?"":__t)+"</textarea>\n";return __p}}),define("tpl!form_checkbox",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<label>"+(null==(__t=label)?"":__t)+'</label>\n<input name="'+(null==(__t=name)?"":__t)+'" type="'+(null==(__t=type)?"":__t)+'" '+(null==(__t=checked)?"":__t)+">\n";return __p}}),define("tpl!form_username",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",label&&(__p+="\n<label>\n    "+(null==(__t=label)?"":__t)+"\n</label>\n"),__p+='\n<div class="input-group">\n    <input name="'+(null==(__t=name)?"":__t)+'" type="'+(null==(__t=type)?"":__t)+'"\n        ',value&&(__p+=' value="'+(null==(__t=value)?"":__t)+'" '),__p+="\n        ",required&&(__p+=' class="required" '),__p+=' />\n    <span title="'+(null==(__t=domain)?"":__t)+'">'+(null==(__t=domain)?"":__t)+"</span>\n</div>\n";return __p}}),define("tpl!form_input",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",label&&(__p+="\n<label>\n    "+(null==(__t=label)?"":__t)+"\n</label>\n"),__p+='\n<input name="'+(null==(__t=name)?"":__t)+'" type="'+(null==(__t=type)?"":__t)+'" \n    ',value&&(__p+=' value="'+(null==(__t=value)?"":__t)+'" '),__p+="\n    ",required&&(__p+=' class="required" '),__p+=" >\n";return __p}}),define("tpl!form_captcha",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",label&&(__p+="\n<label>\n    "+(null==(__t=label)?"":__t)+"\n</label>\n"),__p+='\n<img src="data:'+(null==(__t=type)?"":__t)+";base64,"+(null==(__t=data)?"":__t)+'">\n<input name="'+(null==(__t=name)?"":__t)+'" type="text" ',required&&(__p+=' class="required" '),__p+=" >\n\n\n";return __p}}),function(e,t){define("utils",["jquery","jquery.browser","underscore","tpl!field","tpl!select_option","tpl!form_select","tpl!form_textarea","tpl!form_checkbox","tpl!form_username","tpl!form_input","tpl!form_captcha"],t)}(this,function(e,t,n,i,o,s,a,r,l,c,d){"use strict";var u={"text-private":"password","text-single":"text",fixed:"label",boolean:"checkbox",hidden:"hidden","jid-multi":"textarea","list-single":"dropdown","list-multi":"dropdown"},h=function(t){var n=new e.Deferred;return e("<img>",{src:t,error:n.reject,load:n.resolve}),n.promise()};e.expr[":"].emptyVal=function(e){return""===e.value},e.fn.hasScrollBar=function(){return!!e.contains(document,this.get(0))&&this.parent().height()<this.get(0).scrollHeight},e.fn.throttledHTML=n.throttle(e.fn.html,500),e.fn.addHyperlinks=function(){return this.length>0&&this.each(function(t,i){var o,s,a=e(i),r=a.html(),l=r.match(/\b(https?:\/\/|www\.|https?:\/\/www\.)[^\s<]{2,200}\b/g);if(l)for(t=0;t<l.length;t++)o=0===l[t].indexOf("http://")||0===l[t].indexOf("https://")?"":"http://",s=encodeURI(decodeURI(l[t])).replace(/[!'()]/g,escape).replace(/\*/g,"%2A"),r=r.replace(l[t],'<a target="_blank" rel="noopener" href="'+o+s+'">'+l[t]+"</a>");a.html(r),n.each(l,function(e){h(e).then(function(t){var n=0===e.indexOf("http://")||0===e.indexOf("https://")?"":"http://",i=encodeURI(decodeURI(e)).replace(/[!'()]/g,escape).replace(/\*/g,"%2A"),o='<a target="_blank" rel="noopener" href="'+n+i+'">'+e+"</a>";t.target.className="chat-image",r=r.replace(o,t.target.outerHTML),a.throttledHTML(r)})})}),this},e.fn.addEmoticons=function(t){return t&&this.length>0&&this.each(function(t,n){var i=e(n).html();i=i.replace(/&gt;:\)/g,'<span class="emoticon icon-evil"></span>'),i=i.replace(/:\)/g,'<span class="emoticon icon-smiley"></span>'),i=i.replace(/:\-\)/g,'<span class="emoticon icon-smiley"></span>'),i=i.replace(/;\)/g,'<span class="emoticon icon-wink"></span>'),i=i.replace(/;\-\)/g,'<span class="emoticon icon-wink"></span>'),i=i.replace(/:D/g,'<span class="emoticon icon-grin"></span>'),i=i.replace(/:\-D/g,'<span class="emoticon icon-grin"></span>'),i=i.replace(/:P/g,'<span class="emoticon icon-tongue"></span>'),i=i.replace(/:\-P/g,'<span class="emoticon icon-tongue"></span>'),i=i.replace(/:p/g,'<span class="emoticon icon-tongue"></span>'),i=i.replace(/:\-p/g,'<span class="emoticon icon-tongue"></span>'),i=i.replace(/8\)/g,'<span class="emoticon icon-cool"></span>'),i=i.replace(/:S/g,'<span class="emoticon icon-confused"></span>'),i=i.replace(/:\\/g,'<span class="emoticon icon-wondering"></span>'),i=i.replace(/:\/ /g,'<span class="emoticon icon-wondering"></span>'),i=i.replace(/&gt;:\(/g,'<span class="emoticon icon-angry"></span>'),i=i.replace(/:\(/g,'<span class="emoticon icon-sad"></span>'),i=i.replace(/:\-\(/g,'<span class="emoticon icon-sad"></span>'),i=i.replace(/:O/g,'<span class="emoticon icon-shocked"></span>'),i=i.replace(/:\-O/g,'<span class="emoticon icon-shocked"></span>'),i=i.replace(/\=\-O/g,'<span class="emoticon icon-shocked"></span>'),i=i.replace(/\(\^.\^\)b/g,'<span class="emoticon icon-thumbs-up"></span>'),i=i.replace(/&lt;3/g,'<span class="emoticon icon-heart"></span>'),e(n).html(i)}),this};var p={__:function(t){if("undefined"==typeof Jed)return t;"undefined"==typeof this.i18n&&(this.i18n=locales.en),"string"==typeof this.i18n&&(this.i18n=e.parseJSON(this.i18n)),"undefined"==typeof this.jed&&(this.jed=new Jed(this.i18n));var n=this.jed.translate(t);return arguments.length>1?n.fetch.apply(n,[].slice.call(arguments,1)):n.fetch()},___:function(e){return e},isLocaleAvailable:function(e,t){if(t(e))return e;var n=e.split("-")[0];return n!==e&&t(n)?n:void 0},detectLocale:function(e){var t,n;if(window.navigator.userLanguage&&(t=p.isLocaleAvailable(window.navigator.userLanguage,e)),window.navigator.languages&&!t)for(n=0;n<window.navigator.languages.length&&!t;n++)t=p.isLocaleAvailable(window.navigator.languages[n],e);return window.navigator.browserLanguage&&!t&&(t=p.isLocaleAvailable(window.navigator.browserLanguage,e)),window.navigator.language&&!t&&(t=p.isLocaleAvailable(window.navigator.language,e)),window.navigator.systemLanguage&&!t&&(t=p.isLocaleAvailable(window.navigator.systemLanguage,e)),t||"en"},fadeIn:function(t,n){return e.fx.off?(t.classList.remove("hidden"),void n()):(t.addEventListener("animationend",function(){t.classList.remove("visible"),n()},!1),t.classList.add("visible"),void t.classList.remove("hidden"))},isOTRMessage:function(t){var n=e(t).children("body"),i=n.length>0?n.text():void 0;return i&&!!i.match(/^\?OTR/)},isHeadlineMessage:function(t){var n=e(t),i=n.attr("from");return"headline"===n.attr("type")||"error"!==n.attr("type")&&"undefined"!=typeof i&&i.indexOf("@")===-1},merge:function e(t,i){for(var o in i)n.isObject(t[o])?e(t[o],i[o]):t[o]=i[o]},applyUserSettings:function e(t,i,o){for(var s in i)n.isUndefined(o[s])||(n.isObject(i[s])&&!n.isArray(i[s])?e(t[s],i[s],o[s]):t[s]=o[s])},refreshWebkit:function(){e.browser.webkit&&window.requestAnimationFrame&&window.requestAnimationFrame(function(){var e=document.getElementById("conversejs");e.style.display="none";e.offsetHeight;e.style.display="block"})},webForm2xForm:function(t){var n,o=e(t);if(o.is("[type=checkbox]"))n=o.is(":checked")&&1||0;else if(o.is("textarea")){n=[];for(var s=o.val().split("\n"),a=0;a<s.length;a++){var r=e.trim(s[a]);""!==r&&n.push(r)}}else n=o.val();return e(i({name:o.attr("name"),value:n}))[0]},contains:function(e,t){return function(i){if("object"==typeof e){var o=!1;return n.each(e,function(e){o=o||i.get(e).toLowerCase().indexOf(t.toLowerCase())!==-1}),o}if("string"==typeof e)return i.get(e).toLowerCase().indexOf(t.toLowerCase())!==-1;throw new TypeError("contains: wrong attribute type. Must be string or array.")}},xForm2webForm:function(t,i){var h,p,_,m,f,g=[];if("list-single"===t.attr("type")||"list-multi"===t.attr("type")){for(f=[],_=t.children("value"),h=0;h<_.length;h++)f.push(e(_[h]).text());for(p=t.children("option"),h=0;h<p.length;h++)m=e(p[h]).find("value").text(),g.push(o({value:m,label:e(p[h]).attr("label"),selected:f.indexOf(m)>=0,required:t.find("required").length}));return s({name:t.attr("var"),label:t.attr("label"),options:g.join(""),multiple:"list-multi"===t.attr("type"),required:t.find("required").length})}return"fixed"===t.attr("type")?e('<p class="form-help">').text(t.find("value").text()):"jid-multi"===t.attr("type")?a({name:t.attr("var"),label:t.attr("label")||"",value:t.find("value").text(),required:t.find("required").length}):"boolean"===t.attr("type")?r({name:t.attr("var"),type:u[t.attr("type")],label:t.attr("label")||"",checked:"1"===t.find("value").text()&&'checked="1"'||"",required:t.find("required").length}):t.attr("type")&&"username"===t.attr("var")?l({domain:" @"+this.domain,name:t.attr("var"),type:u[t.attr("type")],label:t.attr("label")||"",value:t.find("value").text(),required:t.find("required").length}):t.attr("type")?c({name:t.attr("var"),type:u[t.attr("type")],label:t.attr("label")||"",value:t.find("value").text(),required:t.find("required").length}):"ocr"===t.attr("var")?n.reduce(n.map(t.find("uri"),e.proxy(function(e){return d({label:this.$field.attr("label"),name:this.$field.attr("var"),data:this.$stanza.find('data[cid="'+e.textContent.replace(/^cid:/,"")+'"]').text(),type:e.getAttribute("type"),required:this.$field.find("required").length})},{$stanza:i,$field:t})),function(e,t){return e+t},""):void 0}};return p.contains.not=function(e,t){return function(n){return!p.contains(e,t)(n)}},p}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var n=this.toString();(void 0===t||t>n.length)&&(t=n.length),t-=e.length;var i=n.indexOf(e,t);return i!==-1&&i===t}),String.prototype.splitOnce=function(e){var t=this.split(e);return[t.shift(),t.join(e)]},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),define("polyfill",function(){}),function(e,t){"function"==typeof define&&define.amd?define("pluggable",["underscore"],t):window.pluggable=t(_)}(this,function(e){"use strict";function t(e,t){this.name=t,this.plugged=e,this.plugged.__super__={},this.plugins={},this.initialized_plugins=[]}return e.extend(t.prototype,{wrappedOverride:function(t,n,i){return"function"==typeof i&&("undefined"==typeof this.__super__&&(this.__super__={}),this.__super__[t]=i.bind(this)),n.apply(this,e.rest(arguments,3))},_overrideAttribute:function(t,n){var i=n.overrides[t];if("function"==typeof i){var o=e.partial(this.wrappedOverride,t,i,this.plugged[t]);this.plugged[t]=o}else this.plugged[t]=i},_extendObject:function(t,n){t.prototype.__super__||(t.prototype.__super__={},t.prototype.__super__[this.name]=this.plugged),e.each(n,function(n,i){if("events"===i)t.prototype[i]=e.extend(n,t.prototype[i]);else if("function"==typeof n){var o=e.partial(this.wrappedOverride,i,n,t.prototype[i]);t.prototype[i]=o}else t.prototype[i]=n}.bind(this))},loadOptionalDependencies:function(t){e.each(t.optional_dependencies,function(n){var i=this.plugins[n];if(i){if(e.contains(i.optional_dependencies,t.__name__))throw'Found a circular dependency between the plugins "'+t.__name__+'" and "'+n+'"';this.initializePlugin(i)}else this.throwUndefinedDependencyError('Could not find optional dependency "'+n+'" for the plugin "'+t.__name__+"\". If it's needed, make sure it's loaded by require.js")}.bind(this))},throwUndefinedDependencyError:function(e){if(this.plugged.strict_plugin_dependencies)throw e;return void console.log(e)},applyOverrides:function(t){e.each(Object.keys(t.overrides||{}),function(e){var n=t.overrides[e];"object"==typeof n?"undefined"==typeof this.plugged[e]?this.throwUndefinedDependencyError('Error: Plugin "'+t.__name__+'" tried to override '+e+" but it's not found."):this._extendObject(this.plugged[e],n):this._overrideAttribute(e,t)}.bind(this))},initializePlugin:function(t){e.contains(this.initialized_plugins,t.__name__)||(e.extend(t,this.properties),t.optional_dependencies&&this.loadOptionalDependencies(t),this.applyOverrides(t),"function"==typeof t.initialize&&t.initialize.bind(t)(this),this.initialized_plugins.push(t.__name__))},registerPlugin:function(e,t){t.__name__=e,this.plugins[e]=t},initializePlugins:function(t){e.size(this.plugins)&&(this.properties=t,e.each(e.values(this.plugins),this.initializePlugin.bind(this)))}}),{enable:function(n,i,o){"undefined"==typeof o&&(o="pluginSocket"),"undefined"==typeof i&&(i="plugged");var s={};return s[o]=new t(n,i),e.extend(n,s)}}}),function(e,t){define("converse-core",["jquery","underscore","polyfill","utils","moment_with_locales","strophe","pluggable","strophe.disco","backbone.browserStorage","backbone.overview"],t)}(this,function(e,t,n,i,o,s,a){var r=s.$build,l=s.$iq,c=s.$pres,d=s.SHA1.b64_sha1;s=s.Strophe,t.templateSettings={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g};var u={},h={templates:{},emit:function(t,n){e(u).trigger(t,n)},once:function(t,n,i){i&&(n=n.bind(i)),e(u).one(t,n)},on:function(n,i,o){t.contains(["ready","initialized"],n)&&h.log('Warning: The "'+n+'" event has been deprecated and will be removed, please use "connected".'),o&&(i=i.bind(o)),e(u).bind(n,i)},off:function(t,n){e(u).unbind(t,n)}};a.enable(h,"converse","pluggable"),h.STATUS_WEIGHTS={offline:6,unavailable:5,xa:4,away:3,dnd:2,chat:1,online:1},h.ANONYMOUS="anonymous",h.CLOSED="closed",h.EXTERNAL="external",h.LOGIN="login",h.LOGOUT="logout",h.OPENED="opened",h.PREBIND="prebind";var p={0:"ERROR",1:"CONNECTING",2:"CONNFAIL",3:"AUTHENTICATING",4:"AUTHFAIL",5:"CONNECTED",6:"DISCONNECTED",7:"DISCONNECTING",8:"ATTACHED",9:"REDIRECT"};return h.log=function(e,t){var n;n="undefined"==typeof console||"undefined"==typeof console.log?{log:function(){},error:function(){}}:console,h.debug&&("error"===t?n.log("ERROR: "+e):n.log(e))},h.initialize=function(n,a){"use strict";n="undefined"!=typeof n?n:{};var u,h=new e.Deferred,_=this;"onpagehide"in window?u="pagehide":"onbeforeunload"in window?u="beforeunload":"onunload"in window&&(u="unload"),s.log=function(e,t){_.log(e+" "+t,e)},s.error=function(e){_.log(e,"error")},s.addNamespace("CARBONS","urn:xmpp:carbons:2"),s.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),s.addNamespace("CSI","urn:xmpp:csi:0"),s.addNamespace("ROSTERX","http://jabber.org/protocol/rosterx"),s.addNamespace("XFORM","jabber:x:data"),s.addNamespace("NICK","http://jabber.org/protocol/nick"),s.addNamespace("HINTS","urn:xmpp:hints"),s.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),this.TIMEOUTS={PAUSED:1e4,INACTIVE:9e4},this.INACTIVE="inactive",this.ACTIVE="active",this.COMPOSING="composing",this.PAUSED="paused",this.GONE="gone",this.isConverseLocale=function(e){return"undefined"!=typeof locales[e]},this.isMomentLocale=function(e){return o.locale()!==o.locale(e)},o.locale||(o.locale=o.lang),o.locale(i.detectLocale(this.isMomentLocale)),this.i18n=n.i18n?n.i18n:locales[i.detectLocale(this.isConverseLocale)]||{};var m=i.__.bind(this),f=m("Click to hide these contacts");if(this.default_settings={allow_contact_requests:!0,animate:!0,authentication:"login",auto_away:0,auto_login:!1,auto_reconnect:!1,auto_subscribe:!1,auto_xa:0,bosh_service_url:void 0,connection_options:{},credentials_url:null,csi_waiting_time:0,debug:!1,default_state:"online",expose_rid_and_sid:!1,filter_by_resource:!1,forward_messages:!1,hide_offline_users:!1,include_offline_state:!1,jid:void 0,keepalive:!1,locked_domain:void 0,message_carbons:!1,password:void 0,prebind:!1,prebind_url:null,rid:void 0,roster_groups:!1,show_only_online_users:!1,sid:void 0,storage:"session",message_storage:"session",strict_plugin_dependencies:!1,synchronize_availability:!0,websocket_url:void 0,xhr_custom_status:!1,xhr_custom_status_url:""},t.extend(this,this.default_settings),t.extend(this,t.pick(n,Object.keys(this.default_settings))),this.prebind===!0&&(this.authentication=_.PREBIND),this.authentication===_.ANONYMOUS&&this.auto_login&&!this.jid)throw new Error("Config Error: you need to provide the server's domain via the 'jid' option when using anonymous authentication with auto_login.");e.fx.off=!this.animate,this.callback=a||function(){},this.send_initial_presence=!0,this.msg_counter=0,this.user_settings=n,this.wrappedChatBox=function(e){if(e){var t=_.chatboxviews.get(e.get("id"));return{close:t.close.bind(t),focus:t.focus.bind(t),get:e.get.bind(e),open:t.show.bind(t),set:e.set.bind(e)}}},this.generateResource=function(){return"/converse.js-"+Math.floor(139749825*Math.random()).toString()},this.sendCSI=function(e){_.features[s.NS.CSI],_.connection.send(r(e,{xmlns:s.NS.CSI})),_.inactive=e===_.INACTIVE},this.onUserActivity=function(){_.idle_seconds>0&&(_.idle_seconds=0),_.connection.authenticated&&(_.inactive&&_.sendCSI(_.ACTIVE),_.auto_changed_status===!0&&(_.auto_changed_status=!1,_.xmppstatus.setStatus(_.default_state)))},this.onEverySecond=function(){if(_.connection.authenticated){var e=_.xmppstatus.getStatus();_.idle_seconds++,_.csi_waiting_time>0&&_.idle_seconds>_.csi_waiting_time&&!_.inactive&&_.sendCSI(_.INACTIVE),_.auto_away>0&&_.idle_seconds>_.auto_away&&"away"!==e&&"xa"!==e?(_.auto_changed_status=!0,_.xmppstatus.setStatus("away")):_.auto_xa>0&&_.idle_seconds>_.auto_xa&&"xa"!==e&&(_.auto_changed_status=!0,_.xmppstatus.setStatus("xa"))}},this.registerIntervalHandler=function(){_.auto_away<1&&_.auto_xa<1&&_.csi_waiting_time<1||(_.idle_seconds=0,_.auto_changed_status=!1,e(window).on("click mousemove keypress focus"+u,_.onUserActivity),_.everySecondTrigger=window.setInterval(_.onEverySecond,1e3))},this.giveFeedback=function(t,n,i){e(".conn-feedback").each(function(i,o){var s=e(o);s.addClass("conn-feedback").text(t),n?s.addClass(n):s.removeClass("error")}),_.emit("feedback",{klass:n,message:i,subject:t})},this.rejectPresenceSubscription=function(e,t){var n=c({to:e,type:"unsubscribed"});t&&""!==t&&n.c("status").t(t),_.connection.send(n)},this.reconnect=t.debounce(function(e){_.log("The connection has dropped, attempting to reconnect."),_.giveFeedback(m("Reconnecting"),"warn",m("The connection has dropped, attempting to reconnect.")),_.connection.reconnecting=!0,_.connection.disconnect("re-connecting"),_.connection.reset(),_._tearDown(),_.logIn(null,!0)},1e3),this.onDisconnected=function(e){return _.disconnection_cause!==_.LOGOUT&&_.auto_reconnect?(_.disconnection_cause===s.Status.CONNFAIL?(_.reconnect(e),_.log("RECONNECTING")):_.disconnection_cause!==s.Status.DISCONNECTING&&_.disconnection_cause!==s.Status.DISCONNECTED||(window.setTimeout(t.partial(_.reconnect,e),3e3),_.log("RECONNECTING IN 3 SECONDS")),_.emit("reconnecting"),"reconnecting"):(delete _.connection.reconnecting,_._tearDown(),_.chatboxviews.closeAllChatBoxes(),_.emit("disconnected"),_.log("DISCONNECTED"),"disconnected")},this.setDisconnectionCause=function(e){"undefined"==typeof _.disconnection_cause&&(_.disconnection_cause=e)},this.onConnectStatusChanged=function(e,t){_.log("Status changed to: "+p[e]),e===s.Status.CONNECTED||e===s.Status.ATTACHED?(_.send_initial_presence=!0,delete _.disconnection_cause,_.connection.reconnecting?(_.log(e===s.Status.CONNECTED?"Reconnected":"Reattached"),_.onConnected(!0)):(_.log(e===s.Status.CONNECTED?"Connected":"Attached"),_.connection.restored&&(_.send_initial_presence=!1),_.onConnected())):e===s.Status.DISCONNECTED?(_.setDisconnectionCause(e),_.onDisconnected(t),e===s.Status.DISCONNECTING&&t&&_.giveFeedback(m("Disconnected"),"warn",m("The connection to the chat server has dropped"))):e===s.Status.ERROR?_.giveFeedback(m("Connection error"),"error",m("An error occurred while connecting to the chat server.")):e===s.Status.CONNECTING?_.giveFeedback(m("Connecting")):e===s.Status.AUTHENTICATING?_.giveFeedback(m("Authenticating")):e===s.Status.AUTHFAIL?(_.giveFeedback(m("Authentication failed."),"error"),_.connection.disconnect(m("Authentication Failed")),_.disconnection_cause=s.Status.AUTHFAIL):e!==s.Status.CONNFAIL&&e!==s.Status.DISCONNECTING||_.setDisconnectionCause(e)},this.updateMsgCounter=function(){this.msg_counter>0?document.title.search(/^Messages \(\d+\) /)===-1?document.title="Messages ("+this.msg_counter+") "+document.title:document.title=document.title.replace(/^Messages \(\d+\) /,"Messages ("+this.msg_counter+") "):document.title.search(/^Messages \(\d+\) /)!==-1&&(document.title=document.title.replace(/^Messages \(\d+\) /,""))},this.incrementMsgCounter=function(){this.msg_counter+=1,this.updateMsgCounter()},this.clearMsgCounter=function(){this.msg_counter=0,this.updateMsgCounter()},this.initStatus=function(){var t=new e.Deferred;this.xmppstatus=new this.XMPPStatus;var n=d("converse.xmppstatus-"+_.bare_jid);return this.xmppstatus.id=n,this.xmppstatus.browserStorage=new Backbone.BrowserStorage[_.storage](n),this.xmppstatus.fetch({success:t.resolve,error:t.resolve}),_.emit("statusInitialized"),t.promise()},this.initSession=function(){this.session=new this.Session;var e=d("converse.bosh-session");this.session.id=e,this.session.browserStorage=new Backbone.BrowserStorage[_.storage](e),this.session.fetch()},this.clearSession=function(){t.isUndefined(this.roster)||this.roster.browserStorage._clear(),this.session.browserStorage._clear()},this.logOut=function(){_.chatboxviews.closeAllChatBoxes(),_.disconnection_cause=_.LOGOUT,"undefined"!=typeof _.connection&&(_.connection.disconnect(),_.connection.reset()),_.clearSession(),_._tearDown(),_.emit("logout")},this.saveWindowState=function(e,t){var n,i="visible",o="hidden",s={focus:i,focusin:i,pageshow:i,blur:o,focusout:o,pagehide:o};e=e||document.createEvent("Events"),n=e.type in s?s[e.type]:document[t]?"hidden":"visible","visible"===n&&_.clearMsgCounter(),_.windowState=n},this.registerGlobalEventHandlers=function(){var e="hidden";e in document?document.addEventListener("visibilitychange",t.partial(_.saveWindowState,t,e)):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",t.partial(_.saveWindowState,t,e)):(e="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",t.partial(_.saveWindowState,t,e)):(e="msHidden")in document?document.addEventListener("msvisibilitychange",t.partial(_.saveWindowState,t,e)):"onfocusin"in document?document.onfocusin=document.onfocusout=t.partial(_.saveWindowState,t,e):window.onpageshow=window.onpagehide=window.onfocus=window.onblur=t.partial(_.saveWindowState,t,e),void 0!==document[e]&&t.partial(_.saveWindowState,t,e)({type:document[e]?"blur":"focus"})},this.enableCarbons=function(){if(this.message_carbons&&!this.session.get("carbons_enabled")){var t=new s.Builder("iq",{from:this.connection.jid,id:"enablecarbons",type:"set"}).c("enable",{xmlns:s.NS.CARBONS});
this.connection.addHandler(function(t){e(t).find("error").length>0?_.log("ERROR: An error occured while trying to enable message carbons."):(this.session.save({carbons_enabled:!0}),_.log("Message carbons have been enabled."))}.bind(this),null,"iq",null,"enablecarbons"),this.connection.send(t)}},this.initRoster=function(){_.roster=new _.RosterContacts,_.roster.browserStorage=new Backbone.BrowserStorage.session(d("converse.contacts-"+_.bare_jid)),_.rostergroups=new _.RosterGroups,_.rostergroups.browserStorage=new Backbone.BrowserStorage.session(d("converse.roster.groups"+_.bare_jid)),_.emit("rosterInitialized")},this.populateRoster=function(){_.rostergroups.fetchRosterGroups().then(function(){_.emit("rosterGroupsFetched"),_.roster.fetchRosterContacts().then(function(){_.emit("rosterContactsFetched"),_.sendInitialPresence()})})},this.unregisterPresenceHandler=function(){"undefined"!=typeof _.presence_ref&&(_.connection.deleteHandler(_.presence_ref),delete _.presence_ref)},this.registerPresenceHandler=function(){_.unregisterPresenceHandler(),_.presence_ref=_.connection.addHandler(function(e){return _.roster.presenceHandler(e),!0},null,"presence",null)},this.sendInitialPresence=function(){_.send_initial_presence&&_.xmppstatus.sendPresence()},this.onStatusInitialized=function(e){e?_.emit("rosterReadyAfterReconnection"):(_.registerIntervalHandler(),_.initRoster()),_.chatboxes.onConnected(),_.populateRoster(),_.registerPresenceHandler(),_.giveFeedback(m("Contacts")),e?_.xmppstatus.sendPresence():(h.resolve(),_.emit("initialized"))},this.setUserJid=function(){_.jid=_.connection.jid,_.bare_jid=s.getBareJidFromJid(_.connection.jid),_.resource=s.getResourceFromJid(_.connection.jid),_.domain=s.getDomainFromJid(_.connection.jid)},this.onConnected=function(e){_.connection.flush(),_.setUserJid(),_.enableCarbons(),e=!t.isUndefined(_.xmppstatus)&&e,e?(_.onStatusInitialized(!0),_.emit("reconnected")):(_.chatboxviews.closeAllChatBoxes(),_.features=new _.Features,_.initStatus().done(t.partial(_.onStatusInitialized,!1)),_.emit("connected"))},this.RosterContact=Backbone.Model.extend({initialize:function(e,n){var i=e.jid,o=s.getBareJidFromJid(i),a=s.getResourceFromJid(i);e.jid=o,this.set(t.extend({id:o,jid:o,fullname:o,chat_status:"offline",user_id:s.getNodeFromJid(i),resources:a?[a]:[],groups:[],image_type:"image/png",image:"iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAIAAABt+uBvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gwHCy455JBsggAABkJJREFUeNrtnM1PE1sUwHvvTD8otWLHST/Gimi1CEgr6M6FEWuIBo2pujDVsNDEP8GN/4MbN7oxrlipG2OCgZgYlxAbkRYw1KqkIDRCSkM7nXvvW8x7vjyNeQ9m7p1p3z1LQk/v/Dhz7vkEXL161cHl9wI5Ag6IA+KAOCAOiAPigDggLhwQB2S+iNZ+PcYY/SWEEP2HAAAIoSAIoihCCP+ngDDGtVotGAz29/cfOXJEUZSOjg6n06lp2sbGRqlUWlhYyGazS0tLbrdbEASrzgksyeYJId3d3el0uqenRxRFAAAA4KdfIIRgjD9+/Pj8+fOpqSndslofEIQwHA6Pjo4mEon//qmFhYXHjx8vLi4ihBgDEnp7e9l8E0Jo165dQ0NDd+/eDYVC2/qsJElDQ0OEkKWlpa2tLZamxAhQo9EIBoOjo6MXL17csZLe3l5FUT59+lQul5l5JRaAVFWNRqN37tw5ceKEQVWRSOTw4cOFQuHbt2+iKLYCIISQLMu3b99OJpOmKAwEAgcPHszn8+vr6wzsiG6UQQhxuVyXLl0aGBgwUW0sFstkMl6v90fo1KyAMMYDAwPnzp0zXfPg4GAqlWo0Gk0MiBAiy/L58+edTqf5Aa4onj59OhaLYYybFRCEMBaL0fNxBw4cSCQStN0QRUBut3t4eJjq6U+dOiVJElVPRBFQIBDo6+ujCqirqyscDlONGykC2lYyYSR6pBoQQapHZwAoHo/TuARYAOrs7GQASFEUqn6aIiBJkhgA6ujooFpUo6iaTa7koFwnaoWadLNe81tbWwzoaJrWrICWl5cZAFpbW6OabVAEtLi4yABQsVjUNK0pAWWzWQaAcrlcswKanZ1VVZUqHYRQEwOq1Wpv3ryhCmh6erpcLjdrNl+v1ycnJ+l5UELI27dvv3//3qxxEADgy5cvExMT9Mznw4cPtFtAdAPFarU6Pj5eKpVM17yxsfHy5cvV1VXazXu62gVBKBQKT58+rdVqJqrFGL948eLdu3dU8/g/H4FBUaJYLAqC0NPTY9brMD4+PjY25mDSracOCABACJmZmXE6nUePHjWu8NWrV48ePSKEsGlAs7Agfd5nenq6Wq0mk0kjDzY2NvbkyRMIIbP2PLvhBUEQ8vl8NpuNx+M+n29bzhVjvLKycv/+/YmJCcazQuwA6YzW1tYmJyf1SY+2trZ/rRk1Go1SqfT69esHDx4UCgVmNaa/zZ/9ABUhRFXVYDB48uTJeDweiUQkSfL7/T9MA2NcqVTK5fLy8vL8/PzU1FSxWHS5XJaM4wGr9sUwxqqqer3eUCgkSZJuUBBCfTRvc3OzXC6vrKxUKhWn02nhCJ5lM4oQQo/HgxD6+vXr58+fHf8sDOp+HQDg8XgclorFU676dKLlo6yWRdItIBwQB8QBcUCtfosRQjRNQwhhjPUC4w46WXryBSHU1zgEQWBz99EFhDGu1+t+v//48ePxeFxRlD179ng8nh0Efgiher2+vr6ur3HMzMysrq7uTJVdACGEurq6Ll++nEgkPB7Pj9jPoDHqOxyqqubz+WfPnuVyuV9XPeyeagAAAoHArVu3BgcHab8CuVzu4cOHpVKJUnfA5GweY+xyuc6cOXPv3r1IJMLAR8iyPDw8XK/Xi8Wiqqqmm5KZgBBC7e3tN27cuHbtGuPVpf7+/lAoNDs7W61WzfVKpgHSSzw3b95MpVKW3MfRaDQSiczNzVUqFRMZmQOIEOL1eq9fv3727FlL1t50URRFluX5+flqtWpWEGAOIFEUU6nUlStXLKSjy759+xwOx9zcnKZpphzGHMzhcDiTydgk9r1w4YIp7RPTAAmCkMlk2FeLf/tIEKbTab/fbwtAhJBoNGrutpNx6e7uPnTokC1eMU3T0um0DZPMkZER6wERQnw+n/FFSxpy7Nix3bt3WwwIIcRgIWnHkkwmjecfRgGx7DtuV/r6+iwGhDHev3+/bQF1dnYaH6E2CkiWZdsC2rt3r8WAHA5HW1ubbQGZcjajgOwTH/4qNko1Wlg4IA6IA+KAOKBWBUQIsfNojyliKIoRRfH9+/dut9umf3wzpoUNNQ4BAJubmwz+ic+OxefzWWlBhJD29nbug7iT5sIBcUAcEAfEAXFAHBAHxOVn+QMrmWpuPZx12gAAAABJRU5ErkJggg==",status:""},e)),this.on("destroy",function(){this.removeFromRoster()}.bind(this)),this.on("change:chat_status",function(e){_.emit("contactStatusChanged",e.attributes)})},subscribe:function(e){this.save("ask","subscribe");var t=c({to:this.get("jid"),type:"subscribe"});e&&""!==e&&t.c("status").t(e).up();var n=_.xmppstatus.get("fullname");return n&&""!==n&&t.c("nick",{xmlns:s.NS.NICK}).t(n).up(),_.connection.send(t),this},ackSubscribe:function(){_.connection.send(c({type:"subscribe",to:this.get("jid")}))},ackUnsubscribe:function(e){_.connection.send(c({type:"unsubscribe",to:this.get("jid")})),this.destroy()},unauthorize:function(e){return _.rejectPresenceSubscription(this.get("jid"),e),this},authorize:function(e){var t=c({to:this.get("jid"),type:"subscribed"});return e&&""!==e&&t.c("status").t(e),_.connection.send(t),this},removeResource:function(e){var n,i=this.get("resources");return e?(n=t.indexOf(i,e),n!==-1&&(i.splice(n,1),this.save({resources:i})),i.length):(this.save({resources:[]}),0)},removeFromRoster:function(e){var t=l({type:"set"}).c("query",{xmlns:s.NS.ROSTER}).c("item",{jid:this.get("jid"),subscription:"remove"});return _.connection.sendIQ(t,e,e),this}}),this.RosterContacts=Backbone.Collection.extend({model:_.RosterContact,comparator:function(e,t){var n,i,o=e.get("chat_status")||"offline",s=t.get("chat_status")||"offline";return _.STATUS_WEIGHTS[o]===_.STATUS_WEIGHTS[s]?(n=e.get("fullname").toLowerCase(),i=t.get("fullname").toLowerCase(),n<i?-1:n>i?1:0):_.STATUS_WEIGHTS[o]<_.STATUS_WEIGHTS[s]?-1:1},fetchRosterContacts:function(){var t=new e.Deferred;return this.fetch({add:!0,success:function(e){0===e.length?(_.send_initial_presence=!0,_.roster.fetchFromServer(t.resolve)):(_.emit("cachedRoster",e),t.resolve())}}),t.promise()},subscribeToSuggestedItems:function(t){return e(t).find("item").each(function(e,t){"add"===this.getAttribute("action")&&_.roster.addAndSubscribe(this.getAttribute("jid"),null,_.xmppstatus.get("fullname"))}),!0},isSelf:function(e){return s.getBareJidFromJid(e)===s.getBareJidFromJid(_.connection.jid)},addAndSubscribe:function(e,t,n,i,o){this.addContact(e,t,n,o).done(function(e){e instanceof _.RosterContact&&e.subscribe(i)})},sendContactAddIQ:function(e,n,i,o,a){n=t.isEmpty(n)?e:n;var r=l({type:"set"}).c("query",{xmlns:s.NS.ROSTER}).c("item",{jid:e,name:n});t.map(i,function(e){r.c("group").t(e).up()}),_.connection.sendIQ(r,o,a)},addContact:function(n,i,o,s){var a=new e.Deferred;return o=o||[],i=t.isEmpty(i)?n:i,this.sendContactAddIQ(n,i,o,function(e){var r=this.create(t.extend({ask:void 0,fullname:i,groups:o,jid:n,requesting:!1,subscription:"none"},s),{sort:!1});a.resolve(r)}.bind(this),function(e){alert(m("Sorry, there was an error while trying to add "+i+" as a contact.")),_.log(e),a.resolve(e)}),a.promise()},addResource:function(e,n){var i,o=this.get(e);o&&(i=o.get("resources"),i?t.indexOf(i,n)===-1&&(i.push(n),o.set({resources:i})):o.set({resources:[n]}))},subscribeBack:function(e){var t=this.get(e);t instanceof _.RosterContact?t.authorize().subscribe():this.addContact(e,"",[],{subscription:"from"}).done(function(e){e instanceof _.RosterContact&&e.authorize().subscribe()})},getNumOnlineContacts:function(){var e,n=0,i=["offline","unavailable"],o=this.models,s=o.length;for(_.show_only_online_users&&(i=t.union(i,["dnd","xa","away"])),e=0;e<s;e++)t.indexOf(i,o[e].get("chat_status"))===-1&&n++;return n},onRosterPush:function(t){var n=t.getAttribute("id"),i=t.getAttribute("from");return i&&""!==i&&s.getBareJidFromJid(i)!==_.bare_jid?(_.connection.send(l({type:"error",id:n,from:_.connection.jid}).c("error",{type:"cancel"}).c("service-unavailable",{xmlns:s.NS.ROSTER})),!0):(_.connection.send(l({type:"result",id:n,from:_.connection.jid})),e(t).children("query").find("item").each(function(e,t){this.updateContact(t)}.bind(this)),_.emit("rosterPush",t),!0)},fetchFromServer:function(e){var t=l({type:"get",id:_.connection.getUniqueId("roster")}).c("query",{xmlns:s.NS.ROSTER});return _.connection.sendIQ(t,function(){this.onReceivedFromServer.apply(this,arguments),e.apply(this,arguments)}.bind(this))},onReceivedFromServer:function(t){e(t).children("query").find("item").each(function(e,t){this.updateContact(t)}.bind(this)),_.emit("roster",t)},updateContact:function(t){var n=t.getAttribute("jid");if(!this.isSelf(n)){var i=[],o=this.get(n),a=t.getAttribute("ask"),r=t.getAttribute("subscription");if(e.map(t.getElementsByTagName("group"),function(e){i.push(s.getText(e))}),o){if("remove"===r)return o.destroy();o.save({subscription:r,ask:a,requesting:null,groups:i})}else{if("none"===r&&null===a||"remove"===r)return;this.create({ask:a,fullname:t.getAttribute("name")||n,groups:i,jid:n,subscription:r},{sort:!1})}}},createRequestingContact:function(t){var n=s.getBareJidFromJid(t.getAttribute("from")),i=e(t).children("nick[xmlns="+s.NS.NICK+"]").text(),o={jid:n,subscription:"none",ask:null,requesting:!0,fullname:i||n};this.create(o),_.emit("contactRequest",o)},handleIncomingSubscription:function(e){var t=e.getAttribute("from"),n=s.getBareJidFromJid(t),i=this.get(n);_.allow_contact_requests||_.rejectPresenceSubscription(t,m("This client does not allow presence subscriptions")),_.auto_subscribe?i&&"to"===i.get("subscription")?i.authorize():this.subscribeBack(n):i?"none"!==i.get("subscription")?i.authorize():"subscribe"===i.get("ask")&&i.authorize():i||this.createRequestingContact(e)},presenceHandler:function(t){var n=e(t),i=t.getAttribute("type");if("error"===i)return!0;var o=t.getAttribute("from"),a=s.getBareJidFromJid(o),r=s.getResourceFromJid(o),l=n.find("show").text()||"online",c=n.find("status"),d=this.get(a);if(this.isSelf(a))return void(_.connection.jid===o||"unavailable"===i||_.synchronize_availability!==!0&&_.synchronize_availability!==r||(_.xmppstatus.save({status:l}),c.length&&_.xmppstatus.save({status_message:c.text()})));if(0!==(n.find("x").attr("xmlns")||"").indexOf(s.NS.MUC))if(d&&c.text()!==d.get("status")&&d.save({status:c.text()}),"subscribed"===i&&d)d.ackSubscribe();else if("unsubscribed"===i&&d)d.ackUnsubscribe();else{if("unsubscribe"===i)return;"subscribe"===i?this.handleIncomingSubscription(t):"unavailable"===i&&d?0===d.removeResource(r)&&d.save({chat_status:"offline"}):d&&(this.addResource(a,r),d.save({chat_status:l}))}}}),this.RosterGroup=Backbone.Model.extend({initialize:function(e,n){this.set(t.extend({description:f,state:_.OPENED},e)),this.contacts=new _.RosterContacts}}),this.RosterGroups=Backbone.Collection.extend({model:_.RosterGroup,fetchRosterGroups:function(){var t=new e.Deferred;return this.fetch({silent:!0,success:t.resolve}),t.promise()}}),this.Message=Backbone.Model.extend({defaults:function(){return{msgid:_.connection.getUniqueId()}}}),this.Messages=Backbone.Collection.extend({model:_.Message,comparator:"time"}),this.ChatBox=Backbone.Model.extend({initialize:function(){this.messages=new _.Messages,this.messages.browserStorage=new Backbone.BrowserStorage[_.message_storage](d("converse.messages"+this.get("jid")+_.bare_jid)),this.save({box_id:d(this.get("jid")),chat_state:void 0,num_unread:this.get("num_unread")||0,time_opened:this.get("time_opened")||o().valueOf(),url:"",user_id:s.getNodeFromJid(this.get("jid"))})},getMessageAttributes:function(e,n,i){n=n||e.find("delay");var a,r,l,c,d,u=e.attr("type");a="error"===u?e.find("error").children("text").text():e.children("body").text();var h=n.length>0,p=this.get("fullname"),m="groupchat"===u,f=e.find(_.COMPOSING).length&&_.COMPOSING||e.find(_.PAUSED).length&&_.PAUSED||e.find(_.INACTIVE).length&&_.INACTIVE||e.find(_.ACTIVE).length&&_.ACTIVE||e.find(_.GONE).length&&_.GONE;return d=m?s.unescapeNode(s.getResourceFromJid(e.attr("from"))):s.getBareJidFromJid(e.attr("from")),t.isEmpty(p)&&(p=d),h?(r=n.attr("stamp"),l=r):l=o().format(),c=m&&d===this.get("nick")||!m&&d===_.bare_jid?"me":"them",{type:u,chat_state:f,delayed:h,fullname:p,message:a||void 0,msgid:e.attr("id"),sender:c,time:l}},createMessage:function(e,t,n){return this.messages.create(this.getMessageAttributes.apply(this,arguments))}}),this.ChatBoxes=Backbone.Collection.extend({model:_.ChatBox,comparator:"time_opened",registerMessageHandler:function(){_.connection.addHandler(this.onMessage.bind(this),null,"message","chat"),_.connection.addHandler(this.onErrorMessage.bind(this),null,"message","error")},chatBoxMayBeShown:function(e){return!0},onChatBoxesFetched:function(e){var t=this;e.each(function(e){t.chatBoxMayBeShown(e)&&e.trigger("show")}),_.emit("chatBoxesFetched")},onConnected:function(){this.browserStorage=new Backbone.BrowserStorage[_.storage](d("converse.chatboxes-"+_.bare_jid)),this.registerMessageHandler(),this.fetch({add:!0,success:this.onChatBoxesFetched.bind(this)})},onErrorMessage:function(t){var n=e(t),i=s.getBareJidFromJid(n.attr("from"));if(i===_.bare_jid)return!0;var o=this.getChatBox(i);return!o||(o.createMessage(n,null,t),!0)},onMessage:function(t){var n,o,a,r,l,c,d,u,h,p=e(t),m=p.attr("from"),f=p.attr("to"),g=s.getResourceFromJid(f);return _.filter_by_resource&&g&&g!==_.resource?(_.log("onMessage: Ignoring incoming message intended for a different resource: "+f,"info"),!0):i.isHeadlineMessage(t)?(_.log("onMessage: Ignoring incoming headline message sent with type 'chat' from JID: "+m,"info"),!0):(o=p.find("forwarded"),o.length&&(p=o.children("message"),a=o.children("delay"),m=p.attr("from"),f=p.attr("to")),r=s.getBareJidFromJid(m),l=s.getResourceFromJid(m),c=r===_.bare_jid,d=p.attr("id"),c?(n=s.getBareJidFromJid(f),h=s.getResourceFromJid(f)):(n=r,h=l),_.emit("message",t),!(u=this.getChatBox(n,p.find("body").length>0))||(!(!d||!u.messages.findWhere({msgid:d}))||(u.createMessage(p,a,t),!0)))},getChatBox:function(e,n,i){e=e.toLowerCase();var o=s.getBareJidFromJid(e),a=this.get(o);if(!a&&n){var r=_.roster.get(o);if(void 0===r)return void _.log("Could not get roster item for JID "+o,"error");a=this.create(t.extend({id:o,jid:o,fullname:t.isEmpty(r.get("fullname"))?e:r.get("fullname"),image_type:r.get("image_type"),image:r.get("image"),url:r.get("url")},i||{}))}return a}}),this.ChatBoxViews=Backbone.Overview.extend({initialize:function(){this.model.on("add",this.onChatBoxAdded,this),this.model.on("destroy",this.removeChat,this)},_ensureElement:function(){if(this.el)this.setElement(t.result(this,"el"),!1);else{var n=e("#conversejs");n.length||(n=e('<div id="conversejs">'),e("body").append(n)),n.html(""),this.setElement(n,!1)}},onChatBoxAdded:function(e){return this.get(e.get("id"))},removeChat:function(e){this.remove(e.get("id"))},closeAllChatBoxes:function(){return this.each(function(e){e.close()}),this},chatBoxMayBeShown:function(e){return this.model.chatBoxMayBeShown(e)},getChatBox:function(e,t){var n=this.model.get(e.jid);return!n&&t&&(n=this.model.create(e,{error:function(e,t){_.log(t.responseText)}})),n},showChat:function(e){var t=this.getChatBox(e,!0);return this.chatBoxMayBeShown(t)&&t.trigger("show",!0),t}}),this.XMPPStatus=Backbone.Model.extend({initialize:function(){this.set({status:this.getStatus()}),this.on("change",function(e){t.has(e.changed,"status")&&_.emit("statusChanged",this.get("status")),t.has(e.changed,"status_message")&&_.emit("statusMessageChanged",this.get("status_message"))}.bind(this))},constructPresence:function(e,t){var n;return e="string"==typeof e?e:this.get("status")||_.default_state,t="string"==typeof t?t:void 0,n="unavailable"===e||"probe"===e||"error"===e||"unsubscribe"===e||"unsubscribed"===e||"subscribe"===e||"subscribed"===e?c({type:e}):"offline"===e?c({type:"unavailable"}):"online"===e?c():c().c("show").t(e).up(),t&&n.c("status").t(t),n},sendPresence:function(e,t){_.connection.send(this.constructPresence(e,t))},setStatus:function(e){this.sendPresence(e),this.save({status:e})},getStatus:function(){return this.get("status")||_.default_state},setStatusMessage:function(t){this.sendPresence(this.getStatus(),t);var n=this.get("status_message");this.save({status_message:t}),this.xhr_custom_status&&e.ajax({url:this.xhr_custom_status_url,type:"POST",data:{msg:t}}),n===t&&this.trigger("update-status-ui",this)}}),this.Session=Backbone.Model,this.Feature=Backbone.Model,this.Features=Backbone.Collection.extend({model:_.Feature,initialize:function(){this.addClientIdentities().addClientFeatures(),this.browserStorage=new Backbone.BrowserStorage[_.storage](d("converse.features"+_.bare_jid)),this.on("add",this.onFeatureAdded,this),0===this.browserStorage.records.length?(_.connection.disco.info(_.domain,null,this.onInfo.bind(this)),_.connection.disco.items(_.domain,null,this.onItems.bind(this))):this.fetch({add:!0})},onFeatureAdded:function(e){_.emit("serviceDiscovered",e)},addClientIdentities:function(){return _.connection.disco.addIdentity("client","web","Converse.js"),this},addClientFeatures:function(){return _.connection.disco.addFeature(s.NS.BOSH),_.connection.disco.addFeature(s.NS.CHATSTATES),_.connection.disco.addFeature(s.NS.DISCO_INFO),_.connection.disco.addFeature(s.NS.ROSTERX),_.message_carbons&&_.connection.disco.addFeature(s.NS.CARBONS),this},onItems:function(t){e(t).find("query item").each(function(t,n){_.connection.disco.info(e(n).attr("jid"),null,this.onInfo.bind(this))}.bind(this))},onInfo:function(t){var n=e(t);0===n.find("identity[category=server][type=im]").length&&0===n.find("identity[category=conference][type=text]").length||n.find("feature").each(function(t,i){var o=e(i).attr("var");this[o]=!0,this.create({var:o,from:n.attr("from")})}.bind(this))}}),this.setUpXMLLogging=function(){s.log=function(e,t){_.log(t,e)},this.debug&&(this.connection.xmlInput=function(e){_.log(e.outerHTML)},this.connection.xmlOutput=function(e){_.log(e.outerHTML)})},this.fetchLoginCredentials=function(){var t=new e.Deferred;return e.ajax({url:_.credentials_url,type:"GET",dataType:"json",success:function(e){t.resolve({jid:e.jid,password:e.password})},error:function(e){delete _.connection,_.emit("noResumeableSession"),t.reject(e)}}),t.promise()},this.startNewBOSHSession=function(){var t=this;e.ajax({url:this.prebind_url,type:"GET",dataType:"json",success:function(e){t.connection.attach(e.jid,e.sid,e.rid,t.onConnectStatusChanged)},error:function(e){delete t.connection,t.emit("noResumeableSession")}})},this.attemptPreboundSession=function(e){if(!e&&this.keepalive){if(!this.jid)throw new Error("attemptPreboundSession: when using 'keepalive' with 'prebind, you must supply the JID of the current user.");try{return this.connection.restore(this.jid,this.onConnectStatusChanged)}catch(e){this.log("Could not restore session for jid: "+this.jid+" Error message: "+e.message),this.clearSession()}}if(!e&&this.jid&&this.sid&&this.rid)return this.connection.attach(this.jid,this.sid,this.rid,this.onConnectStatusChanged);if(this.prebind_url)return this.startNewBOSHSession();throw new Error("attemptPreboundSession: If you use prebind and not keepalive, then you MUST supply JID, RID and SID values or a prebind_url.")},this.autoLogin=function(e){if(e&&(this.jid=e.jid,this.password=e.password),this.authentication===_.ANONYMOUS){if(!this.jid)throw new Error("Config Error: when using anonymous login you need to provide the server's domain via the 'jid' option. Either when calling converse.initialize, or when calling converse.user.login.");this.connection.connect(this.jid.toLowerCase(),null,this.onConnectStatusChanged)}else if(this.authentication===_.LOGIN){var t=_.connection.pass||this.password;if(!t){if(this.auto_login&&!this.password)throw new Error("initConnection: If you use auto_login and authentication='login' then you also need to provide a password.");return _.disconnection_cause=s.Status.AUTHFAIL,_.onDisconnected(),void _.giveFeedback("")}var n=s.getResourceFromJid(this.jid);n?this.jid=s.getBareJidFromJid(this.jid).toLowerCase()+"/"+n:this.jid=this.jid.toLowerCase()+_.generateResource(),this.connection.connect(this.jid,t,this.onConnectStatusChanged)}},this.attemptNonPreboundSession=function(e,t){if(this.keepalive&&!t)try{return this.connection.restore(this.jid,this.onConnectStatusChanged)}catch(e){this.log("Could not restore session. Error message: "+e.message),this.clearSession()}if(this.auto_login)if(e)this.autoLogin(e);else if(this.credentials_url)this.fetchLoginCredentials().done(this.autoLogin.bind(this));else{if(!this.jid)throw new Error("initConnection: If you use auto_login, you also needto give either a jid value (and if applicable a password) or you need to pass in a URL from where the username and password can be fetched (via credentials_url).");this.autoLogin()}},this.logIn=function(e,t){this.authentication===_.PREBIND?this.attemptPreboundSession(t):this.attemptNonPreboundSession(e,t)},this.initConnection=function(){if(!this.connection){if(!this.bosh_service_url&&!this.websocket_url)throw new Error("initConnection: you must supply a value for either the bosh_service_url or websocket_url or both.");if(("WebSocket"in window||"MozWebSocket"in window)&&this.websocket_url)this.connection=new s.Connection(this.websocket_url,this.connection_options);else{if(!this.bosh_service_url)throw new Error("initConnection: this browser does not support websockets and bosh_service_url wasn't specified.");this.connection=new s.Connection(this.bosh_service_url,t.extend(this.connection_options,{keepalive:this.keepalive}))}}},this._tearDown=function(){return this.unregisterPresenceHandler(),this.roster&&this.roster.off().reset(),this.chatboxes.remove(),this.features&&this.features.reset(),e(window).off("click mousemove keypress focus"+u,_.onUserActivity),window.clearInterval(_.everySecondTrigger),this},this.initChatBoxes=function(){this.chatboxes=new this.ChatBoxes,this.chatboxviews=new this.ChatBoxViews({model:this.chatboxes})},this._initialize=function(){return this.initChatBoxes(),this.initSession(),this.initConnection(),this.setUpXMLLogging(),this.logIn(),this},n.connection&&(this.connection=n.connection);var g=function(e){i.merge(_.default_settings,e),i.merge(_,e),i.applyUserSettings(_,e,_.user_settings)};return _.pluggable.initialized_plugins=[],_.pluggable.initializePlugins({updateSettings:g,converse:_}),_.emit("pluginsInitialized"),_._initialize(),_.registerGlobalEventHandlers(),t.isUndefined(_.connection)||"jasmine tests"!==_.connection.service?h.promise():_},h}),function(e,t){define("converse-api",["jquery","underscore","moment_with_locales","strophe","utils","converse-core"],t)}(this,function(e,t,n,i,o,s){var a=i.Strophe;return{initialize:function(e,t){return s.initialize(e,t)},log:s.log,connection:{connected:function(){return s.connection&&s.connection.connected||!1},disconnect:function(){s.connection.disconnect()}},user:{jid:function(){return s.connection.jid},login:function(e){s.initConnection(),s.logIn(e)},logout:function(){s.logOut()},status:{get:function(){return s.xmppstatus.get("status")},set:function(e,n){var i={status:e};if(!t.contains(t.keys(s.STATUS_WEIGHTS),e))throw new Error("Invalid availability value. See https://xmpp.org/rfcs/rfc3921.html#rfc.section.2.2.2.1");"string"==typeof n&&(i.status_message=n),s.xmppstatus.sendPresence(e),s.xmppstatus.save(i)},message:{get:function(){return s.xmppstatus.get("status_message")},set:function(e){s.xmppstatus.save({status_message:e})}}}},settings:{get:function(e){if(t.contains(Object.keys(s.default_settings),e))return s[e]},set:function(e,n){var i={};"object"==typeof e?t.extend(s,t.pick(e,Object.keys(s.default_settings))):"string"==typeof e&&(i[e]=n,t.extend(s,t.pick(i,Object.keys(s.default_settings))))}},contacts:{get:function(e){var n=function(e){var t=s.roster.get(a.getBareJidFromJid(e));return t?t.attributes:null};if("undefined"==typeof e)e=s.roster.pluck("jid");else if("string"==typeof e)return n(e);return t.map(e,n)},add:function(e,n){if("string"!=typeof e||e.indexOf("@")<0)throw new TypeError("contacts.add: invalid jid");s.roster.addAndSubscribe(e,t.isEmpty(n)?e:n)}},chats:{open:function(e){var n;return"undefined"==typeof e?(s.log("chats.open: You need to provide at least one JID","error"),null):"string"==typeof e?n=s.wrappedChatBox(s.chatboxes.getChatBox(e,!0).trigger("show")):t.map(e,function(e){return n=s.wrappedChatBox(s.chatboxes.getChatBox(e,!0).trigger("show"))})},get:function(e){if("undefined"==typeof e){var n=[];return s.chatboxes.each(function(e){"chatroom"!==e.get("type")&&n.push(s.wrappedChatBox(e))}),n}return"string"==typeof e?s.wrappedChatBox(s.chatboxes.getChatBox(e)):t.map(e,t.partial(t.compose(s.wrappedChatBox.bind(s),s.chatboxes.getChatBox.bind(s.chatboxes)),t,!0))}},tokens:{get:function(e){return s.expose_rid_and_sid&&"undefined"!=typeof s.connection?"rid"===e.toLowerCase()?s.connection.rid||s.connection._proto.rid:"sid"===e.toLowerCase()?s.connection.sid||s.connection._proto.sid:void 0:null}},listen:{once:function(e,t,n){s.once(e,t,n)},on:function(e,t,n){s.on(e,t,n)},not:function(e,t){s.off(e,t)},stanza:function(e,t,n){"function"==typeof t?(n=t,t={}):t=t||{},s.connection.addHandler(n,t.ns,e,t.type,t.id,t.from,t)}},send:function(e){s.connection.send(e)},plugins:{add:function(e,t){t.__name__=e,s.pluggable.plugins[e]=t},remove:function(e){delete s.plugins[e]},override:function(e,t){s._overrideAttribute(e,t)},extend:function(e,t){s._extendObject(e,t)}},env:{$build:i.$build,$iq:i.$iq,$msg:i.$msg,$pres:i.$pres,Strophe:i.Strophe,b64_sha1:i.SHA1.b64_sha1,_:t,jQuery:e,moment:n,utils:o}}}),function(e,t){function n(e){return u.PF.compile(e||"nplurals=2; plural=(n != 1);")}function i(e,t){this._key=e,this._i18n=t}var o=Array.prototype,s=Object.prototype,a=o.slice,r=s.hasOwnProperty,l=o.forEach,c={},d={forEach:function(e,t,n){var i,o,s;if(null!==e)if(l&&e.forEach===l)e.forEach(t,n);else if(e.length===+e.length){for(i=0,o=e.length;i<o;i++)if(i in e&&t.call(n,e[i],i,e)===c)return}else for(s in e)if(r.call(e,s)&&t.call(n,e[s],s,e)===c)return},extend:function(e){return this.forEach(a.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e}},u=function(e){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages"},this.options=d.extend({},this.defaults,e),this.textdomain(this.options.domain),e.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+e.domain+"`")};u.context_delimiter=String.fromCharCode(4),d.extend(i.prototype,{onDomain:function(e){return this._domain=e,this},withContext:function(e){return this._context=e,this},ifPlural:function(e,t){return this._val=e,this._pkey=t,this},fetch:function(e){return"[object Array]"!={}.toString.call(e)&&(e=[].slice.call(arguments)),(e&&e.length?u.sprintf:function(e){return e})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),e)}}),d.extend(u.prototype,{translate:function(e){return new i(e,this)},textdomain:function(e){return e?void(this._textdomain=e):this._textdomain},gettext:function(e){return this.dcnpgettext.call(this,t,t,e)},dgettext:function(e,n){return this.dcnpgettext.call(this,e,t,n)},dcgettext:function(e,n){return this.dcnpgettext.call(this,e,t,n)},ngettext:function(e,n,i){return this.dcnpgettext.call(this,t,t,e,n,i)},dngettext:function(e,n,i,o){return this.dcnpgettext.call(this,e,t,n,i,o)},dcngettext:function(e,n,i,o){return this.dcnpgettext.call(this,e,t,n,i,o)},pgettext:function(e,n){return this.dcnpgettext.call(this,t,e,n)},dpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},dcpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},npgettext:function(e,n,i,o){return this.dcnpgettext.call(this,t,e,n,i,o)},dnpgettext:function(e,t,n,i,o){return this.dcnpgettext.call(this,e,t,n,i,o)},dcnpgettext:function(e,t,i,o,s){o=o||i,e=e||this._textdomain,s="undefined"==typeof s?1:s;var a;if(!this.options)return a=new u,a.dcnpgettext.call(a,void 0,void 0,i,o,s);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[e])throw new Error("Domain `"+e+"` was not found.");if(!this.options.locale_data[e][""])throw new Error("No locale meta information provided.");if(!i)throw new Error("No translation key found.");if("number"!=typeof s&&(s=parseInt(s,10),isNaN(s)))throw new Error("The number that was passed in is not a number.");var r,l,c=t?t+u.context_delimiter+i:i,d=this.options.locale_data,h=d[e],p=h[""].plural_forms||(d.messages||this.defaults.locale_data.messages)[""].plural_forms,_=n(p)(s)+1;if(!h)throw new Error("No domain named `"+e+"` could be found.");return r=h[c],!r||_>=r.length?(this.options.missing_key_callback&&this.options.missing_key_callback(c),l=[null,i,o],l[n(p)(s)+1]):(l=r[_],l?l:(l=[null,i,o],l[n(p)(s)+1]))}});var h=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,i){var o,s,a,r,l,c,d,u=1,p=n.length,_="",m=[];for(s=0;s<p;s++)if(_=e(n[s]),"string"===_)m.push(n[s]);else if("array"===_){if(r=n[s],r[2])for(o=i[u],a=0;a<r[2].length;a++){if(!o.hasOwnProperty(r[2][a]))throw h('[sprintf] property "%s" does not exist',r[2][a]);o=o[r[2][a]]}else o=r[1]?i[r[1]]:i[u++];if(/[^s]/.test(r[8])&&"number"!=e(o))throw h("[sprintf] expecting number but found %s",e(o));switch("undefined"!=typeof o&&null!==o||(o=""),r[8]){case"b":o=o.toString(2);break;case"c":o=String.fromCharCode(o);break;case"d":o=parseInt(o,10);break;case"e":o=r[7]?o.toExponential(r[7]):o.toExponential();break;case"f":o=r[7]?parseFloat(o).toFixed(r[7]):parseFloat(o);break;case"o":o=o.toString(8);break;case"s":o=(o=String(o))&&r[7]?o.substring(0,r[7]):o;break;case"u":o=Math.abs(o);break;case"x":o=o.toString(16);break;case"X":o=o.toString(16).toUpperCase()}o=/[def]/.test(r[8])&&r[3]&&o>=0?"+"+o:o,c=r[4]?"0"==r[4]?"0":r[4].charAt(1):" ",d=r[6]-String(o).length,l=r[6]?t(c,d):"",m.push(r[5]?o+l:l+o)}return m.join("")},n.cache={},n.parse=function(e){for(var t=e,n=[],i=[],o=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))i.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))i.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(n[2]){o|=1;var s=[],a=n[2],r=[];if(null===(r=/^([a-z_][a-z_\d]*)/i.exec(a)))throw"[sprintf] huh?";for(s.push(r[1]);""!==(a=a.substring(r[0].length));)if(null!==(r=/^\.([a-z_][a-z_\d]*)/i.exec(a)))s.push(r[1]);else{if(null===(r=/^\[(\d+)\]/.exec(a)))throw"[sprintf] huh?";s.push(r[1])}n[2]=s}else o|=2;if(3===o)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";i.push(n)}t=t.substring(n[0].length)}return i},n}(),p=function(e,t){return t.unshift(e),h.apply(null,t)};u.parse_plural=function(e,t){return e=e.replace(/n/g,t),u.parse_expression(e)},u.sprintf=function(e,t){return"[object Array]"=={}.toString.call(t)?p(e,[].slice.call(t)):h.apply(this,[].slice.call(arguments))},u.prototype.sprintf=function(){return u.sprintf.apply(this,arguments)},u.PF={},u.PF.parse=function(e){var t=u.PF.extractPluralExpr(e);return u.PF.parser.parse.call(u.PF.parser,t)},u.PF.compile=function(e){function t(e){return e===!0?1:e?e:0}var n=u.PF.parse(e);return function(e){return t(u.PF.interpreter(n)(e))}},u.PF.interpreter=function(e){return function(t){switch(e.type){case"GROUP":return u.PF.interpreter(e.expr)(t);case"TERNARY":return u.PF.interpreter(e.expr)(t)?u.PF.interpreter(e.truthy)(t):u.PF.interpreter(e.falsey)(t);
case"OR":return u.PF.interpreter(e.left)(t)||u.PF.interpreter(e.right)(t);case"AND":return u.PF.interpreter(e.left)(t)&&u.PF.interpreter(e.right)(t);case"LT":return u.PF.interpreter(e.left)(t)<u.PF.interpreter(e.right)(t);case"GT":return u.PF.interpreter(e.left)(t)>u.PF.interpreter(e.right)(t);case"LTE":return u.PF.interpreter(e.left)(t)<=u.PF.interpreter(e.right)(t);case"GTE":return u.PF.interpreter(e.left)(t)>=u.PF.interpreter(e.right)(t);case"EQ":return u.PF.interpreter(e.left)(t)==u.PF.interpreter(e.right)(t);case"NEQ":return u.PF.interpreter(e.left)(t)!=u.PF.interpreter(e.right)(t);case"MOD":return u.PF.interpreter(e.left)(t)%u.PF.interpreter(e.right)(t);case"VAR":return t;case"NUM":return e.val;default:throw new Error("Invalid Token found.")}}},u.PF.extractPluralExpr=function(e){e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(e)||(e=e.concat(";"));var t,n=/nplurals\=(\d+);/,i=/plural\=(.*);/,o=e.match(n),s={};if(!(o.length>1))throw new Error("nplurals not found in plural_forms string: "+e);if(s.nplurals=o[1],e=e.replace(n,""),t=e.match(i),!(t&&t.length>1))throw new Error("`plural` expression not found: "+e);return t[1]},u.PF.parser=function(){var e={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(e,t,n,i,o,s,a){var r=s.length-1;switch(o){case 1:return{type:"GROUP",expr:s[r-1]};case 2:this.$={type:"TERNARY",expr:s[r-4],truthy:s[r-2],falsey:s[r]};break;case 3:this.$={type:"OR",left:s[r-2],right:s[r]};break;case 4:this.$={type:"AND",left:s[r-2],right:s[r]};break;case 5:this.$={type:"LT",left:s[r-2],right:s[r]};break;case 6:this.$={type:"LTE",left:s[r-2],right:s[r]};break;case 7:this.$={type:"GT",left:s[r-2],right:s[r]};break;case 8:this.$={type:"GTE",left:s[r-2],right:s[r]};break;case 9:this.$={type:"NEQ",left:s[r-2],right:s[r]};break;case 10:this.$={type:"EQ",left:s[r-2],right:s[r]};break;case 11:this.$={type:"MOD",left:s[r-2],right:s[r]};break;case 12:this.$={type:"GROUP",expr:s[r-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(e)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(e,t){throw new Error(e)},parse:function(e){function t(e){o.length=o.length-2*e,s.length=s.length-e,a.length=a.length-e}function n(){var e;return e=i.lexer.lex()||1,"number"!=typeof e&&(e=i.symbols_[e]||e),e}var i=this,o=[0],s=[null],a=[],r=this.table,l="",c=0,d=0,u=0,h=2,p=1;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var _=this.lexer.yylloc;a.push(_),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var m,f,g,v,b,y,w,x,C,k={};;){if(g=o[o.length-1],this.defaultActions[g]?v=this.defaultActions[g]:(null==m&&(m=n()),v=r[g]&&r[g][m]),"undefined"==typeof v||!v.length||!v[0]){if(!u){C=[];for(y in r[g])this.terminals_[y]&&y>2&&C.push("'"+this.terminals_[y]+"'");var S="";S=this.lexer.showPosition?"Parse error on line "+(c+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+C.join(", ")+", got '"+this.terminals_[m]+"'":"Parse error on line "+(c+1)+": Unexpected "+(1==m?"end of input":"'"+(this.terminals_[m]||m)+"'"),this.parseError(S,{text:this.lexer.match,token:this.terminals_[m]||m,line:this.lexer.yylineno,loc:_,expected:C})}if(3==u){if(m==p)throw new Error(S||"Parsing halted.");d=this.lexer.yyleng,l=this.lexer.yytext,c=this.lexer.yylineno,_=this.lexer.yylloc,m=n()}for(;;){if(h.toString()in r[g])break;if(0==g)throw new Error(S||"Parsing halted.");t(1),g=o[o.length-1]}f=m,m=h,g=o[o.length-1],v=r[g]&&r[g][h],u=3}if(v[0]instanceof Array&&v.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+m);switch(v[0]){case 1:o.push(m),s.push(this.lexer.yytext),a.push(this.lexer.yylloc),o.push(v[1]),m=null,f?(m=f,f=null):(d=this.lexer.yyleng,l=this.lexer.yytext,c=this.lexer.yylineno,_=this.lexer.yylloc,u>0&&u--);break;case 2:if(w=this.productions_[v[1]][1],k.$=s[s.length-w],k._$={first_line:a[a.length-(w||1)].first_line,last_line:a[a.length-1].last_line,first_column:a[a.length-(w||1)].first_column,last_column:a[a.length-1].last_column},b=this.performAction.call(k,l,d,c,this.yy,v[1],s,a),"undefined"!=typeof b)return b;w&&(o=o.slice(0,-1*w*2),s=s.slice(0,-1*w),a=a.slice(0,-1*w)),o.push(this.productions_[v[1]][0]),s.push(k.$),a.push(k._$),x=r[o[o.length-2]][o[o.length-1]],o.push(x);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parseError)throw new Error(e);this.yy.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e;var t=e.match(/\n/);return t&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n;this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),o=0;o<i.length;o++)if(t=this._input.match(this.rules[i[o]]))return n=t[0].match(/\n.*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-1:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,i[o],this.conditionStack[this.conditionStack.length-1]),e?e:void 0;return""===this._input?this.EOF:void this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return"undefined"!=typeof e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)}};return e.performAction=function(e,t,n,i){switch(n){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},e.rules=[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],e.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}},e}();return e.lexer=t,e}(),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=u),exports.Jed=u):("function"==typeof define&&define.amd&&define("jed",[],function(){return u}),e.Jed=u)}(this),define("text!ca",[],function(){return'{\n   "domain": "converse",\n   "locale_data": {\n      "converse": {\n         "": {\n            "domain": "converse",\n            "plural_forms": "nplurals=2; plural=(n != 1);",\n            "lang": "ca"\n         },\n         "Bookmark this room": [\n            null,\n            ""\n         ],\n         "The name for this bookmark:": [\n            null,\n            ""\n         ],\n         "Would you like this room to be automatically joined upon startup?": [\n            null,\n            ""\n         ],\n         "What should your nickname for this room be?": [\n            null,\n            ""\n         ],\n         "Save": [\n            null,\n            "Desa"\n         ],\n         "Cancel": [\n            null,\n            "Cancel·la"\n         ],\n         "Bookmarked Rooms": [\n            null,\n            ""\n         ],\n         "Click to open this room": [\n            null,\n            "Feu clic per obrir aquesta sala"\n         ],\n         "Show more information on this room": [\n            null,\n            "Mostra més informació d\'aquesta sala"\n         ],\n         "Remove this bookmark": [\n            null,\n            ""\n         ],\n         "Close this chat box": [\n            null,\n            "Tanca aquest quadre del xat"\n         ],\n         "Personal message": [\n            null,\n            "Missatge personal"\n         ],\n         "me": [\n            null,\n            "jo"\n         ],\n         "A very large message has been received.This might be due to an attack meant to degrade the chat performance.Output has been shortened.": [\n            null,\n            ""\n         ],\n         "is typing": [\n            null,\n            "està escrivint"\n         ],\n         "has stopped typing": [\n            null,\n            "ha deixat d\'escriure"\n         ],\n         "has gone away": [\n            null,\n            "ha marxat"\n         ],\n         "Show this menu": [\n            null,\n            "Mostra aquest menú"\n         ],\n         "Write in the third person": [\n            null,\n            "Escriu en tercera persona"\n         ],\n         "Remove messages": [\n            null,\n            "Elimina els missatges"\n         ],\n         "Are you sure you want to clear the messages from this chat box?": [\n            null,\n            "Segur que voleu esborrar els missatges d\'aquest quadre del xat?"\n         ],\n         "has gone offline": [\n            null,\n            "s\'ha desconnectat"\n         ],\n         "is busy": [\n            null,\n            "està ocupat"\n         ],\n         "Clear all messages": [\n            null,\n            "Esborra tots els missatges"\n         ],\n         "Insert a smiley": [\n            null,\n            "Insereix una cara somrient"\n         ],\n         "Start a call": [\n            null,\n            "Inicia una trucada"\n         ],\n         "Contacts": [\n            null,\n            "Contactes"\n         ],\n         "Connecting": [\n            null,\n            "S\'està establint la connexió"\n         ],\n         "XMPP Username:": [\n            null,\n            "Nom d\'usuari XMPP:"\n         ],\n         "Password:": [\n            null,\n            "Contrasenya:"\n         ],\n         "Click here to log in anonymously": [\n            null,\n            "Feu clic aquí per iniciar la sessió de manera anònima"\n         ],\n         "Log In": [\n            null,\n            "Inicia la sessió"\n         ],\n         "user@server": [\n            null,\n            "usuari@servidor"\n         ],\n         "password": [\n            null,\n            "contrasenya"\n         ],\n         "Sign in": [\n            null,\n            "Inicia la sessió"\n         ],\n         "I am %1$s": [\n            null,\n            "Estic %1$s"\n         ],\n         "Click here to write a custom status message": [\n            null,\n            "Feu clic aquí per escriure un missatge d\'estat personalitzat"\n         ],\n         "Click to change your chat status": [\n            null,\n            "Feu clic per canviar l\'estat del xat"\n         ],\n         "Custom status": [\n            null,\n            "Estat personalitzat"\n         ],\n         "online": [\n            null,\n            "en línia"\n         ],\n         "busy": [\n            null,\n            "ocupat"\n         ],\n         "away for long": [\n            null,\n            "absent durant una estona"\n         ],\n         "away": [\n            null,\n            "absent"\n         ],\n         "offline": [\n            null,\n            "desconnectat"\n         ],\n         "Online": [\n            null,\n            "En línia"\n         ],\n         "Busy": [\n            null,\n            "Ocupat"\n         ],\n         "Away": [\n            null,\n            "Absent"\n         ],\n         "Offline": [\n            null,\n            "Desconnectat"\n         ],\n         "Log out": [\n            null,\n            "Tanca la sessió"\n         ],\n         "Contact name": [\n            null,\n            "Nom del contacte"\n         ],\n         "Search": [\n            null,\n            "Cerca"\n         ],\n         "Add": [\n            null,\n            "Afegeix"\n         ],\n         "Click to add new chat contacts": [\n            null,\n            "Feu clic per afegir contactes nous al xat"\n         ],\n         "Add a contact": [\n            null,\n            "Afegeix un contacte"\n         ],\n         "No users found": [\n            null,\n            "No s\'ha trobat cap usuari"\n         ],\n         "Click to add as a chat contact": [\n            null,\n            "Feu clic per afegir com a contacte del xat"\n         ],\n         "Toggle chat": [\n            null,\n            "Canvia de xat"\n         ],\n         "Click to hide these contacts": [\n            null,\n            "Feu clic per amagar aquests contactes"\n         ],\n         "The connection has dropped, attempting to reconnect.": [\n            null,\n            ""\n         ],\n         "Disconnected": [\n            null,\n            ""\n         ],\n         "The connection to the chat server has dropped": [\n            null,\n            ""\n         ],\n         "Authenticating": [\n            null,\n            "S\'està efectuant l\'autenticació"\n         ],\n         "Authentication Failed": [\n            null,\n            "Error d\'autenticació"\n         ],\n         "Sorry, there was an error while trying to add ": [\n            null,\n            "S\'ha produït un error en intentar afegir "\n         ],\n         "This client does not allow presence subscriptions": [\n            null,\n            "Aquest client no admet les subscripcions de presència"\n         ],\n         "Click to restore this chat": [\n            null,\n            "Feu clic per restaurar aquest xat"\n         ],\n         "Minimized": [\n            null,\n            "Minimitzat"\n         ],\n         "Minimize this chat box": [\n            null,\n            "Minimitza aquest quadre del xat"\n         ],\n         "Message": [\n            null,\n            "Missatge"\n         ],\n         "Hide the list of occupants": [\n            null,\n            "Amaga la llista d\'ocupants"\n         ],\n         "Error: could not execute the command": [\n            null,\n            "Error: no s\'ha pogut executar l\'ordre"\n         ],\n         "Error: the \\"": [\n            null,\n            "Error: el \\""\n         ],\n         "Are you sure you want to clear the messages from this room?": [\n            null,\n            "Segur que voleu esborrar els missatges d\'aquesta sala?"\n         ],\n         "Change user\'s affiliation to admin": [\n            null,\n            "Canvia l\'afiliació de l\'usuari a administrador"\n         ],\n         "Ban user from room": [\n            null,\n            "Expulsa l\'usuari de la sala"\n         ],\n         "Change user role to occupant": [\n            null,\n            "Canvia el rol de l\'usuari a ocupant"\n         ],\n         "Kick user from room": [\n            null,\n            "Expulsa l\'usuari de la sala"\n         ],\n         "Write in 3rd person": [\n            null,\n            "Escriu en tercera persona"\n         ],\n         "Grant membership to a user": [\n            null,\n            "Atorga una afiliació a un usuari"\n         ],\n         "Remove user\'s ability to post messages": [\n            null,\n            "Elimina la capacitat de l\'usuari de publicar missatges"\n         ],\n         "Change your nickname": [\n            null,\n            "Canvieu el vostre àlies"\n         ],\n         "Grant moderator role to user": [\n            null,\n            "Atorga el rol de moderador a l\'usuari"\n         ],\n         "Grant ownership of this room": [\n            null,\n            "Atorga la propietat d\'aquesta sala"\n         ],\n         "Revoke user\'s membership": [\n            null,\n            "Revoca l\'afiliació de l\'usuari"\n         ],\n         "Set room topic": [\n            null,\n            "Defineix un tema per a la sala"\n         ],\n         "Allow muted user to post messages": [\n            null,\n            "Permet que un usuari silenciat publiqui missatges"\n         ],\n         "An error occurred while trying to save the form.": [\n            null,\n            "S\'ha produït un error en intentar desar el formulari."\n         ],\n         "The nickname you chose is reserved or currently in use, please choose a different one.": [\n            null,\n            ""\n         ],\n         "Nickname": [\n            null,\n            "Àlies"\n         ],\n         "This chatroom requires a password": [\n            null,\n            "Aquesta sala de xat requereix una contrasenya"\n         ],\n         "Password: ": [\n            null,\n            "Contrasenya:"\n         ],\n         "Submit": [\n            null,\n            "Envia"\n         ],\n         "This room is not anonymous": [\n            null,\n            "Aquesta sala no és anònima"\n         ],\n         "This room now shows unavailable members": [\n            null,\n            "Aquesta sala ara mostra membres no disponibles"\n         ],\n         "This room does not show unavailable members": [\n            null,\n            "Aquesta sala no mostra membres no disponibles"\n         ],\n         "Non-privacy-related room configuration has changed": [\n            null,\n            "S\'ha canviat la configuració de la sala no relacionada amb la privadesa"\n         ],\n         "Room logging is now enabled": [\n            null,\n            "El registre de la sala està habilitat"\n         ],\n         "Room logging is now disabled": [\n            null,\n            "El registre de la sala està deshabilitat"\n         ],\n         "This room is now non-anonymous": [\n            null,\n            "Aquesta sala ara no és anònima"\n         ],\n         "This room is now semi-anonymous": [\n            null,\n            "Aquesta sala ara és parcialment anònima"\n         ],\n         "This room is now fully-anonymous": [\n            null,\n            "Aquesta sala ara és totalment anònima"\n         ],\n         "A new room has been created": [\n            null,\n            "S\'ha creat una sala nova"\n         ],\n         "You have been banned from this room": [\n            null,\n            "Se us ha expulsat d\'aquesta sala"\n         ],\n         "You have been kicked from this room": [\n            null,\n            "Se us ha expulsat d\'aquesta sala"\n         ],\n         "You have been removed from this room because of an affiliation change": [\n            null,\n            "Se us ha eliminat d\'aquesta sala a causa d\'un canvi d\'afiliació"\n         ],\n         "You have been removed from this room because the room has changed to members-only and you\'re not a member": [\n            null,\n            "Se us ha eliminat d\'aquesta sala perquè ara només permet membres i no en sou membre"\n         ],\n         "You have been removed from this room because the MUC (Multi-user chat) service is being shut down.": [\n            null,\n            "Se us ha eliminat d\'aquesta sala perquè s\'està tancant el servei MUC (xat multiusuari)."\n         ],\n         "<strong>%1$s</strong> has been banned": [\n            null,\n            "S\'ha expulsat <strong>%1$s</strong>"\n         ],\n         "<strong>%1$s</strong>\'s nickname has changed": [\n            null,\n            "L\'àlies de <strong>%1$s</strong> ha canviat"\n         ],\n         "<strong>%1$s</strong> has been kicked out": [\n            null,\n            "S\'ha expulsat <strong>%1$s</strong>"\n         ],\n         "<strong>%1$s</strong> has been removed because of an affiliation change": [\n            null,\n            "S\'ha eliminat <strong>%1$s</strong> a causa d\'un canvi d\'afiliació"\n         ],\n         "<strong>%1$s</strong> has been removed for not being a member": [\n            null,\n            "S\'ha eliminat <strong>%1$s</strong> perquè no és membre"\n         ],\n         "Your nickname has been changed to: <strong>%1$s</strong>": [\n            null,\n            "El vostre àlies ha canviat a: <strong>%1$s</strong>"\n         ],\n         "The reason given is: \\"": [\n            null,\n            "El motiu indicat és: \\""\n         ],\n         "You are not on the member list of this room": [\n            null,\n            "No sou a la llista de membres d\'aquesta sala"\n         ],\n         "No nickname was specified": [\n            null,\n            "No s\'ha especificat cap àlies"\n         ],\n         "You are not allowed to create new rooms": [\n            null,\n            "No teniu permís per crear sales noves"\n         ],\n         "Your nickname doesn\'t conform to this room\'s policies": [\n            null,\n            "El vostre àlies no s\'ajusta a les polítiques d\'aquesta sala"\n         ],\n         "This room does not (yet) exist": [\n            null,\n            "Aquesta sala (encara) no existeix"\n         ],\n         "Topic set by %1$s to: %2$s": [\n            null,\n            "Tema definit per %1$s en: %2$s"\n         ],\n         "Occupants": [\n            null,\n            "Ocupants"\n         ],\n         "You are about to invite %1$s to the chat room \\"%2$s\\". ": [\n            null,\n            "Esteu a punt de convidar %1$s a la sala de xat \\"%2$s\\". "\n         ],\n         "You may optionally include a message, explaining the reason for the invitation.": [\n            null,\n            "Teniu l\'opció d\'incloure un missatge per explicar el motiu de la invitació."\n         ],\n         "Room name": [\n            null,\n            "Nom de la sala"\n         ],\n         "Server": [\n            null,\n            "Servidor"\n         ],\n         "Join Room": [\n            null,\n            "Uneix-me a la sala"\n         ],\n         "Show rooms": [\n            null,\n            "Mostra les sales"\n         ],\n         "Rooms": [\n            null,\n            "Sales"\n         ],\n         "No rooms on %1$s": [\n            null,\n            "No hi ha cap sala a %1$s"\n         ],\n         "Rooms on %1$s": [\n            null,\n            "Sales a %1$s"\n         ],\n         "Description:": [\n            null,\n            "Descripció:"\n         ],\n         "Occupants:": [\n            null,\n            "Ocupants:"\n         ],\n         "Features:": [\n            null,\n            "Característiques:"\n         ],\n         "Requires authentication": [\n            null,\n            "Cal autenticar-se"\n         ],\n         "Hidden": [\n            null,\n            "Amagat"\n         ],\n         "Requires an invitation": [\n            null,\n            "Cal tenir una invitació"\n         ],\n         "Moderated": [\n            null,\n            "Moderada"\n         ],\n         "Non-anonymous": [\n            null,\n            "No és anònima"\n         ],\n         "Open room": [\n            null,\n            "Obre la sala"\n         ],\n         "Permanent room": [\n            null,\n            "Sala permanent"\n         ],\n         "Public": [\n            null,\n            "Pública"\n         ],\n         "Semi-anonymous": [\n            null,\n            "Semianònima"\n         ],\n         "Temporary room": [\n            null,\n            "Sala temporal"\n         ],\n         "Unmoderated": [\n            null,\n            "No moderada"\n         ],\n         "%1$s has invited you to join a chat room: %2$s": [\n            null,\n            "%1$s us ha convidat a unir-vos a una sala de xat: %2$s"\n         ],\n         "%1$s has invited you to join a chat room: %2$s, and left the following reason: \\"%3$s\\"": [\n            null,\n            "%1$s us ha convidat a unir-vos a una sala de xat (%2$s) i ha deixat el següent motiu: \\"%3$s\\""\n         ],\n         "Notification from %1$s": [\n            null,\n            ""\n         ],\n         "%1$s says": [\n            null,\n            ""\n         ],\n         "wants to be your contact": [\n            null,\n            ""\n         ],\n         "Re-establishing encrypted session": [\n            null,\n            "S\'està tornant a establir la sessió xifrada"\n         ],\n         "Generating private key.": [\n            null,\n            "S\'està generant la clau privada"\n         ],\n         "Your browser might become unresponsive.": [\n            null,\n            "És possible que el navegador no respongui."\n         ],\n         "Authentication request from %1$s\\n\\nYour chat contact is attempting to verify your identity, by asking you the question below.\\n\\n%2$s": [\n            null,\n            "Sol·licitud d\'autenticació de %1$s\\n\\nEl contacte del xat està intentant verificar la vostra identitat mitjançant la pregunta següent.\\n\\n%2$s"\n         ],\n         "Could not verify this user\'s identify.": [\n            null,\n            "No s\'ha pogut verificar la identitat d\'aquest usuari."\n         ],\n         "Exchanging private key with contact.": [\n            null,\n            "S\'està intercanviant la clau privada amb el contacte."\n         ],\n         "Your messages are not encrypted anymore": [\n            null,\n            "Els vostres missatges ja no estan xifrats"\n         ],\n         "Your messages are now encrypted but your contact\'s identity has not been verified.": [\n            null,\n            "Ara, els vostres missatges estan xifrats, però no s\'ha verificat la identitat del contacte."\n         ],\n         "Your contact\'s identify has been verified.": [\n            null,\n            "S\'ha verificat la identitat del contacte."\n         ],\n         "Your contact has ended encryption on their end, you should do the same.": [\n            null,\n            "El contacte ha conclòs el xifratge; cal que feu el mateix."\n         ],\n         "Your message could not be sent": [\n            null,\n            "No s\'ha pogut enviar el missatge"\n         ],\n         "We received an unencrypted message": [\n            null,\n            "Hem rebut un missatge sense xifrar"\n         ],\n         "We received an unreadable encrypted message": [\n            null,\n            "Hem rebut un missatge xifrat il·legible"\n         ],\n         "Here are the fingerprints, please confirm them with %1$s, outside of this chat.\\n\\nFingerprint for you, %2$s: %3$s\\n\\nFingerprint for %1$s: %4$s\\n\\nIf you have confirmed that the fingerprints match, click OK, otherwise click Cancel.": [\n            null,\n            "Aquí es mostren les empremtes. Confirmeu-les amb %1$s fora d\'aquest xat.\\n\\nEmpremta de l\'usuari %2$s: %3$s\\n\\nEmpremta de %1$s: %4$s\\n\\nSi heu confirmat que les empremtes coincideixen, feu clic a D\'acord; en cas contrari, feu clic a Cancel·la."\n         ],\n         "You will be prompted to provide a security question and then an answer to that question.\\n\\nYour contact will then be prompted the same question and if they type the exact same answer (case sensitive), their identity will be verified.": [\n            null,\n            "Se us demanarà que indiqueu una pregunta de seguretat i la resposta corresponent.\\n\\nEs farà la mateixa pregunta al vostre contacte i, si escriu exactament la mateixa resposta (es distingeix majúscules de minúscules), se\'n verificarà la identitat."\n         ],\n         "What is your security question?": [\n            null,\n            "Quina és la vostra pregunta de seguretat?"\n         ],\n         "What is the answer to the security question?": [\n            null,\n            "Quina és la resposta a la pregunta de seguretat?"\n         ],\n         "Invalid authentication scheme provided": [\n            null,\n            "S\'ha indicat un esquema d\'autenticació no vàlid"\n         ],\n         "Your messages are not encrypted. Click here to enable OTR encryption.": [\n            null,\n            "Els vostres missatges no estan xifrats. Feu clic aquí per habilitar el xifratge OTR."\n         ],\n         "Your messages are encrypted, but your contact has not been verified.": [\n            null,\n            "Els vostres missatges estan xifrats, però no s\'ha verificat el contacte."\n         ],\n         "Your messages are encrypted and your contact verified.": [\n            null,\n            "Els vostres missatges estan xifrats i s\'ha verificat el contacte."\n         ],\n         "Your contact has closed their end of the private session, you should do the same": [\n            null,\n            "El vostre contacte ha tancat la seva sessió privada; cal que feu el mateix."\n         ],\n         "End encrypted conversation": [\n            null,\n            "Finalitza la conversa xifrada"\n         ],\n         "Refresh encrypted conversation": [\n            null,\n            "Actualitza la conversa xifrada"\n         ],\n         "Start encrypted conversation": [\n            null,\n            "Comença la conversa xifrada"\n         ],\n         "Verify with fingerprints": [\n            null,\n            "Verifica amb empremtes"\n         ],\n         "Verify with SMP": [\n            null,\n            "Verifica amb SMP"\n         ],\n         "What\'s this?": [\n            null,\n            "Què és això?"\n         ],\n         "unencrypted": [\n            null,\n            "sense xifrar"\n         ],\n         "unverified": [\n            null,\n            "sense verificar"\n         ],\n         "verified": [\n            null,\n            "verificat"\n         ],\n         "finished": [\n            null,\n            "acabat"\n         ],\n         " e.g. conversejs.org": [\n            null,\n            "p. ex. conversejs.org"\n         ],\n         "Your XMPP provider\'s domain name:": [\n            null,\n            "Nom de domini del vostre proveïdor XMPP:"\n         ],\n         "Fetch registration form": [\n            null,\n            "Obtingues un formulari de registre"\n         ],\n         "Tip: A list of public XMPP providers is available": [\n            null,\n            "Consell: hi ha disponible una llista de proveïdors XMPP públics"\n         ],\n         "here": [\n            null,\n            "aquí"\n         ],\n         "Register": [\n            null,\n            "Registre"\n         ],\n         "Sorry, the given provider does not support in band account registration. Please try with a different provider.": [\n            null,\n            "El proveïdor indicat no admet el registre del compte. Proveu-ho amb un altre proveïdor."\n         ],\n         "Requesting a registration form from the XMPP server": [\n            null,\n            "S\'està sol·licitant un formulari de registre del servidor XMPP"\n         ],\n         "Something went wrong while establishing a connection with \\"%1$s\\". Are you sure it exists?": [\n            null,\n            "Ha passat alguna cosa mentre s\'establia la connexió amb \\"%1$s\\". Segur que existeix?"\n         ],\n         "Now logging you in": [\n            null,\n            "S\'està iniciant la vostra sessió"\n         ],\n         "Registered successfully": [\n            null,\n            "Registre correcte"\n         ],\n         "Return": [\n            null,\n            "Torna"\n         ],\n         "The provider rejected your registration attempt. Please check the values you entered for correctness.": [\n            null,\n            "El proveïdor ha rebutjat l\'intent de registre. Comproveu que els valors que heu introduït siguin correctes."\n         ],\n         "This contact is busy": [\n            null,\n            "Aquest contacte està ocupat"\n         ],\n         "This contact is online": [\n            null,\n            "Aquest contacte està en línia"\n         ],\n         "This contact is offline": [\n            null,\n            "Aquest contacte està desconnectat"\n         ],\n         "This contact is unavailable": [\n            null,\n            "Aquest contacte no està disponible"\n         ],\n         "This contact is away for an extended period": [\n            null,\n            "Aquest contacte està absent durant un període prolongat"\n         ],\n         "This contact is away": [\n            null,\n            "Aquest contacte està absent"\n         ],\n         "Groups": [\n            null,\n            "Grups"\n         ],\n         "My contacts": [\n            null,\n            "Els meus contactes"\n         ],\n         "Pending contacts": [\n            null,\n            "Contactes pendents"\n         ],\n         "Contact requests": [\n            null,\n            "Sol·licituds de contacte"\n         ],\n         "Ungrouped": [\n            null,\n            "Sense agrupar"\n         ],\n         "Filter": [\n            null,\n            ""\n         ],\n         "State": [\n            null,\n            ""\n         ],\n         "Any": [\n            null,\n            ""\n         ],\n         "Chatty": [\n            null,\n            ""\n         ],\n         "Extended Away": [\n            null,\n            ""\n         ],\n         "Click to remove this contact": [\n            null,\n            "Feu clic per eliminar aquest contacte"\n         ],\n         "Click to accept this contact request": [\n            null,\n            "Feu clic per acceptar aquesta sol·licitud de contacte"\n         ],\n         "Click to decline this contact request": [\n            null,\n            "Feu clic per rebutjar aquesta sol·licitud de contacte"\n         ],\n         "Click to chat with this contact": [\n            null,\n            "Feu clic per conversar amb aquest contacte"\n         ],\n         "Name": [\n            null,\n            "Nom"\n         ],\n         "Are you sure you want to remove this contact?": [\n            null,\n            "Segur que voleu eliminar aquest contacte?"\n         ],\n         "Sorry, there was an error while trying to remove ": [\n            null,\n            "S\'ha produït un error en intentar eliminar "\n         ],\n         "Are you sure you want to decline this contact request?": [\n            null,\n            "Segur que voleu rebutjar aquesta sol·licitud de contacte?"\n         ]\n      }\n   }\n}';
}),define("tpl!chatbox",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="flyout box-flyout">\n    <div class="dragresize dragresize-top"></div>\n    <div class="dragresize dragresize-topleft"></div>\n    <div class="dragresize dragresize-left"></div>\n    <div class="chat-head chat-head-chatbox">\n        <a class="chatbox-btn close-chatbox-button icon-close" title="'+(null==(__t=info_close)?"":__t)+'"></a>\n        <div class="chat-title">\n            ',url&&(__p+='\n                <a href="'+(null==(__t=url)?"":__t)+'" target="_blank" rel="noopener" class="user">\n            '),__p+="\n                    "+(null==(__t=title)?"":__t)+"\n            ",url&&(__p+="\n                </a>\n            "),__p+='\n            <p class="user-custom-message"><p/>\n        </div>\n    </div>\n    <div class="chat-body">\n        <div class="chat-content"></div>\n        <div class="new-msgs-indicator hidden">▼ '+(null==(__t=unread_msgs)?"":__t)+" ▼</div>\n        ",show_textarea&&(__p+='\n        <form class="sendXMPPMessage" action="" method="post">\n            ',show_toolbar&&(__p+='\n                <ul class="chat-toolbar no-text-select"></ul>\n            '),__p+='\n        <textarea\n            type="text"\n            class="chat-textarea"\n            placeholder="'+(null==(__t=label_personal_message)?"":__t)+'"/>\n        </form>\n        '),__p+="\n    </div>\n</div>\n";return __p}}),define("tpl!new_day",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<time class="chat-info chat-date" data-isodate="'+(null==(__t=isodate)?"":__t)+'">'+(null==(__t=datestring)?"":__t)+"</time>\n";return __p}}),define("tpl!action",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chat-message '+(null==(__t=extra_classes)?"":__t)+'" data-isodate="'+(null==(__t=isodate)?"":__t)+'">\n    <span class="chat-msg-author chat-msg-'+(null==(__t=sender)?"":__t)+'">'+(null==(__t=time)?"":__t)+" **"+(null==(__t=username)?"":__t)+' </span>\n    <span class="chat-msg-content"><!-- message gets added here via renderMessage --></span>\n</div>\n';return __p}}),define("tpl!message",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chat-message '+(null==(__t=extra_classes)?"":__t)+'" data-isodate="'+(null==(__t=isodate)?"":__t)+'" data-msgid="'+(null==(__t=msgid)?"":__t)+'">\n    <span class="chat-msg-author chat-msg-'+(null==(__t=sender)?"":__t)+'">'+(null==(__t=time)?"":__t)+" "+(null==(__t=username)?"":__t)+':&nbsp;</span>\n    <span class="chat-msg-content"><!-- message gets added here via renderMessage --></span>\n</div>\n';return __p}}),define("tpl!toolbar",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",show_emoticons&&(__p+='\n    <li class="toggle-smiley icon-happy" title="'+(null==(__t=label_insert_smiley)?"":__t)+'">\n        <ul>\n            <li><a class="icon-smiley" href="#" data-emoticon=":)"></a></li>\n            <li><a class="icon-wink" href="#" data-emoticon=";)"></a></li>\n            <li><a class="icon-grin" href="#" data-emoticon=":D"></a></li>\n            <li><a class="icon-tongue" href="#" data-emoticon=":P"></a></li>\n            <li><a class="icon-cool" href="#" data-emoticon="8)"></a></li>\n            <li><a class="icon-evil" href="#" data-emoticon=">:)"></a></li>\n            <li><a class="icon-confused" href="#" data-emoticon=":S"></a></li>\n            <li><a class="icon-wondering" href="#" data-emoticon=":\\"></a></li>\n            <li><a class="icon-angry" href="#" data-emoticon=">:("></a></li>\n            <li><a class="icon-sad" href="#" data-emoticon=":("></a></li>\n            <li><a class="icon-shocked" href="#" data-emoticon=":O"></a></li>\n            <li><a class="icon-thumbs-up" href="#" data-emoticon="(^.^)b"></a></li>\n            <li><a class="icon-heart" href="#" data-emoticon="<3"></a></li>\n        </ul>\n    </li>\n'),__p+="\n",show_call_button&&(__p+='\n<li class="toggle-call"><a class="icon-phone" title="'+(null==(__t=label_start_call)?"":__t)+'"></a></li>\n'),__p+="\n",show_clear_button&&(__p+='\n<li class="toggle-clear"><a class="icon-remove" title="'+(null==(__t=label_clear)?"":__t)+'"></a></li>\n'),__p+="\n";return __p}}),define("tpl!avatar",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<canvas height="32px" width="32px" class="avatar"></canvas>\n';return __p}}),function(e,t){define("converse-chatview",["converse-core","converse-api","tpl!chatbox","tpl!new_day","tpl!action","tpl!message","tpl!toolbar","tpl!avatar"],t)}(this,function(e,t,n,i,o,s,a,r){"use strict";e.templates.chatbox=n,e.templates.new_day=i,e.templates.action=o,e.templates.message=s,e.templates.toolbar=a,e.templates.avatar=r;var l=t.env.jQuery,c=t.env.utils,d=t.env.Strophe,u=t.env.$msg,h=t.env._,p=c.__.bind(e),_=t.env.moment,m={ENTER:13,FORWARD_SLASH:47};t.plugins.add("converse-chatview",{overrides:{ChatBoxViews:{onChatBoxAdded:function(t){var n=this.get(t.get("id"));return n?this.__super__.onChatBoxAdded.apply(this,arguments):(n=new e.ChatBoxView({model:t}),this.add(t.get("id"),n),n)}}},initialize:function(){this.updateSettings({show_toolbar:!0,chatview_avatar_width:32,chatview_avatar_height:32,visible_toolbar_buttons:{emoticons:!0,call:!1,clear:!0}}),e.ChatBoxView=Backbone.View.extend({length:200,tagName:"div",className:"chatbox hidden",is_chatroom:!1,events:{"click .close-chatbox-button":"close","keypress .chat-textarea":"keyPressed","click .toggle-smiley":"toggleEmoticonMenu","click .toggle-smiley ul li":"insertEmoticon","click .toggle-clear":"clearMessages","click .toggle-call":"toggleCall","click .new-msgs-indicator":"viewUnreadMessages"},initialize:function(){this.model.messages.on("add",this.onMessageAdded,this),this.model.on("show",this.show,this),this.model.on("destroy",this.hide,this),this.model.on("change:chat_state",this.sendChatState,this),this.model.on("change:chat_status",this.onChatStatusChanged,this),this.model.on("change:image",this.renderAvatar,this),this.model.on("change:status",this.onStatusChanged,this),this.model.on("showHelpMessages",this.showHelpMessages,this),this.model.on("sendMessage",this.sendMessage,this),this.render().fetchMessages().insertIntoDOM(),this.$el.find(".chat-content").on("scroll",this.markScrolled.bind(this)),e.emit("chatBoxInitialized",this)},render:function(){return this.$el.attr("id",this.model.get("box_id")).html(e.templates.chatbox(h.extend(this.model.toJSON(),{show_toolbar:e.show_toolbar,show_textarea:!0,title:this.model.get("fullname"),unread_msgs:p("You have unread messages"),info_close:p("Close this chat box"),label_personal_message:p("Personal message")}))),this.$content=this.$el.find(".chat-content"),this.renderToolbar().renderAvatar(),e.emit("chatBoxOpened",this),c.refreshWebkit(),this.showStatusMessage()},afterMessagesFetched:function(){},fetchMessages:function(){return this.model.messages.fetch({add:!0,success:this.afterMessagesFetched.bind(this)}),this},insertIntoDOM:function(){return l("#conversejs").prepend(this.$el),this},clearStatusNotification:function(){this.$content.find("div.chat-event").remove()},showStatusNotification:function(e,t,n){t||this.clearStatusNotification();var i=l('<div class="chat-info"></div>').text(e);n||i.addClass("chat-event"),this.$content.append(i),this.scrollDown()},addSpinner:function(){this.$content.first().hasClass("spinner")||this.$content.prepend('<span class="spinner"/>')},clearSpinner:function(){this.$content.children(":first").is("span.spinner")&&this.$content.children(":first").remove()},insertDayIndicator:function(t,n){var i=_(t).startOf("day"),o=n?this.$content.prepend:this.$content.append;o.call(this.$content,e.templates.new_day({isodate:i.format(),datestring:i.format("dddd MMM Do YYYY")}))},insertMessage:function(e,t){var n=this,i=t?this.$content.prepend:this.$content.append;h.compose(this.scrollDownMessageHeight.bind(this),function(e){return i.call(n.$content,e),e})(this.renderMessage(e))},showMessage:function(e){var t,n,i=this.$content.find(".chat-message:first"),o=i.data("isodate"),s=_(e.time)||_,a=this.$content.find(".chat-message:last").data("isodate");return o?s.isAfter(a)||s.isSame(a)?(s.isAfter(a,"day")&&this.insertDayIndicator(s),void this.insertMessage(e)):s.isBefore(o)||s.isSame(o)?(this.insertMessage(e,"prepend"),void(s.isBefore(o,"day")&&this.insertDayIndicator(s,"prepend"))):(s=s.format(),t=h.map(this.$content.find(".chat-message"),function(e){return l(e).data("isodate")}),t.push(s),t.sort(),n=t.indexOf(s)-1,void h.compose(this.scrollDownMessageHeight.bind(this),function(e){return e.insertAfter(this.$content.find('.chat-message[data-isodate="'+t[n]+'"]')),e}.bind(this))(this.renderMessage(e))):(this.insertDayIndicator(s),void this.insertMessage(e))},getExtraMessageTemplateAttributes:function(e){return{}},renderMessage:function(t){var n,i,o=_(t.time)||_,s=t.message,a=s.match(/^\/(.*?)(?: (.*))?$/),r=this.model.get("fullname")||t.fullname,c=t.delayed&&"delayed"||"";a&&"me"===a[1]?(s=s.replace(/^\/me/,""),n=e.templates.action,i=r):(n=e.templates.message,i="me"===t.sender&&p("me")||r),this.$content.find("div.chat-event").remove(),this.is_chatroom&&"them"===t.sender&&new RegExp("\\b"+this.model.get("nick")+"\\b").test(s)&&(c+=" mentioned"),s.length>8e3&&(s=s.substring(0,10)+"...",this.showStatusNotification(p("A very large message has been received.This might be due to an attack meant to degrade the chat performance.Output has been shortened."),!0,!0));var d=l(n(h.extend(this.getExtraMessageTemplateAttributes(t),{msgid:t.msgid,sender:t.sender,time:o.format("hh:mm"),isodate:o.format(),username:i,extra_classes:c})));return d.find(".chat-msg-content").first().text(s).addHyperlinks().addEmoticons(e.visible_toolbar_buttons.emoticons),d},showHelpMessages:function(e,t,n){var i,o=e.length;for(i=0;i<o;i++)this.$content.append(l('<div class="chat-'+(t||"info")+'">'+e[i]+"</div>"));return n===!0?this.$content.append('<span class="spinner"/>'):n===!1&&this.$content.find("span.spinner").remove(),this.scrollDown()},handleChatStateMessage:function(t){t.get("chat_state")===e.COMPOSING?(this.showStatusNotification(t.get("fullname")+" "+p("is typing")),this.clear_status_timeout=window.setTimeout(this.clearStatusNotification.bind(this),3e4)):t.get("chat_state")===e.PAUSED?this.showStatusNotification(t.get("fullname")+" "+p("has stopped typing")):h.contains([e.INACTIVE,e.ACTIVE],t.get("chat_state"))?this.$content.find("div.chat-event").remove():t.get("chat_state")===e.GONE&&this.showStatusNotification(t.get("fullname")+" "+p("has gone away"))},shouldShowOnTextMessage:function(){return!this.$el.is(":visible")},updateNewMessageIndicators:function(t){t.get("archive_id")||(this.model.get("scrolled",!0)&&this.$el.find(".new-msgs-indicator").removeClass("hidden"),("hidden"===e.windowState||this.model.get("scrolled",!0))&&e.incrementMsgCounter())},handleTextMessage:function(e){this.showMessage(h.clone(e.attributes)),"me"!==e.get("sender")?this.updateNewMessageIndicators(e):this.model.set("scrolled",!1),this.shouldShowOnTextMessage()?this.show():this.scrollDown()},handleErrorMessage:function(e){var t=l("[data-msgid="+e.get("msgid")+"]");t.length&&(t.after(l('<div class="chat-info chat-error"></div>').text(e.get("message"))),this.scrollDown())},onMessageAdded:function(e){"undefined"!=typeof this.clear_status_timeout&&(window.clearTimeout(this.clear_status_timeout),delete this.clear_status_timeout),"error"===e.get("type")?this.handleErrorMessage(e):e.get("message")?this.handleTextMessage(e):this.handleChatStateMessage(e)},createMessageStanza:function(t){return u({from:e.connection.jid,to:this.model.get("jid"),type:"chat",id:t.get("msgid")}).c("body").t(t.get("message")).up().c(e.ACTIVE,{xmlns:d.NS.CHATSTATES}).up()},sendMessage:function(t){var n=this.createMessageStanza(t);e.connection.send(n),e.forward_messages&&e.connection.send(u({to:e.bare_jid,type:"chat",id:t.get("msgid")}).c("forwarded",{xmlns:"urn:xmpp:forward:0"}).c("delay",{xmns:"urn:xmpp:delay",stamp:(new Date).getTime()}).up().cnode(n.tree()))},onMessageSubmitted:function(t){if(!e.connection.authenticated)return this.showHelpMessages(["Sorry, the connection has been lost, and your message could not be sent"],"error");var n,i=t.replace(/^\s*/,"").match(/^\/(.*)\s*$/);if(i){if("clear"===i[1])return this.clearMessages();if("help"===i[1])return n=["<strong>/help</strong>:"+p("Show this menu"),"<strong>/me</strong>:"+p("Write in the third person"),"<strong>/clear</strong>:"+p("Remove messages")],void this.showHelpMessages(n)}var o=e.xmppstatus.get("fullname");o=h.isEmpty(o)?e.bare_jid:o;var s=this.model.messages.create({fullname:o,sender:"me",time:_().format(),message:t});this.sendMessage(s)},sendChatState:function(){e.connection.send(u({to:this.model.get("jid"),type:"chat"}).c(this.model.get("chat_state"),{xmlns:d.NS.CHATSTATES}).up().c("no-store",{xmlns:d.NS.HINTS}).up().c("no-permanent-store",{xmlns:d.NS.HINTS}))},setChatState:function(t,n){return"undefined"!=typeof this.chat_state_timeout&&(window.clearTimeout(this.chat_state_timeout),delete this.chat_state_timeout),t===e.COMPOSING?this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),e.TIMEOUTS.PAUSED,e.PAUSED):t===e.PAUSED&&(this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),e.TIMEOUTS.INACTIVE,e.INACTIVE)),n||this.model.get("chat_state")===t||this.model.set("chat_state",t),this},keyPressed:function(t){var n,i=l(t.target);t.keyCode===m.ENTER?(t.preventDefault(),n=i.val(),i.val("").focus(),""!==n&&(this.onMessageSubmitted(n),e.emit("messageSend",n)),this.setChatState(e.ACTIVE)):this.setChatState(e.COMPOSING,t.keyCode===m.FORWARD_SLASH)},clearMessages:function(e){e&&e.preventDefault&&e.preventDefault();var t=confirm(p("Are you sure you want to clear the messages from this chat box?"));return t===!0&&(this.$content.empty(),this.model.messages.reset(),this.model.messages.browserStorage._clear()),this},insertIntoTextArea:function(e){var t=this.$el.find("textarea.chat-textarea"),n=t.val();n&&" "!==n[n.length-1]&&(n+=" "),t.focus().val(n+e+" ")},insertEmoticon:function(e){e.stopPropagation(),this.$el.find(".toggle-smiley ul").slideToggle(200);var t=l(e.target);t=t.is("a")?t:t.children("a"),this.insertIntoTextArea(t.data("emoticon"))},toggleEmoticonMenu:function(e){e.stopPropagation(),this.$el.find(".toggle-smiley ul").slideToggle(200)},toggleCall:function(t){t.stopPropagation(),e.emit("callButtonClicked",{connection:e.connection,model:this.model})},onChatStatusChanged:function(e){var t=e.get("chat_status"),n=e.get("fullname");n=h.isEmpty(n)?e.get("jid"):n,this.$el.is(":visible")&&("offline"===t?this.showStatusNotification(n+" "+p("has gone offline")):"away"===t?this.showStatusNotification(n+" "+p("has gone away")):"dnd"===t?this.showStatusNotification(n+" "+p("is busy")):"online"===t&&this.$el.find("div.chat-event").remove())},onStatusChanged:function(t){this.showStatusMessage(),e.emit("contactStatusMessageChanged",{contact:t.attributes,message:t.get("status")})},showStatusMessage:function(e){return e=e||this.model.get("status"),"string"==typeof e&&this.$el.find("p.user-custom-message").text(e).attr("title",e),this},close:function(t){return t&&t.preventDefault&&t.preventDefault(),e.connection.connected&&(this.model.set("chat_state",e.INACTIVE),this.sendChatState(),this.model.destroy()),this.remove(),e.emit("chatBoxClosed",this),this},getToolbarOptions:function(t){return h.extend(t||{},{label_clear:p("Clear all messages"),label_insert_smiley:p("Insert a smiley"),label_start_call:p("Start a call"),show_call_button:e.visible_toolbar_buttons.call,show_clear_button:e.visible_toolbar_buttons.clear,show_emoticons:e.visible_toolbar_buttons.emoticons})},renderToolbar:function(t,n){if(e.show_toolbar)return t=t||e.templates.toolbar,n=h.extend(this.model.toJSON(),this.getToolbarOptions(n||{})),this.$el.find(".chat-toolbar").html(t(n)),this},renderAvatar:function(){if(this.model.get("image")){var t=e.chatview_avatar_width,n=e.chatview_avatar_height,i="data:"+this.model.get("image_type")+";base64,"+this.model.get("image"),o=l(e.templates.avatar({width:t,height:n})).get(0);if(!o.getContext||!o.getContext("2d"))return this;var s=o.getContext("2d"),a=new Image;return a.onload=function(){var e=a.width/a.height;e<1?s.drawImage(a,0,0,t,n*(1/e)):s.drawImage(a,0,0,t,n*e)},a.src=i,this.$el.find(".chat-title").before(o),this}},focus:function(){return this.$el.find(".chat-textarea").focus(),e.emit("chatBoxFocused",this),this},hide:function(){return this.el.classList.add("hidden"),c.refreshWebkit(),this},afterShown:function(){e.connection.connected&&this.model.save(),this.setChatState(e.ACTIVE),this.scrollDown(),focus&&this.focus()},_show:function(e){return this.$el.is(":visible")&&"1"===this.$el.css("opacity")?void(e&&this.focus()):void c.fadeIn(this.el,this.afterShown.bind(this))},show:function(e){return"undefined"==typeof this.debouncedShow&&(this.debouncedShow=h.debounce(this._show,250,!0)),this.debouncedShow.apply(this,arguments),this},markScrolled:h.debounce(function(e){e&&e.preventDefault&&e.preventDefault();var t=this.$content.scrollTop()+this.$content.innerHeight()>=this.$content[0].scrollHeight-10;t?(this.model.set("scrolled",!1),this.$el.find(".new-msgs-indicator").addClass("hidden")):this.model.set("scrolled",!0)},150),viewUnreadMessages:function(){this.model.set("scrolled",!1),this.scrollDown()},scrollDownMessageHeight:function(e){return this.$content.is(":visible")&&!this.model.get("scrolled")&&this.$content.scrollTop(this.$content.scrollTop()+e[0].scrollHeight),this},scrollDown:function(){return this.$content.is(":visible")&&!this.model.get("scrolled")&&(this.$content.scrollTop(this.$content[0].scrollHeight),this.$el.find(".new-msgs-indicator").addClass("hidden")),this}})}})}),define("tpl!add_contact_dropdown",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<dl class="add-converse-contact dropdown">\n    <dt id="xmpp-contact-search" class="fancy-dropdown">\n        <a class="toggle-xmpp-contact-form icon-plus" href="#" title="'+(null==(__t=label_click_to_chat)?"":__t)+'"> '+(null==(__t=label_add_contact)?"":__t)+'</a>\n    </dt>\n    <dd class="search-xmpp"><ul></ul></dd>\n</dl>\n';return __p}}),define("tpl!add_contact_form",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li>\n    <form class="pure-form add-xmpp-contact">\n        <input type="text"\n            name="identifier"\n            class="username"\n            placeholder="'+(null==(__t=label_contact_username)?"":__t)+'"/>\n        <button class="pure-button button-primary" type="submit">'+(null==(__t=label_add)?"":__t)+"</button>\n    </form>\n</li>\n";return __p}}),define("tpl!change_status_message",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form id="set-custom-xmpp-status" class="pure-form">\n<fieldset>\n    <span class="input-button-group">\n        <input type="text" class="custom-xmpp-status" '+(null==(__t=status_message)?"":__t)+' placeholder="'+(null==(__t=label_custom_status)?"":__t)+'"/>\n        <input type="submit" class="pure-button button-primary" value="'+(null==(__t=label_save)?"":__t)+'"/>\n    </span>\n</fieldset>\n</form>\n';return __p}}),define("tpl!chat_status",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="xmpp-status">\n    <a class="choose-xmpp-status '+(null==(__t=chat_status)?"":__t)+" icon-"+(null==(__t=chat_status)?"":__t)+'" data-value="'+(null==(__t=status_message)?"":__t)+'" href="#" title="'+(null==(__t=desc_change_status)?"":__t)+'">\n        '+(null==(__t=status_message)?"":__t)+'\n    </a>\n    <a class="change-xmpp-status-message icon-pencil" href="#" title="'+(null==(__t=desc_custom_status)?"":__t)+'"></a>\n</div>\n';return __p}}),define("tpl!choose_status",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<dl id="target" class="dropdown">\n    <dt id="fancy-xmpp-status-select" class="fancy-dropdown"></dt>\n    <dd><ul class="xmpp-status-menu"></ul></dd>\n</dl>\n';return __p}}),define("tpl!contacts_panel",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form class="pure-form set-xmpp-status" action="" method="post">\n    <span id="xmpp-status-holder">\n        <select id="select-xmpp-status" style="display:none">\n            <option value="online">'+(null==(__t=label_online)?"":__t)+'</option>\n            <option value="dnd">'+(null==(__t=label_busy)?"":__t)+'</option>\n            <option value="away">'+(null==(__t=label_away)?"":__t)+"</option>\n            ",include_offline_state&&(__p+='\n            <option value="offline">'+(null==(__t=label_offline)?"":__t)+"</option>\n            "),__p+="\n            ",allow_logout&&(__p+='\n            <option value="logout">'+(null==(__t=label_logout)?"":__t)+"</option>\n            "),__p+="\n        </select>\n    </span>\n</form>\n";return __p}}),define("tpl!contacts_tab",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li><a class="s ',is_current&&(__p+=" current "),__p+='"\n       data-id="users" href="#users">\n    '+(null==(__t=label_contacts)?"":__t)+"\n</a></li>\n";return __p}}),define("tpl!controlbox",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="flyout box-flyout">\n    <div class="dragresize dragresize-top"></div>\n    <div class="dragresize dragresize-topleft"></div>\n    <div class="dragresize dragresize-left"></div>\n    <div class="chat-head controlbox-head">\n        <ul id="controlbox-tabs"></ul>\n        ',sticky_controlbox||(__p+='\n            <a class="chatbox-btn close-chatbox-button icon-close"></a>\n        '),__p+='\n    </div>\n    <div class="controlbox-panes"></div>\n</div>\n';return __p}}),define("tpl!controlbox_toggle",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="conn-feedback">'+(null==(__t=label_toggle)?"":__t)+"</span>\n";return __p}}),define("tpl!login_panel",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form class="pure-form pure-form-stacked converse-form" id="converse-login" method="post">\n    ',auto_login&&(__p+='\n        <span class="spinner login-submit"/>\n    '),__p+="\n    ",auto_login||(__p+="\n        ",authentication!=LOGIN&&authentication!=EXTERNAL||(__p+="\n            <label>"+(null==(__t=label_username)?"":__t)+'</label>\n            <input type="text" name="jid" placeholder="'+(null==(__t=placeholder_username)?"":__t)+'">\n            ',authentication!==EXTERNAL&&(__p+="\n                <label>"+(null==(__t=label_password)?"":__t)+'</label>\n                <input type="password" name="password" placeholder="'+(null==(__t=placeholder_password)?"":__t)+'">\n            '),__p+='\n            <input class="pure-button button-primary" type="submit" value="'+(null==(__t=label_login)?"":__t)+'">\n            <span class="conn-feedback"></span>\n        '),__p+="\n        ",authentication==ANONYMOUS&&(__p+='\n            <input type="pure-button button-primary" class="submit login-anon" value="'+(null==(__t=label_anon_login)?"":__t)+'"/>\n        '),__p+="\n        ",authentication==PREBIND&&(__p+="\n            <p>Disconnected.</p>\n        "),__p+="\n    "),__p+="\n</form>\n";return __p}}),define("tpl!login_tab",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li><a class="current" href="#login-dialog">'+(null==(__t=label_sign_in)?"":__t)+"</a></li>\n";return __p}}),define("tpl!search_contact",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li>\n    <form class="search-xmpp-contact">\n        <input type="text"\n            name="identifier"\n            class="username"\n            placeholder="'+(null==(__t=label_contact_name)?"":__t)+'"/>\n        <button type="submit">'+(null==(__t=label_search)?"":__t)+"</button>\n    </form>\n</li>\n";return __p}}),define("tpl!status_option",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li>\n    <a href="#" class="'+(null==(__t=value)?"":__t)+'" data-value="'+(null==(__t=value)?"":__t)+'">\n        <span class="icon-'+(null==(__t=value)?"":__t)+'"></span>\n        '+(null==(__t=text)?"":__t)+"\n    </a>\n</li>\n";return __p}}),define("tpl!group_header",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a href="#" class="group-toggle icon-'+(null==(__t=toggle_state)?"":__t)+'" title="'+(null==(__t=desc_group_toggle)?"":__t)+'">'+(null==(__t=label_group)?"":__t)+"</a>\n";return __p}}),define("tpl!pending_contact",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",allow_chat_pending_contacts&&(__p+='\n<a class="open-chat"href="#">\n'),__p+='\n<span class="pending-contact-name" title="Name: '+(null==(__t=fullname)?"":__t)+"\nJID: "+(null==(__t=jid)?"":__t)+'">'+(null==(__t=fullname)?"":__t)+"</span> \n",allow_chat_pending_contacts&&(__p+="\n</a>\n"),__p+='\n<a class="remove-xmpp-contact icon-remove" title="'+(null==(__t=desc_remove)?"":__t)+'" href="#"></a>\n';return __p}}),define("tpl!requesting_contact",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",allow_chat_pending_contacts&&(__p+='\n<a class="open-chat"href="#">\n'),__p+='\n<span class="req-contact-name" title="Name: '+(null==(__t=fullname)?"":__t)+"\nJID: "+(null==(__t=jid)?"":__t)+'">'+(null==(__t=fullname)?"":__t)+"</span>\n",allow_chat_pending_contacts&&(__p+="\n</a>\n"),__p+='\n<span class="request-actions">\n    <a class="accept-xmpp-request icon-checkmark" title="'+(null==(__t=desc_accept)?"":__t)+'" href="#"></a>\n    <a class="decline-xmpp-request icon-close" title="'+(null==(__t=desc_decline)?"":__t)+'" href="#"></a>\n</span>\n';return __p}}),define("tpl!roster",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form class="pure-form roster-filter-group input-button-group">\n    <input value="'+(null==(__t=filter_text)?"":__t)+'" class="roster-filter"\n           placeholder="'+(null==(__t=placeholder)?"":__t)+'"\n           ',"state"===filter_type&&(__p+='  style="display: none" '),__p+=' >\n    <select class="state-type" ',"state"!==filter_type&&(__p+='  style="display: none" '),__p+=' >\n        <option value="">'+(null==(__t=label_any)?"":__t)+"</option>\n        <option ","online"===chat_state&&(__p+=' selected="selected" '),__p+='\n            value="online">'+(null==(__t=label_online)?"":__t)+"</option>\n        <option ","chat"===chat_state&&(__p+=' selected="selected" '),__p+='\n            value="chat">'+(null==(__t=label_chatty)?"":__t)+"</option>\n        <option ","dnd"===chat_state&&(__p+=' selected="selected" '),__p+='\n            value="dnd">'+(null==(__t=label_busy)?"":__t)+"</option>\n        <option ","away"===chat_state&&(__p+=' selected="selected" '),__p+='\n            value="away">'+(null==(__t=label_away)?"":__t)+"</option>\n        <option ","xa"===chat_state&&(__p+=' selected="selected" '),__p+='\n            value="xa">'+(null==(__t=label_xa)?"":__t)+"</option>\n        <option ","offline"===chat_state&&(__p+=' selected="selected" '),__p+='\n            value="offline">'+(null==(__t=label_offline)?"":__t)+'</option>\n    </select>\n    <select class="filter-type">\n        <option ',"contacts"===filter_type&&(__p+=' selected="selected" '),__p+='\n                value="contacts">'+(null==(__t=label_contacts)?"":__t)+"</option>\n        <option ","groups"===filter_type&&(__p+=' selected="selected" '),__p+='\n                value="groups">'+(null==(__t=label_groups)?"":__t)+"</option>\n        <option ","state"===filter_type&&(__p+=' selected="selected" '),__p+='\n                value="state">'+(null==(__t=label_state)?"":__t)+"</option>\n    </select>\n</form>\n";return __p}}),define("tpl!roster_item",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a class="open-chat" title="'+(null==(__t=title_fullname)?"":__t)+": "+(null==(__t=fullname)?"":__t)+"\nJID: "+(null==(__t=jid)?"":__t)+"\n"+(null==(__t=desc_chat)?"":__t)+'" href="#"><span class="icon-'+(null==(__t=chat_status)?"":__t)+'" title="'+(null==(__t=desc_status)?"":__t)+'"></span>'+(null==(__t=fullname)?"":__t)+"</a>\n",allow_contact_removal&&(__p+='\n<a class="remove-xmpp-contact icon-remove" title="'+(null==(__t=desc_remove)?"":__t)+'" href="#"></a>\n'),__p+="\n";return __p}}),function(e,t){define("converse-rosterview",["converse-core","converse-api","tpl!group_header","tpl!pending_contact","tpl!requesting_contact","tpl!roster","tpl!roster_item"],t)}(this,function(e,t,n,i,o,s,a){"use strict";e.templates.group_header=n,e.templates.pending_contact=i,e.templates.requesting_contact=o,e.templates.roster=s,e.templates.roster_item=a;var r=t.env.jQuery,l=t.env.utils,c=t.env.Strophe,d=t.env.$iq,u=t.env.b64_sha1,h=t.env._,p=l.__.bind(e);t.plugins.add("rosterview",{overrides:{afterReconnected:function(){this.rosterview.registerRosterXHandler(),this.__super__.afterReconnected.apply(this,arguments)},RosterGroups:{comparator:function(){return e.RosterGroupsComparator.apply(this,arguments)}}},initialize:function(){this.updateSettings({allow_chat_pending_contacts:!1,allow_contact_removal:!0,show_toolbar:!0});var t={dnd:p("This contact is busy"),online:p("This contact is online"),offline:p("This contact is offline"),unavailable:p("This contact is unavailable"),xa:p("This contact is away for an extended period"),away:p("This contact is away")},n=p("Contacts"),i=p("Groups"),o=p("My contacts"),s=p("Pending contacts"),a=p("Contact requests"),_=p("Ungrouped"),m={};m[a]=0,m[o]=1,m[_]=2,m[s]=3,e.RosterGroupsComparator=function(e,t){e=e.get("name"),t=t.get("name");var n=h.keys(m),i=h.contains(n,e),o=h.contains(n,t);return i||o?i&&o?m[e]<m[t]?-1:m[e]>m[t]?1:0:!i&&o?t===a?1:-1:i&&!o?e===a?-1:1:void 0:e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0},e.RosterFilter=Backbone.Model.extend({initialize:function(){this.set({filter_text:"",filter_type:"contacts",chat_state:""})}}),e.RosterFilterView=Backbone.View.extend({tagName:"span",events:{"keydown .roster-filter":"liveFilter","click .onX":"clearFilter","mousemove .x":"toggleX","change .filter-type":"changeTypeFilter","change .state-type":"changeChatStateFilter"},initialize:function(){this.model.on("change",this.render,this)},render:function(){this.$el.html(e.templates.roster(h.extend(this.model.toJSON(),{
placeholder:p("Filter"),label_contacts:n,label_groups:i,label_state:p("State"),label_any:p("Any"),label_online:p("Online"),label_chatty:p("Chatty"),label_busy:p("Busy"),label_away:p("Away"),label_xa:p("Extended Away"),label_offline:p("Offline")})));var t=this.$(".roster-filter");return t[this.tog(t.val())]("x"),this.$el},tog:function(e){return e?"addClass":"removeClass"},toggleX:function(e){e&&e.preventDefault&&e.preventDefault();var t=e.target;r(t)[this.tog(t.offsetWidth-18<e.clientX-t.getBoundingClientRect().left)]("onX")},changeChatStateFilter:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.save({chat_state:this.$(".state-type").val()})},changeTypeFilter:function(e){e&&e.preventDefault&&e.preventDefault();var t=e.target.value;"state"===t?this.model.save({filter_type:t,chat_state:this.$(".state-type").val()}):this.model.save({filter_type:t,filter_text:this.$(".roster-filter").val()})},liveFilter:h.debounce(function(e){e&&e.preventDefault&&e.preventDefault(),this.model.save({filter_type:this.$(".filter-type").val(),filter_text:this.$(".roster-filter").val()})},250),isActive:function(){return!("state"!==this.model.get("filter_type")&&!this.model.get("filter_text"))},show:function(){return this.$el.is(":visible")?this:(this.$el.show(),this)},hide:function(){if(!this.$el.is(":visible"))return this;if(!(this.$(".roster-filter").val().length>0))return this.model.save({filter_text:"",chat_state:""}),this.$el.hide(),this},clearFilter:function(e){e&&e.preventDefault&&(e.preventDefault(),r(e.target).removeClass("x onX").val("")),this.model.save({filter_text:""})}}),e.RosterView=Backbone.Overview.extend({tagName:"div",id:"converse-roster",initialize:function(){this.roster_handler_ref=this.registerRosterHandler(),this.rosterx_handler_ref=this.registerRosterXHandler(),e.roster.on("add",this.onContactAdd,this),e.roster.on("change",this.onContactChange,this),e.roster.on("destroy",this.update,this),e.roster.on("remove",this.update,this),this.model.on("add",this.onGroupAdd,this),this.model.on("reset",this.reset,this),e.on("rosterGroupsFetched",this.positionFetchedGroups,this),e.on("rosterContactsFetched",this.update,this),this.createRosterFilter()},render:function(){return this.$roster=r('<dl class="roster-contacts" style="display: none;"></dl>'),this.$el.html(this.filter_view.render()),e.allow_contact_requests||this.$el.addClass("no-contact-requests"),this},createRosterFilter:function(){var t=new e.RosterFilter;t.id=u("converse.rosterfilter"+e.bare_jid),t.browserStorage=new Backbone.BrowserStorage.local(this.filter.id),this.filter_view=new e.RosterFilterView({model:t}),this.filter_view.model.on("change",this.updateFilter,this),this.filter_view.model.fetch()},updateFilter:h.debounce(function(){var e=this.filter_view.model.get("filter_type");"state"===e?this.filter(this.filter_view.model.get("chat_state"),e):this.filter(this.filter_view.model.get("filter_text"),e)},100),unregisterHandlers:function(){e.connection.deleteHandler(this.roster_handler_ref),delete this.roster_handler_ref,e.connection.deleteHandler(this.rosterx_handler_ref),delete this.rosterx_handler_ref},update:h.debounce(function(){return 0===this.$roster.parent().length&&this.$el.append(this.$roster.show()),this.showHideFilter()},e.animate?100:0),showHideFilter:function(){if(this.$el.is(":visible"))return this.$roster.hasScrollBar()?this.filter_view.show():this.filter_view.isActive()||this.filter_view.hide(),this},filter:function(e,t){h.each(this.getAll(),function(e){e.model.contacts.length>0&&e.show().filter("")}),e=e.toLowerCase(),"groups"===t?h.each(this.getAll(),function(t,n){t.model.get("name").toLowerCase().indexOf(e.toLowerCase())===-1?t.hide():t.model.contacts.length>0&&t.show()}):h.each(this.getAll(),function(n){n.filter(e,t)})},reset:function(){return e.roster.reset(),this.removeAll(),this.$roster=r('<dl class="roster-contacts" style="display: none;"></dl>'),this.render().update(),this},registerRosterHandler:function(){e.connection.addHandler(e.roster.onRosterPush.bind(e.roster),c.NS.ROSTER,"iq","set")},registerRosterXHandler:function(){var t=0;e.connection.addHandler(function(n){return window.setTimeout(function(){e.connection.flush(),e.roster.subscribeToSuggestedItems.bind(e.roster)(n)},t),t+=250*r(n).find("item").length,!0},c.NS.ROSTERX,"message",null)},onGroupAdd:function(t){var n=new e.RosterGroupView({model:t});this.add(t.get("name"),n.render()),this.positionGroup(n)},onContactAdd:function(e){this.addRosterContact(e).update(),this.updateFilter()},onContactChange:function(e){this.updateChatBox(e).update(),h.has(e.changed,"subscription")&&("from"===e.changed.subscription?this.addContactToGroup(e,s):h.contains(["both","to"],e.get("subscription"))&&this.addExistingContact(e)),h.has(e.changed,"ask")&&"subscribe"===e.changed.ask&&this.addContactToGroup(e,s),h.has(e.changed,"subscription")&&"true"===e.changed.requesting&&this.addContactToGroup(e,a),this.updateFilter()},updateChatBox:function(t){var n=e.chatboxes.get(t.get("jid")),i={};return n?(h.has(t.changed,"chat_status")&&(i.chat_status=t.get("chat_status")),h.has(t.changed,"status")&&(i.status=t.get("status")),n.save(i),this):this},positionFetchedGroups:function(t,n,i){this.model.sort(),this.model.each(function(t,n){var i=this.get(t.get("name"));i||(i=new e.RosterGroupView({model:t}),this.add(t.get("name"),i.render())),0===n?this.$roster.append(i.$el):this.appendGroup(i)}.bind(this))},positionGroup:function(e){var t=this.$roster.find(".roster-group"),n=t.length?this.model.indexOf(e.model):0;return 0===n?this.$roster.prepend(e.$el):n===this.model.length-1?this.appendGroup(e):r(t.eq(n)).before(e.$el),this},appendGroup:function(e){var t=this.$roster.find(".roster-group").last(),n=t.siblings("dd");return n.length>0?n.last().after(e.$el):t.after(e.$el),this},getGroup:function(e){var t=this.get(e);return t?t.model:this.model.create({name:e,id:u(e)})},addContactToGroup:function(e,t){this.getGroup(t).contacts.add(e)},addExistingContact:function(t){var n;e.roster_groups?(n=t.get("groups"),0===n.length&&(n=[_])):n=[o],h.each(n,h.bind(this.addContactToGroup,this,t))},addRosterContact:function(e){return"both"===e.get("subscription")||"to"===e.get("subscription")?this.addExistingContact(e):"subscribe"===e.get("ask")||"from"===e.get("subscription")?this.addContactToGroup(e,s):e.get("requesting")===!0&&this.addContactToGroup(e,a),this}}),e.RosterContactView=Backbone.View.extend({tagName:"dd",events:{"click .accept-xmpp-request":"acceptRequest","click .decline-xmpp-request":"declineRequest","click .open-chat":"openChat","click .remove-xmpp-contact":"removeContact"},initialize:function(){this.model.on("change",this.render,this),this.model.on("remove",this.remove,this),this.model.on("destroy",this.remove,this),this.model.on("open",this.openChat,this)},render:function(){if(!this.mayBeShown())return this.$el.hide(),this;var n=this.model,i=n.get("ask"),o=n.get("chat_status"),s=n.get("requesting"),a=n.get("subscription"),r=["current-xmpp-contact","pending-xmpp-contact","requesting-xmpp-contact"].concat(h.keys(t));return h.each(r,function(e){this.el.className.indexOf(e)!==-1&&this.$el.removeClass(e)},this),this.$el.addClass(o).data("status",o),"subscribe"===i||"from"===a?(this.$el.addClass("pending-xmpp-contact"),this.$el.html(e.templates.pending_contact(h.extend(n.toJSON(),{desc_remove:p("Click to remove this contact"),allow_chat_pending_contacts:e.allow_chat_pending_contacts})))):s===!0?(this.$el.addClass("requesting-xmpp-contact"),this.$el.html(e.templates.requesting_contact(h.extend(n.toJSON(),{desc_accept:p("Click to accept this contact request"),desc_decline:p("Click to decline this contact request"),allow_chat_pending_contacts:e.allow_chat_pending_contacts})))):"both"!==a&&"to"!==a||(this.$el.addClass("current-xmpp-contact"),this.$el.removeClass(h.without(["both","to"],a)[0]).addClass(a),this.$el.html(e.templates.roster_item(h.extend(n.toJSON(),{desc_status:t[o||"offline"],desc_chat:p("Click to chat with this contact"),desc_remove:p("Click to remove this contact"),title_fullname:p("Name"),allow_contact_removal:e.allow_contact_removal})))),this},isGroupCollapsed:function(){var t=this.$el.prevAll("dt:first").data("group"),n=e.rosterview.model.where({name:t})[0];return n.get("state")===e.CLOSED},mayBeShown:function(){var t=this.model.get("chat_status");return!(e.show_only_online_users&&"online"!==t||e.hide_offline_users&&"offline"===t)||("subscribe"===this.model.get("ask")||"from"===this.model.get("subscription")||this.model.get("requesting")===!0)},openChat:function(t){return t&&t.preventDefault&&t.preventDefault(),e.chatboxviews.showChat(this.model.attributes)},removeContact:function(t){if(t&&t.preventDefault&&t.preventDefault(),e.allow_contact_removal){var n=confirm(p("Are you sure you want to remove this contact?"));if(n===!0){var i=d({type:"set"}).c("query",{xmlns:c.NS.ROSTER}).c("item",{jid:this.model.get("jid"),subscription:"remove"});e.connection.sendIQ(i,function(e){this.model.destroy(),this.remove()}.bind(this),function(t){alert(p("Sorry, there was an error while trying to remove "+name+" as a contact.")),e.log(t)})}}},acceptRequest:function(t){t&&t.preventDefault&&t.preventDefault(),e.roster.sendContactAddIQ(this.model.get("jid"),this.model.get("fullname"),[],function(){this.model.authorize().subscribe()}.bind(this))},declineRequest:function(e){e&&e.preventDefault&&e.preventDefault();var t=confirm(p("Are you sure you want to decline this contact request?"));return t===!0&&this.model.unauthorize().destroy(),this}}),e.RosterGroupView=Backbone.Overview.extend({tagName:"dt",className:"roster-group",events:{"click a.group-toggle":"toggle"},initialize:function(){this.model.contacts.on("add",this.addContact,this),this.model.contacts.on("change:subscription",this.onContactSubscriptionChange,this),this.model.contacts.on("change:requesting",this.onContactRequestChange,this),this.model.contacts.on("change:chat_status",function(e){this.model.contacts.sort(),this.positionContact(e).render()},this),this.model.contacts.on("destroy",this.onRemove,this),this.model.contacts.on("remove",this.onRemove,this),e.roster.on("change:groups",this.onContactGroupChange,this)},render:function(){return this.$el.attr("data-group",this.model.get("name")),this.$el.html(r(e.templates.group_header({label_group:this.model.get("name"),desc_group_toggle:this.model.get("description"),toggle_state:this.model.get("state")}))),this},addContact:function(t){var n=new e.RosterContactView({model:t});this.add(t.get("id"),n),n=this.positionContact(t).render(),n.mayBeShown()&&(this.model.get("state")===e.CLOSED?("none"!==n.$el[0].style.display&&n.$el.hide(),this.$el.is(":visible")||this.$el.show()):"block"!==this.$el[0].style.display&&this.show())},positionContact:function(e){var t=this.get(e.get("id")),n=this.model.contacts.indexOf(e);return t.$el.detach(),0===n?this.$el.after(t.$el):n===this.model.contacts.length-1?this.$el.nextUntil("dt").last().after(t.$el):this.$el.nextUntil("dt").eq(n).before(t.$el),t},show:function(){return this.$el.show(),h.each(this.getAll(),function(e){e.mayBeShown()&&!e.isGroupCollapsed()&&e.$el.show()}),this},hide:function(){this.$el.nextUntil("dt").addBack().hide()},filter:function(t,n){var i;0===t.length?(this.model.get("state")===e.OPENED&&this.model.contacts.each(function(e){var t=this.get(e.get("id"));t.mayBeShown()&&!t.isGroupCollapsed()&&t.$el.show()}.bind(this)),this.showIfNecessary()):(t=t.toLowerCase(),i="state"===n?this.model.get("name")===a?this.model.contacts.filter(function(e){return l.contains.not("chat_status",t)(e)&&!e.get("requesting")}):this.model.contacts.filter(l.contains.not("chat_status",t)):this.model.contacts.filter(l.contains.not("fullname",t)),i.length===this.model.contacts.length?this.hide():(h.each(i,function(e){this.get(e.get("id")).$el.hide()}.bind(this)),h.each(this.model.contacts.reject(l.contains.not("fullname",t)),function(e){this.get(e.get("id")).$el.show()}.bind(this)),this.showIfNecessary()))},showIfNecessary:function(){!this.$el.is(":visible")&&this.model.contacts.length>0&&this.$el.show()},toggle:function(t){t&&t.preventDefault&&t.preventDefault();var n=r(t.target);n.hasClass("icon-opened")?(this.$el.nextUntil("dt").slideUp(),this.model.save({state:e.CLOSED}),n.removeClass("icon-opened").addClass("icon-closed")):(n.removeClass("icon-closed").addClass("icon-opened"),this.model.save({state:e.OPENED}),this.filter(e.rosterview.$(".roster-filter").val()||"",e.rosterview.$(".filter-type").val()))},onContactGroupChange:function(e){var t=h.contains(e.get("groups"),this.model.get("name")),n=e.get("id"),i=!this.get(n);t&&!i?this.model.contacts.remove(n):!t&&i&&this.addContact(e)},onContactSubscriptionChange:function(e){this.model.get("name")===s&&"from"!==e.get("subscription")&&this.model.contacts.remove(e.get("id"))},onContactRequestChange:function(e){this.model.get("name")!==a||e.get("requesting")||(this.model.contacts.remove(e.get("id"),{silent:!0}),this.get(e.get("id")).remove(),this.onRemove(e))},onRemove:function(e){this.remove(e.get("id")),0===this.model.contacts.length&&this.$el.hide()}});var f=function(){e.rosterview=new e.RosterView({model:e.rostergroups}),e.rosterview.render()};e.on("rosterInitialized",f),e.on("rosterReadyAfterReconnection",f)}})}),function(e,t){define("converse-controlbox",["converse-core","converse-api","tpl!add_contact_dropdown","tpl!add_contact_form","tpl!change_status_message","tpl!chat_status","tpl!choose_status","tpl!contacts_panel","tpl!contacts_tab","tpl!controlbox","tpl!controlbox_toggle","tpl!login_panel","tpl!login_tab","tpl!search_contact","tpl!status_option","converse-chatview","converse-rosterview"],t)}(this,function(e,t,n,i,o,s,a,r,l,c,d,u,h,p,_){"use strict";e.templates.add_contact_dropdown=n,e.templates.add_contact_form=i,e.templates.change_status_message=o,e.templates.chat_status=s,e.templates.choose_status=a,e.templates.contacts_panel=r,e.templates.contacts_tab=l,e.templates.controlbox=c,e.templates.controlbox_toggle=d,e.templates.login_panel=u,e.templates.login_tab=h,e.templates.search_contact=p,e.templates.status_option=_;var m="users",f=t.env.Strophe,g=t.env.utils,v=t.env.jQuery,b=t.env._,y=g.__.bind(e),w=t.env.moment;t.plugins.add("converse-controlbox",{overrides:{initSession:function(){this.controlboxtoggle=new this.ControlBoxToggle,this.__super__.initSession.apply(this,arguments)},initConnection:function(){this.__super__.initConnection.apply(this,arguments),this.connection&&this.addControlBox()},onDisconnected:function(){var t=this.__super__.onDisconnected.apply(this,arguments),n=e.chatboxviews.get("controlbox");return n.model.set({connected:!1}),"disconnected"===t&&(n.$("#controlbox-tabs").empty(),n.renderLoginPanel()),t},afterReconnected:function(){this.__super__.afterReconnected.apply(this,arguments);var t=e.chatboxviews.get("controlbox");t.model.get("connected")?e.chatboxviews.get("controlbox").onConnected():t.model.set({connected:!0})},_tearDown:function(){this.__super__._tearDown.apply(this,arguments),this.rosterview&&(this.rosterview.unregisterHandlers(),this.rosterview.model.off().reset(),this.rosterview.each(function(e){e.removeAll(),e.remove()}),this.rosterview.removeAll().remove())},clearSession:function(){this.__super__.clearSession.apply(this,arguments),b.isUndefined(this.connection)&&this.connection.connected&&this.chatboxes.get("controlbox").save({connected:!1})},ChatBoxes:{chatBoxMayBeShown:function(e){return this.__super__.chatBoxMayBeShown.apply(this,arguments)&&"controlbox"!==e.get("id")},onChatBoxesFetched:function(e,t){this.__super__.onChatBoxesFetched.apply(this,arguments),b.include(b.pluck(t,"id"),"controlbox")||this.add({id:"controlbox",box_id:"controlbox"}),this.get("controlbox").save({connected:!0})}},ChatBoxViews:{onChatBoxAdded:function(t){if("controlbox"===t.get("box_id")){var n=this.get(t.get("id"));return n?(n.model=t,n.initialize(),n):(n=new e.ControlBoxView({model:t}),this.add(t.get("id"),n))}return this.__super__.onChatBoxAdded.apply(this,arguments)},closeAllChatBoxes:function(){return this.each(function(t){e.connection.connected&&"controlbox"===t.model.get("id")||t.close()}),this},getChatBoxWidth:function(t){var n=this.get("controlbox");return"controlbox"===t.model.get("id")?n&&n.$el.is(":visible")?n.$el.outerWidth(!0):e.controlboxtoggle.$el.outerWidth(!0):this.__super__.getChatBoxWidth.apply(this,arguments)}},ChatBox:{initialize:function(){"controlbox"===this.get("id")?this.set({time_opened:w(0).valueOf(),num_unread:0}):this.__super__.initialize.apply(this,arguments)}},ChatBoxView:{insertIntoDOM:function(){return this.$el.insertAfter(e.chatboxviews.get("controlbox").$el),this}}},initialize:function(){var e=this.converse;this.updateSettings({allow_logout:!0,default_domain:void 0,show_controlbox_by_default:!1,sticky_controlbox:!1,xhr_user_search:!1,xhr_user_search_url:""});var t=y("Contacts");e.addControlBox=function(){return e.chatboxes.add({id:"controlbox",box_id:"controlbox",closed:!e.show_controlbox_by_default})},e.ControlBoxView=e.ChatBoxView.extend({tagName:"div",className:"chatbox",id:"controlbox",events:{"click a.close-chatbox-button":"close","click ul#controlbox-tabs li a":"switchTab"},initialize:function(){this.$el.insertAfter(e.controlboxtoggle.$el),this.model.on("change:connected",this.onConnected,this),this.model.on("destroy",this.hide,this),this.model.on("hide",this.hide,this),this.model.on("show",this.show,this),this.model.on("change:closed",this.ensureClosedState,this),this.render(),this.model.get("connected")&&this.insertRoster(),"undefined"==typeof this.model.get("closed")&&this.model.set("closed",!e.show_controlbox_by_default),this.model.get("closed")?this.hide():this.show()},render:function(){return this.$el.html(e.templates.controlbox(b.extend(this.model.toJSON(),{sticky_controlbox:e.sticky_controlbox}))),e.connection.connected&&e.connection.authenticated&&!e.connection.disconnecting?this.contactspanel&&this.contactspanel.$el.is(":visible")||this.renderContactsPanel():this.renderLoginPanel(),this},giveFeedback:function(e,t){var n=this.$(".conn-feedback");n.addClass("conn-feedback").text(e),t&&n.addClass(t)},onConnected:function(){this.model.get("connected")&&this.render().insertRoster()},insertRoster:function(){return this.contactspanel.$el.append(e.rosterview.$el),this},renderLoginPanel:function(){var t=this.$(".conn-feedback");return this.loginpanel=new e.LoginPanel({$parent:this.$el.find(".controlbox-panes"),model:this}),this.loginpanel.render(),t.length&&t.text()!==y("Connecting")&&this.$(".conn-feedback").replaceWith(t),this},renderContactsPanel:function(){b.isUndefined(this.model.get("active-panel"))&&this.model.save({"active-panel":m}),this.contactspanel=new e.ContactsPanel({$parent:this.$el.find(".controlbox-panes")}),this.contactspanel.render(),e.xmppstatusview=new e.XMPPStatusView({model:e.xmppstatus}),e.xmppstatusview.render()},close:function(t){return t&&t.preventDefault&&t.preventDefault(),e.connection.connected?this.model.save({closed:!0}):this.model.trigger("hide"),e.emit("controlBoxClosed",this),this},ensureClosedState:function(){this.model.get("closed")?this.hide():this.show()},hide:function(t){return this.$el.addClass("hidden"),g.refreshWebkit(),e.emit("chatBoxClosed",this),e.connection.connected||e.controlboxtoggle.render(),e.controlboxtoggle.show(function(){"function"==typeof t&&t()}),this},onControlBoxToggleHidden:function(){var t=this;g.fadeIn(this.el,function(){e.controlboxtoggle.updateOnlineCount(),g.refreshWebkit(),e.emit("controlBoxOpened",t)})},show:function(){return e.controlboxtoggle.hide(this.onControlBoxToggleHidden.bind(this)),this},switchTab:function(t){t&&t.preventDefault&&t.preventDefault();var n=v(t.target),i=n.parent().siblings("li").children("a"),o=v(n.attr("href"));return v(i.attr("href")).addClass("hidden"),i.removeClass("current"),n.addClass("current"),o.removeClass("hidden"),e.connection.connected&&this.model.save({"active-panel":n.data("id")}),this},showHelpMessages:function(e){}}),e.LoginPanel=Backbone.View.extend({tagName:"div",id:"login-dialog",className:"controlbox-pane",events:{"submit form#converse-login":"authenticate"},initialize:function(t){t.$parent.html(this.$el.html(e.templates.login_panel({ANONYMOUS:e.ANONYMOUS,EXTERNAL:e.EXTERNAL,LOGIN:e.LOGIN,PREBIND:e.PREBIND,auto_login:e.auto_login,authentication:e.authentication,label_username:y("XMPP Username:"),label_password:y("Password:"),label_anon_login:y("Click here to log in anonymously"),label_login:y("Log In"),placeholder_username:(e.locked_domain||e.default_domain)&&y("Username")||y("user@server"),placeholder_password:y("password")}))),this.$tabs=t.$parent.parent().find("#controlbox-tabs")},render:function(){return this.$tabs.append(e.templates.login_tab({label_sign_in:y("Sign in")})),this.$el.find("input#jid").focus(),this.$el.is(":visible")||this.$el.show(),this},authenticate:function(t){t&&t.preventDefault&&t.preventDefault();var n=v(t.target);if(e.authentication===e.ANONYMOUS)return void this.connect(n,e.jid,null);var i=n.find("input[name=jid]"),o=i.val(),s=n.find("input[name=password]"),a=s.val(),r=!1;return o||(r=!0,i.addClass("error")),a||e.authentication===e.EXTERNAL||(r=!0,s.addClass("error")),r?void 0:(e.locked_domain?o=f.escapeNode(o)+"@"+e.locked_domain:e.default_domain&&o.indexOf("@")===-1&&(o=o+"@"+e.default_domain),this.connect(n,o,a),!1)},connect:function(t,n,i){var o;t&&t.find("input[type=submit]").hide().after('<span class="spinner login-submit"/>'),n&&(o=f.getResourceFromJid(n),n=o?f.getBareJidFromJid(n).toLowerCase()+"/"+o:n.toLowerCase()+e.generateResource()),e.connection.connect(n,i,e.onConnectStatusChanged)},remove:function(){this.$tabs.empty(),this.$el.parent().empty()}}),e.XMPPStatusView=Backbone.View.extend({el:"span#xmpp-status-holder",events:{"click a.choose-xmpp-status":"toggleOptions","click #fancy-xmpp-status-select a.change-xmpp-status-message":"renderStatusChangeForm","submit #set-custom-xmpp-status":"setStatusMessage","click .dropdown dd ul li a":"setStatus"},initialize:function(){this.model.on("change:status",this.updateStatusUI,this),this.model.on("change:status_message",this.updateStatusUI,this),this.model.on("update-status-ui",this.updateStatusUI,this)},render:function(){var t,n=this.$el.find("select#select-xmpp-status"),i=this.model.get("status")||"offline",o=v("option",n),s=[];return this.$el.html(e.templates.choose_status()),this.$el.find("#fancy-xmpp-status-select").html(e.templates.chat_status({status_message:this.model.get("status_message")||y("I am %1$s",this.getPrettyStatus(i)),chat_status:i,desc_custom_status:y("Click here to write a custom status message"),desc_change_status:y("Click to change your chat status")})),o.each(function(){s.push(e.templates.status_option({value:v(this).val(),text:this.text}))}),t=this.$el.find("#target dd ul").hide(),t.append(s.join("")),n.remove(),this},toggleOptions:function(e){e.preventDefault(),v(e.target).parent().parent().siblings("dd").find("ul").toggle("fast")},renderStatusChangeForm:function(t){t.preventDefault();var n=this.model.get("status")||"offline",i=e.templates.change_status_message({status_message:n,label_custom_status:y("Custom status"),label_save:y("Save")}),o=this.$el.find(".xmpp-status");o.parent().addClass("no-border"),o.replaceWith(i),this.$el.find(".custom-xmpp-status").focus().focus()},setStatusMessage:function(e){e.preventDefault(),this.model.setStatusMessage(v(e.target).find("input").val())},setStatus:function(t){t.preventDefault();var n=v(t.currentTarget),i=n.attr("data-value");"logout"===i?(this.$el.find(".dropdown dd ul").hide(),e.logOut()):(this.model.setStatus(i),this.$el.find(".dropdown dd ul").hide())},getPrettyStatus:function(e){return"chat"===e?y("online"):"dnd"===e?y("busy"):"xa"===e?y("away for long"):"away"===e?y("away"):"offline"===e?y("offline"):y(e)||y("online")},updateStatusUI:function(t){var n=t.get("status"),i=t.get("status_message")||y("I am %1$s",this.getPrettyStatus(n));this.$el.find("#fancy-xmpp-status-select").removeClass("no-border").html(e.templates.chat_status({chat_status:n,status_message:i,desc_custom_status:y("Click here to write a custom status message"),desc_change_status:y("Click to change your chat status")}))}}),e.ContactsPanel=Backbone.View.extend({tagName:"div",className:"controlbox-pane",id:"users",events:{"click a.toggle-xmpp-contact-form":"toggleContactForm","submit form.add-xmpp-contact":"addContactFromForm","submit form.search-xmpp-contact":"searchContacts","click a.subscribe-to-user":"addContactFromList"},initialize:function(e){e.$parent.append(this.$el),this.$tabs=e.$parent.parent().find("#controlbox-tabs")},render:function(){var n,i=e.templates.contacts_panel({label_online:y("Online"),label_busy:y("Busy"),label_away:y("Away"),label_offline:y("Offline"),label_logout:y("Log out"),include_offline_state:e.include_offline_state,allow_logout:e.allow_logout}),o=e.chatboxes.get("controlbox");return this.$tabs.append(e.templates.contacts_tab({label_contacts:t,is_current:o.get("active-panel")===m})),n=e.xhr_user_search?e.templates.search_contact({label_contact_name:y("Contact name"),label_search:y("Search")}):e.templates.add_contact_form({label_contact_username:y("e.g. user@example.org"),label_add:y("Add")}),e.allow_contact_requests&&(i+=e.templates.add_contact_dropdown({label_click_to_chat:y("Click to add new chat contacts"),label_add_contact:y("Add a contact")})),this.$el.html(i),this.$el.find(".search-xmpp ul").append(n),o.get("active-panel")!==m&&this.$el.addClass("hidden"),this},toggleContactForm:function(e){e.preventDefault(),this.$el.find(".search-xmpp").toggle("fast",function(){v(this).is(":visible")&&v(this).find("input.username").focus()})},searchContacts:function(t){t.preventDefault(),v.getJSON(e.xhr_user_search_url+"?q="+v(t.target).find("input.username").val(),function(e){var t=v(".search-xmpp ul");t.find("li.found-user").remove(),t.find("li.chat-info").remove(),e.length||t.append('<li class="chat-info">'+y("No users found")+"</li>"),v(e).each(function(e,n){t.append(v('<li class="found-user"></li>').append(v('<a class="subscribe-to-user" href="#" title="'+y("Click to add as a chat contact")+'"></a>').attr("data-recipient",f.getNodeFromJid(n.id)+"@"+f.getDomainFromJid(n.id)).text(n.fullname)))})})},addContactFromForm:function(t){t.preventDefault();var n=v(t.target).find("input"),i=n.val();return i?(e.roster.addAndSubscribe(i),void v(".search-xmpp").hide()):void n.addClass("error")},addContactFromList:function(t){t.preventDefault();var n=v(t.target),i=n.attr("data-recipient"),o=n.text();e.roster.addAndSubscribe(i,o),n.parent().remove(),v(".search-xmpp").hide()}}),e.ControlBoxToggle=Backbone.View.extend({tagName:"a",className:"toggle-controlbox hidden",id:"toggle-controlbox",events:{click:"onClick"},attributes:{href:"#"},initialize:function(){e.chatboxviews.$el.prepend(this.render()),this.updateOnlineCount(),e.on("initialized",function(){e.roster.on("add",this.updateOnlineCount,this),e.roster.on("change",this.updateOnlineCount,this),e.roster.on("destroy",this.updateOnlineCount,this),e.roster.on("remove",this.updateOnlineCount,this)}.bind(this))},render:function(){return this.$el.html(e.templates.controlbox_toggle({label_toggle:y("Toggle chat")}))},updateOnlineCount:b.debounce(function(){if("undefined"!=typeof e.roster){var t=this.$("#online-count");t.text("("+e.roster.getNumOnlineContacts()+")"),t.is(":visible")||t.show()}},e.animate?100:0),hide:function(e){this.el.classList.add("hidden"),e()},show:function(e){g.fadeIn(this.el,e)},showControlBox:function(){var t=e.chatboxes.get("controlbox");t||(t=e.addControlBox()),e.connection.connected?t.save({closed:!1}):t.trigger("show")},onClick:function(t){if(t.preventDefault(),v("div#controlbox").is(":visible")){var n=e.chatboxes.get("controlbox");e.connection.connected?n.save({closed:!0}):n.trigger("hide")}else this.showControlBox()}})}})}),define("tpl!chatarea",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chat-area">\n    <div class="chat-content"></div>\n    <div class="new-msgs-indicator hidden">▼ '+(null==(__t=unread_msgs)?"":__t)+' ▼</div>\n    <form class="sendXMPPMessage" action="" method="post">\n        ',show_toolbar&&(__p+='\n            <ul class="chat-toolbar no-text-select"></ul>\n        '),__p+='\n        <textarea type="text" class="chat-textarea" \n            placeholder="'+(null==(__t=label_message)?"":__t)+'"/>\n    </form>\n</div>\n';return __p}}),define("tpl!chatroom",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="flyout box-flyout">\n    <div class="dragresize dragresize-top"></div>\n    <div class="dragresize dragresize-topleft"></div>\n    <div class="dragresize dragresize-left"></div>\n    <div class="chat-head chat-head-chatroom">\n        <a class="chatbox-btn close-chatbox-button icon-close" title="'+(null==(__t=info_close)?"":__t)+'"></a>\n        <a class="chatbox-btn configure-chatroom-button icon-wrench" title="'+(null==(__t=info_configure)?"":__t)+' "style="display:none"></a>\n        <div class="chat-title">\n            '+(null==(__t=_.escape(name))?"":__t)+'\n            <p class="chatroom-topic"><p/>\n        </div>\n    </div>\n    <div class="chat-body chatroom-body"><span class="spinner centered"/></div>\n</div>\n';return __p}}),define("tpl!chatroom_form",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chatroom-form-container">\n    <form class="pure-form pure-form-stacked converse-form chatroom-form">\n        <fieldset>\n            <span class="spinner centered"/>\n        </fieldset>\n    </form>\n</div>\n';return __p}}),define("tpl!chatroom_nickname_form",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chatroom-form-container">\n    <form class="pure-form converse-form chatroom-form">\n        <fieldset>\n            <label>'+(null==(__t=heading)?"":__t)+'</label>\n            <p class="validation-message">'+(null==(__t=validation_message)?"":__t)+'</p>\n            <input type="text" required="required" name="nick" class="new-chatroom-nick" placeholder="'+(null==(__t=label_nickname)?"":__t)+'"/>\n        </fieldset>\n        <fieldset>\n            <input type="submit" class="pure-button button-primary" name="join" value="'+(null==(__t=label_join)?"":__t)+'"/>\n        </fieldset>\n    </form>\n</div>\n';return __p}}),define("tpl!chatroom_password_form",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chatroom-form-container">\n    <form class="pure-form converse-form chatroom-form">\n        <fieldset>\n            <legend>'+(null==(__t=heading)?"":__t)+"</legend>\n            <label>"+(null==(__t=label_password)?"":__t)+'</label>\n            <input type="password" name="password"/>\n        </fieldset>\n        <fieldset>\n            <input class="pure-button button-primary" type="submit" value="'+(null==(__t=label_submit)?"":__t)+'"/>\n        </fieldset>\n    </form>\n</div>\n';return __p}}),define("tpl!chatroom_sidebar",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<!-- <div class="occupants"> -->\n',allow_muc_invitations&&(__p+='\n<form class="pure-form room-invite">\n    <input class="invited-contact" placeholder="'+(null==(__t=label_invitation)?"":__t)+'" type="text"/>\n</form>\n'),__p+='\n<p class="occupants-heading">'+(null==(__t=label_occupants)?"":__t)+':</p>\n<ul class="occupant-list"></ul>\n<!-- </div> -->\n';return __p}}),define("tpl!chatroom_toolbar",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",
show_emoticons&&(__p+='\n    <li class="toggle-smiley icon-happy" title="'+(null==(__t=label_insert_smiley)?"":__t)+'">\n        <ul>\n            <li><a class="icon-smiley" href="#" data-emoticon=":)"></a></li>\n            <li><a class="icon-wink" href="#" data-emoticon=";)"></a></li>\n            <li><a class="icon-grin" href="#" data-emoticon=":D"></a></li>\n            <li><a class="icon-tongue" href="#" data-emoticon=":P"></a></li>\n            <li><a class="icon-cool" href="#" data-emoticon="8)"></a></li>\n            <li><a class="icon-evil" href="#" data-emoticon=">:)"></a></li>\n            <li><a class="icon-confused" href="#" data-emoticon=":S"></a></li>\n            <li><a class="icon-wondering" href="#" data-emoticon=":\\"></a></li>\n            <li><a class="icon-angry" href="#" data-emoticon=">:("></a></li>\n            <li><a class="icon-sad" href="#" data-emoticon=":("></a></li>\n            <li><a class="icon-shocked" href="#" data-emoticon=":O"></a></li>\n            <li><a class="icon-thumbs-up" href="#" data-emoticon="(^.^)b"></a></li>\n            <li><a class="icon-heart" href="#" data-emoticon="<3"></a></li>\n        </ul>\n    </li>\n'),__p+="\n",show_call_button&&(__p+='\n<li class="toggle-call"><a class="icon-phone" title="'+(null==(__t=label_start_call)?"":__t)+'"></a></li>\n'),__p+="\n",show_occupants_toggle&&(__p+='\n<li class="toggle-occupants"><a class="icon-hide-users" title="'+(null==(__t=label_hide_occupants)?"":__t)+'"></a></li>\n'),__p+="\n",show_clear_button&&(__p+='\n<li class="toggle-clear"><a class="icon-remove" title="'+(null==(__t=label_clear)?"":__t)+'"></a></li>\n'),__p+="\n\n";return __p}}),define("tpl!chatrooms_tab",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li><a class="s ',is_current&&(__p+=" current "),__p+='"\n       data-id="chatrooms" href="#chatrooms">\n    '+(null==(__t=label_rooms)?"":__t)+"\n</a></li>\n";return __p}}),define("tpl!info",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chat-info">'+(null==(__t=message)?"":__t)+"</div>\n";return __p}}),define("tpl!occupant",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li class="'+(null==(__t=role)?"":__t)+' occupant" id="'+(null==(__t=id)?"":__t)+'"\n    ',"moderator"===role&&(__p+='\n       title="'+(null==(__t=desc_moderator)?"":__t)+" "+(null==(__t=hint_occupant)?"":__t)+'"\n    '),__p+="\n    ","occupant"===role&&(__p+='\n       title="'+(null==(__t=desc_occupant)?"":__t)+" "+(null==(__t=hint_occupant)?"":__t)+'"\n    '),__p+="\n    ","visitor"===role&&(__p+='\n       title="'+(null==(__t=desc_visitor)?"":__t)+" "+(null==(__t=hint_occupant)?"":__t)+'"\n    '),__p+=">"+(null==(__t=nick)?"":__t)+"</li>\n";return __p}}),define("tpl!room_description",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<!-- FIXME: check markup in mockup -->\n<div class="room-info">\n<p class="room-info"><strong>'+(null==(__t=label_desc)?"":__t)+"</strong> "+(null==(__t=desc)?"":__t)+'</p>\n<p class="room-info"><strong>'+(null==(__t=label_occ)?"":__t)+"</strong> "+(null==(__t=occ)?"":__t)+'</p>\n<p class="room-info"><strong>'+(null==(__t=label_features)?"":__t)+"</strong>\n    <ul>\n        ",passwordprotected&&(__p+='\n        <li class="room-info locked">'+(null==(__t=label_requires_auth)?"":__t)+"</li>\n        "),__p+="\n        ",hidden&&(__p+='\n        <li class="room-info">'+(null==(__t=label_hidden)?"":__t)+"</li>\n        "),__p+="\n        ",membersonly&&(__p+='\n        <li class="room-info">'+(null==(__t=label_requires_invite)?"":__t)+"</li>\n        "),__p+="\n        ",moderated&&(__p+='\n        <li class="room-info">'+(null==(__t=label_moderated)?"":__t)+"</li>\n        "),__p+="\n        ",nonanonymous&&(__p+='\n        <li class="room-info">'+(null==(__t=label_non_anon)?"":__t)+"</li>\n        "),__p+="\n        ",open&&(__p+='\n        <li class="room-info">'+(null==(__t=label_open_room)?"":__t)+"</li>\n        "),__p+="\n        ",persistent&&(__p+='\n        <li class="room-info">'+(null==(__t=label_permanent_room)?"":__t)+"</li>\n        "),__p+="\n        ",publicroom&&(__p+='\n        <li class="room-info">'+(null==(__t=label_public)?"":__t)+"</li>\n        "),__p+="\n        ",semianonymous&&(__p+='\n        <li class="room-info">'+(null==(__t=label_semi_anon)?"":__t)+"</li>\n        "),__p+="\n        ",temporary&&(__p+='\n        <li class="room-info">'+(null==(__t=label_temp_room)?"":__t)+"</li>\n        "),__p+="\n        ",unmoderated&&(__p+='\n        <li class="room-info">'+(null==(__t=label_unmoderated)?"":__t)+"</li>\n        "),__p+="\n    </ul>\n</p>\n</div>\n";return __p}}),define("tpl!room_item",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<dd class="available-chatroom">\n<a class="open-room" data-room-jid="'+(null==(__t=jid)?"":__t)+'"\n   title="'+(null==(__t=open_title)?"":__t)+'" href="#">'+(null==(__t=_.escape(name))?"":__t)+'</a>\n<a class="room-info icon-room-info" data-room-jid="'+(null==(__t=jid)?"":__t)+'"\n   title="'+(null==(__t=info_title)?"":__t)+'" href="#">&nbsp;</a>\n</dd>\n';return __p}}),define("tpl!room_panel",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form class="pure-form pure-form-stacked converse-form add-chatroom" action="" method="post">\n    <fieldset>\n        <label>'+(null==(__t=label_room_name)?"":__t)+'</label>\n        <input type="text" name="chatroom" class="new-chatroom-name" placeholder="'+(null==(__t=label_room_name)?"":__t)+'"/>\n        ',"hidden"!=server_input_type&&(__p+="\n            <label"+(null==(__t=server_label_global_attr)?"":__t)+">"+(null==(__t=label_server)?"":__t)+"</label>\n        "),__p+='\n        <input type="'+(null==(__t=server_input_type)?"":__t)+'" name="server" class="new-chatroom-server" placeholder="'+(null==(__t=label_server)?"":__t)+'"/>\n        <input type="submit" class="pure-button button-primary" name="join" value="'+(null==(__t=label_join)?"":__t)+'"/>\n        <input type="button" class="pure-button button-secondary" name="show" id="show-rooms" value="'+(null==(__t=label_show_rooms)?"":__t)+'"/>\n    </fieldset>\n</form>\n<dl id="available-chatrooms" class="rooms-list"></dl>\n';return __p}}),function(e,t){define("converse-muc",["converse-core","converse-api","tpl!chatarea","tpl!chatroom","tpl!chatroom_form","tpl!chatroom_nickname_form","tpl!chatroom_password_form","tpl!chatroom_sidebar","tpl!chatroom_toolbar","tpl!chatrooms_tab","tpl!info","tpl!occupant","tpl!room_description","tpl!room_item","tpl!room_panel","typeahead","converse-chatview"],t)}(this,function(e,t,n,i,o,s,a,r,l,c,d,u,h,p,_){"use strict";e.templates.chatarea=n,e.templates.chatroom=i,e.templates.chatroom_form=o,e.templates.chatroom_nickname_form=s,e.templates.chatroom_password_form=a,e.templates.chatroom_sidebar=r,e.templates.chatrooms_tab=c,e.templates.info=d,e.templates.occupant=u,e.templates.room_description=h,e.templates.room_item=p,e.templates.room_panel=_;var m="chatrooms",f=t.env.Strophe,g=t.env.$iq,v=t.env.$build,b=t.env.$msg,y=t.env.$pres,w=t.env.b64_sha1,x=t.env.utils,C=t.env.jQuery,k=t.env._,S=t.env.moment,j=x.__.bind(e),N=x.___;e.muc={info_messages:{100:j("This room is not anonymous"),102:j("This room now shows unavailable members"),103:j("This room does not show unavailable members"),104:j("Non-privacy-related room configuration has changed"),170:j("Room logging is now enabled"),171:j("Room logging is now disabled"),172:j("This room is now non-anonymous"),173:j("This room is now semi-anonymous"),174:j("This room is now fully-anonymous"),201:j("A new room has been created")},disconnect_messages:{301:j("You have been banned from this room"),307:j("You have been kicked from this room"),321:j("You have been removed from this room because of an affiliation change"),322:j("You have been removed from this room because the room has changed to members-only and you're not a member"),332:j("You have been removed from this room because the MUC (Multi-user chat) service is being shut down.")},action_info_messages:{301:N("<strong>%1$s</strong> has been banned"),303:N("<strong>%1$s</strong>'s nickname has changed"),307:N("<strong>%1$s</strong> has been kicked out"),321:N("<strong>%1$s</strong> has been removed because of an affiliation change"),322:N("<strong>%1$s</strong> has been removed for not being a member")},new_nickname_messages:{210:N("Your nickname has been automatically set to: <strong>%1$s</strong>"),303:N("Your nickname has been changed to: <strong>%1$s</strong>")}},f.addNamespace("MUC_ADMIN",f.NS.MUC+"#admin"),f.addNamespace("MUC_OWNER",f.NS.MUC+"#owner"),f.addNamespace("MUC_REGISTER","jabber:iq:register"),f.addNamespace("MUC_ROOMCONF",f.NS.MUC+"#roomconfig"),f.addNamespace("MUC_USER",f.NS.MUC+"#user"),t.plugins.add("converse-muc",{optional_dependencies:["converse-controlbox"],overrides:{wrappedChatBox:function(t){if(t){var n=e.chatboxviews.get(t.get("id")),i=this.__super__.wrappedChatBox.apply(this,arguments);return i.is_chatroom=n.is_chatroom,i}},Features:{addClientFeatures:function(){this.__super__.addClientFeatures.apply(this,arguments),e.allow_muc_invitations&&e.connection.disco.addFeature("jabber:x:conference"),e.allow_muc&&e.connection.disco.addFeature(f.NS.MUC)}},ControlBoxView:{renderContactsPanel:function(){var e=this.__super__.converse;this.__super__.renderContactsPanel.apply(this,arguments),e.allow_muc&&(this.roomspanel=new e.RoomsPanel({$parent:this.$el.find(".controlbox-panes"),model:new(Backbone.Model.extend({id:w("converse.roomspanel"+e.bare_jid),browserStorage:new Backbone.BrowserStorage[e.storage](w("converse.roomspanel"+e.bare_jid))}))}),this.roomspanel.render().model.fetch(),this.roomspanel.model.get("nick")||this.roomspanel.model.save({nick:f.getNodeFromJid(e.bare_jid)}))},onConnected:function(){var e=this.__super__.converse;if(this.__super__.onConnected.apply(this,arguments),this.model.get("connected"))if(k.isUndefined(e.muc_domain)){e.features.off("add",this.featureAdded,this),e.features.on("add",this.featureAdded,this);var t=e.features.findWhere({var:f.NS.MUC});t&&this.featureAdded(t)}else this.setMUCDomain(e.muc_domain)},setMUCDomain:function(e){this.roomspanel.model.save({muc_domain:e});var t=this.$el.find("input.new-chatroom-server");t.is(":focus")||t.val(this.roomspanel.model.get("muc_domain"))},featureAdded:function(e){var t=this.__super__.converse;e.get("var")===f.NS.MUC&&t.allow_muc&&this.setMUCDomain(e.get("from"))}},ChatBoxViews:{onChatBoxAdded:function(t){var n=this.get(t.get("id"));return n||"chatroom"!==t.get("type")?this.__super__.onChatBoxAdded.apply(this,arguments):(n=new e.ChatRoomView({model:t}),this.add(t.get("id"),n))}}},initialize:function(){var e=this.converse;this.updateSettings({allow_muc:!0,allow_muc_invitations:!0,auto_join_on_invite:!1,auto_join_rooms:[],auto_list_rooms:!1,hide_muc_server:!1,muc_domain:void 0,muc_history_max_stanzas:void 0,muc_instant_rooms:!0,muc_nickname_from_jid:!1,visible_toolbar_buttons:{toggle_occupants:!0}}),e.ChatRoomView=e.ChatBoxView.extend({length:300,tagName:"div",className:"chatbox chatroom hidden",is_chatroom:!0,events:{"click .close-chatbox-button":"close","click .configure-chatroom-button":"configureChatRoom","click .toggle-smiley":"toggleEmoticonMenu","click .toggle-smiley ul li":"insertEmoticon","click .toggle-clear":"clearChatRoomMessages","click .toggle-call":"toggleCall","click .toggle-occupants a":"toggleOccupants","click .new-msgs-indicator":"viewUnreadMessages","click .occupant":"onOccupantClicked","keypress .chat-textarea":"keyPressed"},initialize:function(){this.model.messages.on("add",this.onMessageAdded,this),this.model.on("show",this.show,this),this.model.on("destroy",this.hide,this),this.model.on("change:chat_state",this.sendChatState,this),this.occupantsview=new e.ChatRoomOccupantsView({model:new e.ChatRoomOccupants({nick:this.model.get("nick")})});var t=w("converse.occupants"+e.bare_jid+this.model.get("id")+this.model.get("nick"));this.occupantsview.model.browserStorage=new Backbone.BrowserStorage.session(t),this.occupantsview.chatroomview=this,this.render(),this.occupantsview.model.fetch({add:!0});var n=this.model.get("nick");n?this.join(n):this.checkForReservedNick(),this.fetchMessages().insertIntoDOM(),this.$el.find(".chat-content").on("scroll",this.markScrolled.bind(this)),e.emit("chatRoomOpened",this)},insertIntoDOM:function(){var t=e.chatboxviews.get("controlbox");return t?this.$el.insertAfter(t.$el):C("#conversejs").prepend(this.$el),this},render:function(){return this.$el.attr("id",this.model.get("box_id")).html(e.templates.chatroom(k.extend(this.model.toJSON(),{info_close:j("Close and leave this room"),info_configure:j("Configure this room")}))),this.renderChatArea(),x.refreshWebkit(),this},renderChatArea:function(){return this.$(".chat-area").length||(this.$(".chatroom-body").empty().append(e.templates.chatarea({unread_msgs:j("You have unread messages"),show_toolbar:e.show_toolbar,label_message:j("Message")})).append(this.occupantsview.render().$el),this.renderToolbar(l),this.$content=this.$el.find(".chat-content")),this.toggleOccupants(null,!0),this},getToolbarOptions:function(){return k.extend(e.ChatBoxView.prototype.getToolbarOptions.apply(this,arguments),{label_hide_occupants:j("Hide the list of occupants"),show_occupants_toggle:this.is_chatroom&&e.visible_toolbar_buttons.toggle_occupants})},close:function(t){this.leave(),e.ChatBoxView.prototype.close.apply(this,arguments)},toggleOccupants:function(e,t){e&&(e.preventDefault(),e.stopPropagation()),t&&this.model.set({hidden_occupants:!this.model.get("hidden_occupants")}),this.model.get("hidden_occupants")?(this.model.save({hidden_occupants:!1}),this.$(".icon-show-users").removeClass("icon-show-users").addClass("icon-hide-users"),this.$(".chat-area").removeClass("full"),this.$("div.occupants").removeClass("hidden"),this.scrollDown()):(this.model.save({hidden_occupants:!0}),this.$(".icon-hide-users").removeClass("icon-hide-users").addClass("icon-show-users"),this.$(".occupants").addClass("hidden"),this.$(".chat-area").addClass("full"),this.scrollDown())},onOccupantClicked:function(e){this.insertIntoTextArea(e.target.textContent)},directInvite:function(t,n){var i={xmlns:"jabber:x:conference",jid:this.model.get("jid")};null!==n&&(i.reason=n),this.model.get("password")&&(i.password=this.model.get("password"));var o=b({from:e.connection.jid,to:t,id:e.connection.getUniqueId()}).c("x",i);e.connection.send(o),e.emit("roomInviteSent",{room:this,recipient:t,reason:n})},onCommandError:function(e){this.showStatusNotification(j("Error: could not execute the command"),!0)},handleChatStateMessage:function(t){t.get("fullname")!==this.model.get("nick")&&t.get("chat_state")!==e.GONE&&e.ChatBoxView.prototype.handleChatStateMessage.apply(this,arguments)},sendChatState:function(){var t=this.model.get("chat_state");t!==e.GONE&&e.connection.send(b({to:this.model.get("jid"),type:"groupchat"}).c(t,{xmlns:f.NS.CHATSTATES}).up().c("no-store",{xmlns:f.NS.HINTS}).up().c("no-permanent-store",{xmlns:f.NS.HINTS}))},sendChatRoomMessage:function(t){var n=e.connection.getUniqueId(),i=b({to:this.model.get("jid"),from:e.connection.jid,type:"groupchat",id:n}).c("body").t(t).up().c("x",{xmlns:"jabber:x:event"}).c(e.COMPOSING);e.connection.send(i),this.model.messages.create({fullname:this.model.get("nick"),sender:"me",time:S().format(),message:t,msgid:n})},setAffiliation:function(t,n,i,o,s,a){var r=v("item",{jid:n,affiliation:i}),l=g({to:t,type:"set"}).c("query",{xmlns:f.NS.MUC_ADMIN}).cnode(r.node);return null!==o&&l.c("reason",o),e.connection.sendIQ(l.tree(),s,a)},modifyRole:function(t,n,i,o,s,a){var r=v("item",{nick:n,role:i}),l=g({to:t,type:"set"}).c("query",{xmlns:f.NS.MUC_ADMIN}).cnode(r.node);return null!==o&&l.c("reason",o),e.connection.sendIQ(l.tree(),s,a)},member:function(e,t,n,i,o){return this.setAffiliation(e,t,"member",n,i,o)},revoke:function(e,t,n,i,o){return this.setAffiliation(e,t,"none",n,i,o)},owner:function(e,t,n,i,o){return this.setAffiliation(e,t,"owner",n,i,o)},admin:function(e,t,n,i,o){return this.setAffiliation(e,t,"admin",n,i,o)},validateRoleChangeCommand:function(e,t){return!(t.length<1||t.length>2)||(this.showStatusNotification(j('Error: the "'+e+"\" command takes two arguments, the user's nickname and optionally a reason."),!0),!1)},clearChatRoomMessages:function(e){"undefined"!=typeof e&&e.stopPropagation();var t=confirm(j("Are you sure you want to clear the messages from this room?"));return t===!0&&this.$content.empty(),this},onMessageSubmitted:function(t){var n=t.replace(/^\s*/,"").match(/^\/(.*?)(?: (.*))?$/)||[!1,"",""],i=n[2]&&n[2].splitOnce(" ")||[];switch(n[1]){case"admin":if(!this.validateRoleChangeCommand(n[1],i))break;this.setAffiliation(this.model.get("jid"),i[0],"admin",i[1],void 0,this.onCommandError.bind(this));break;case"ban":if(!this.validateRoleChangeCommand(n[1],i))break;this.setAffiliation(this.model.get("jid"),i[0],"outcast",i[1],void 0,this.onCommandError.bind(this));break;case"clear":this.clearChatRoomMessages();break;case"deop":if(!this.validateRoleChangeCommand(n[1],i))break;this.modifyRole(this.model.get("jid"),i[0],"occupant",i[1],void 0,this.onCommandError.bind(this));break;case"help":this.showHelpMessages(["<strong>/admin</strong>: "+j("Change user's affiliation to admin"),"<strong>/ban</strong>: "+j("Ban user from room"),"<strong>/clear</strong>: "+j("Remove messages"),"<strong>/deop</strong>: "+j("Change user role to occupant"),"<strong>/help</strong>: "+j("Show this menu"),"<strong>/kick</strong>: "+j("Kick user from room"),"<strong>/me</strong>: "+j("Write in 3rd person"),"<strong>/member</strong>: "+j("Grant membership to a user"),"<strong>/mute</strong>: "+j("Remove user's ability to post messages"),"<strong>/nick</strong>: "+j("Change your nickname"),"<strong>/op</strong>: "+j("Grant moderator role to user"),"<strong>/owner</strong>: "+j("Grant ownership of this room"),"<strong>/revoke</strong>: "+j("Revoke user's membership"),"<strong>/topic</strong>: "+j("Set room topic"),"<strong>/voice</strong>: "+j("Allow muted user to post messages")]);break;case"kick":if(!this.validateRoleChangeCommand(n[1],i))break;this.modifyRole(this.model.get("jid"),i[0],"none",i[1],void 0,this.onCommandError.bind(this));break;case"mute":if(!this.validateRoleChangeCommand(n[1],i))break;this.modifyRole(this.model.get("jid"),i[0],"visitor",i[1],void 0,this.onCommandError.bind(this));break;case"member":if(!this.validateRoleChangeCommand(n[1],i))break;this.setAffiliation(this.model.get("jid"),i[0],"member",i[1],void 0,this.onCommandError.bind(this));break;case"nick":e.connection.send(y({from:e.connection.jid,to:this.getRoomJIDAndNick(n[2]),id:e.connection.getUniqueId()}).tree());break;case"owner":if(!this.validateRoleChangeCommand(n[1],i))break;this.setAffiliation(this.model.get("jid"),i[0],"owner",i[1],void 0,this.onCommandError.bind(this));break;case"op":if(!this.validateRoleChangeCommand(n[1],i))break;this.modifyRole(this.model.get("jid"),i[0],"moderator",i[1],void 0,this.onCommandError.bind(this));break;case"revoke":if(!this.validateRoleChangeCommand(n[1],i))break;this.setAffiliation(this.model.get("jid"),i[0],"none",i[1],void 0,this.onCommandError.bind(this));break;case"topic":e.connection.send(b({to:this.model.get("jid"),from:e.connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(n[2]).tree());break;case"voice":if(!this.validateRoleChangeCommand(n[1],i))break;this.modifyRole(this.model.get("jid"),i[0],"occupant",i[1],void 0,this.onCommandError.bind(this));break;default:this.sendChatRoomMessage(t)}},handleMUCMessage:function(e){var t=C(e).find('[xmlns="'+f.NS.MAM+'"]').length>0;return!!t||(k.compose(this.onChatRoomMessage.bind(this),this.showStatusMessages.bind(this))(e),!0)},getRoomJIDAndNick:function(e){e?this.model.save({nick:e}):e=this.model.get("nick");var t=this.model.get("jid"),n=f.getNodeFromJid(t),i=f.getDomainFromJid(t);return n+"@"+i+(null!==e?"/"+e:"")},registerHandlers:function(){var t=this.model.get("jid");this.removeHandlers(),this.presence_handler=e.connection.addHandler(this.onChatRoomPresence.bind(this),f.NS.MUC,"presence",null,null,t,{ignoreNamespaceFragment:!0,matchBareFromJid:!0}),this.message_handler=e.connection.addHandler(this.handleMUCMessage.bind(this),null,"message",null,null,t,{matchBareFromJid:!0})},removeHandlers:function(){return this.message_handler&&(e.connection.deleteHandler(this.message_handler),delete this.message_handler),this.presence_handler&&(e.connection.deleteHandler(this.presence_handler),delete this.presence_handler),this},join:function(t,n){this.registerHandlers();var i=y({from:e.connection.jid,to:this.getRoomJIDAndNick(t)}).c("x",{xmlns:f.NS.MUC}).c("history",{maxstanzas:e.muc_history_max_stanzas}).up();return n&&i.cnode(f.xmlElement("password",[],n)),this.model.set("connection_status",f.Status.CONNECTING),e.connection.send(i)},cleanup:function(){this.model.set("connection_status",f.Status.DISCONNECTED),this.removeHandlers()},leave:function(t){if(!e.connection.connected)return void this.cleanup();var n=e.connection.getUniqueId(),i=y({type:"unavailable",id:n,from:e.connection.jid,to:this.getRoomJIDAndNick()});null!==t&&i.c("status",t),e.connection.addHandler(this.cleanup.bind(this),null,"presence",null,n),e.connection.send(i)},renderConfigurationForm:function(e){var t=this.$el.find("form.chatroom-form"),n=t.children("fieldset:first"),i=C(e),o=i.find("field"),s=i.find("title").text(),a=i.find("instructions").text();n.find("span.spinner").remove(),n.append(C("<legend>").text(s)),a&&a!==s&&n.append(C('<p class="instructions">').text(a)),k.each(o,function(e){n.append(x.xForm2webForm(C(e),i))}),t.append("<fieldset></fieldset>"),n=t.children("fieldset:last"),n.append('<input type="submit" class="pure-button button-primary" value="'+j("Save")+'"/>'),n.append('<input type="button" class="pure-button button-cancel" value="'+j("Cancel")+'"/>'),n.find("input[type=button]").on("click",this.cancelConfiguration.bind(this)),t.on("submit",this.saveConfiguration.bind(this))},sendConfiguration:function(t,n,i){var o=g({to:this.model.get("jid"),type:"set"}).c("query",{xmlns:f.NS.MUC_OWNER}).c("x",{xmlns:f.NS.XFORM,type:"submit"});return k.each(t,function(e){o.cnode(e).up()}),e.connection.sendIQ(o.tree(),n,i)},saveConfiguration:function(e){e.preventDefault();var t=this,n=C(e.target).find(":input:not([type=button]):not([type=submit])"),i=n.length,o=[];n.each(function(){o.push(x.webForm2xForm(this)),--i||t.sendConfiguration(o,t.onConfigSaved.bind(t),t.onErrorConfigSaved.bind(t))}),this.$el.find("div.chatroom-form-container").hide(function(){C(this).remove(),t.$el.find(".chat-area").removeClass("hidden"),t.$el.find(".occupants").removeClass("hidden")})},autoConfigureChatRoom:function(e){var t=this,n=[],i=C(e).find("field"),o=i.length,s=this.model.get("roomconfig");i.each(function(){var e,i=this.getAttribute("var").replace("muc#roomconfig_",""),a=this.getAttribute("type");if(i in s){switch(a){case"boolean":e=s[i]?1:0;break;case"list-multi":e=this.innerHTML;break;default:e=s[i]}this.innerHTML=v("value").t(e)}n.push(this),--o||t.sendConfiguration(n,t.onConfigSaved.bind(t),t.onErrorConfigSaved.bind(t))})},onConfigSaved:function(e){},onErrorConfigSaved:function(e){this.showStatusNotification(j("An error occurred while trying to save the form."))},cancelConfiguration:function(e){e.preventDefault();var t=this;this.$el.find("div.chatroom-form-container").hide(function(){C(this).remove(),t.$el.find(".chat-area").removeClass("hidden"),t.$el.find(".occupants").removeClass("hidden")})},configureChatRoom:function(t){var n;if("undefined"!=typeof t&&t.preventDefault&&t.preventDefault(),this.model.get("auto_configure"))n=this.autoConfigureChatRoom.bind(this);else{if(this.$el.find("div.chatroom-form-container").length)return;var i=this.$(".chatroom-body");i.children().addClass("hidden"),i.append(e.templates.chatroom_form()),n=this.renderConfigurationForm.bind(this)}e.connection.sendIQ(g({to:this.model.get("jid"),type:"get"}).c("query",{xmlns:f.NS.MUC_OWNER}).tree(),n)},submitNickname:function(e){e.preventDefault();var t=this.$el.find("input[name=nick]"),n=t.val();return n?(t.removeClass("error"),this.$el.find(".chatroom-form-container").replaceWith('<span class="spinner centered"/>'),void this.join(n)):void t.addClass("error")},checkForReservedNick:function(){this.showSpinner(),e.connection.sendIQ(g({to:this.model.get("jid"),from:e.connection.jid,type:"get"}).c("query",{xmlns:f.NS.DISCO_INFO,node:"x-roomuser-item"}),this.onNickNameFound.bind(this),this.onNickNameNotFound.bind(this))},onNickNameFound:function(e){var t=C(e).find('query[node="x-roomuser-item"] identity').attr("name");t?this.join(t):this.onNickNameNotFound()},onNickNameNotFound:function(t){e.muc_nickname_from_jid?this.join(f.unescapeNode(f.getNodeFromJid(e.bare_jid))):this.renderNicknameForm(t)},getDefaultNickName:function(){return f.unescapeNode(f.getNodeFromJid(e.bare_jid))},onNicknameClash:function(t){if(e.muc_nickname_from_jid){var n=t.getAttribute("from").split("/")[1];if(n===this.getDefaultNickName())this.join(n+"-2");else{var i=n.lastIndexOf("-"),o=n.substring(i+1,n.length);this.join(n.substring(0,i+1)+String(Number(o)+1))}}else this.renderNicknameForm(j("The nickname you chose is reserved or currently in use, please choose a different one."))},renderNicknameForm:function(t){this.$(".chatroom-body").children().addClass("hidden"),this.$("span.centered.spinner").remove(),"string"!=typeof t&&(t=""),this.$(".chatroom-body").append(e.templates.chatroom_nickname_form({heading:j("Please choose your nickname"),label_nickname:j("Nickname"),label_join:j("Enter room"),validation_message:t})),this.$(".chatroom-form").on("submit",this.submitNickname.bind(this))},submitPassword:function(e){e.preventDefault();var t=this.$el.find(".chatroom-form").find("input[type=password]").val();this.$el.find(".chatroom-form-container").replaceWith('<span class="spinner centered"/>'),this.join(this.model.get("nick"),t)},renderPasswordForm:function(){this.$(".chatroom-body").children().addClass("hidden"),this.$("span.centered.spinner").remove(),this.$(".chatroom-body").append(e.templates.chatroom_password_form({heading:j("This chatroom requires a password"),label_password:j("Password: "),label_submit:j("Submit")})),this.$(".chatroom-form").on("submit",this.submitPassword.bind(this))},showDisconnectMessage:function(e){this.$(".chat-area").addClass("hidden"),this.$(".occupants").addClass("hidden"),this.$("span.centered.spinner").remove(),this.$(".chatroom-body").append(C("<p>"+e+"</p>"))},getMessageFromStatus:function(t,n,i,o){var s=t.getAttribute("code");return n&&"210"===s?j(e.muc.new_nickname_messages[s],i):n&&"303"===s?j(e.muc.new_nickname_messages[s],o.getAttribute("nick")):!n&&s in e.muc.action_info_messages?j(e.muc.action_info_messages[s],i):s in e.muc.info_messages?e.muc.info_messages[s]:"110"!==s&&t.textContent?t.textContent:void 0},parseXUserElement:function(t,n,i){var o=t.querySelector("item"),s=o.getAttribute("jid"),a=o.getAttribute("affiliation");f.getBareJidFromJid(s)===e.bare_jid&&"owner"===a&&this.$el.find("a.configure-chatroom-button").show();var r=t.querySelectorAll("status"),l=k.partial(this.getMessageFromStatus,k,n,i,o),c={messages:k.reject(k.map(r,l),k.isUndefined)},d=o.querySelector("reason");d&&(c.reason=d?d.textContent:void 0);var u=o.querySelector("actor");u&&(c.actor=u?u.getAttribute("nick"):void 0);var h=k.map(r,function(e){return e.getAttribute("code")}),p=k.intersection(h,k.keys(e.muc.disconnect_messages)),_=n&&p.length>0;return _&&(c.disconnected=!0,c.disconnection_message=e.muc.disconnect_messages[p[0]]),c},displayNotificationsforUser:function(t){var n=this;return t.disconnected?(this.showDisconnectMessage(t.disconnection_message),t.actor&&this.showDisconnectMessage(j(N("This action was done by <strong>%1$s</strong>."),t.actor)),t.reason&&this.showDisconnectMessage(j(N('The reason given is: <em>"%1$s"</em>.'),t.reason)),void this.model.set("connection_status",f.Status.DISCONNECTED)):(k.each(t.messages,function(t){n.$content.append(e.templates.info({message:t}))}),t.reason&&this.showStatusNotification(j('The reason given is: "'+t.reason+'"'),!0),void(t.messages.length&&this.scrollDown()))},showStatusMessages:function(e,t){var n=f.unescapeNode(f.getResourceFromJid(e.getAttribute("from"))),i=k.map(e.querySelectorAll('x[xmlns="'+f.NS.MUC_USER+'"]'),k.partial(this.parseXUserElement.bind(this),k,t,n));return k.each(i,this.displayNotificationsforUser.bind(this)),e},showErrorMessage:function(e){var t=C(e).find("error");"auth"===t.attr("type")?t.find("not-authorized").length?this.renderPasswordForm():t.find("registration-required").length?this.showDisconnectMessage(j("You are not on the member list of this room")):t.find("forbidden").length&&this.showDisconnectMessage(j("You have been banned from this room")):"modify"===t.attr("type")?t.find("jid-malformed").length&&this.showDisconnectMessage(j("No nickname was specified")):"cancel"===t.attr("type")&&(t.find("not-allowed").length?this.showDisconnectMessage(j("You are not allowed to create new rooms")):t.find("not-acceptable").length?this.showDisconnectMessage(j("Your nickname doesn't conform to this room's policies")):t.find("conflict").length?this.onNicknameClash(e):t.find("item-not-found").length?this.showDisconnectMessage(j("This room does not (yet) exist")):t.find("service-unavailable").length&&this.showDisconnectMessage(j("This room has reached its maximum number of occupants")))},showSpinner:function(){this.$(".chatroom-body").children().addClass("hidden"),this.$el.find(".chatroom-body").prepend('<span class="spinner centered"/>')},hideSpinner:function(){var e=this,t=this.$el.find(".spinner");return t.length&&t.hide(function(){C(this).remove(),e.$el.find(".chat-area").removeClass("hidden"),e.$el.find(".occupants").removeClass("hidden"),e.scrollDown()}),this},onChatRoomPresence:function(t){var n,i,o=C(t),s=this.model.get("nick");return"error"===o.attr("type")?(this.model.set("connection_status",f.Status.DISCONNECTED),this.showErrorMessage(t)):(n=o.find("status[code='110']").length||o.attr("from")===this.model.get("id")+"/"+f.escapeNode(s),i=o.find("status[code='201']").length,n&&(this.model.set("connection_status",f.Status.CONNECTED),!e.muc_instant_rooms&&i?this.configureChatRoom():this.hideSpinner().showStatusMessages(t,n))),this.occupantsview.updateOccupantsOnPresence(t),!0},setChatRoomSubject:function(t,n){this.$el.find(".chatroom-topic").text(n).attr("title",n),this.$content.append(e.templates.info({message:j("Topic set by %1$s to: %2$s",t,n)})),this.scrollDown()},onChatRoomMessage:function(t){var n,i=C(t),o=i.find("forwarded");o.length&&(i=o.children("message"),n=o.children("delay"));var s=i.attr("from"),a=i.attr("id"),r=f.getResourceFromJid(s),l=r&&f.unescapeNode(r)||"",c=i.children("subject").text(),d=a&&this.model.messages.filter(function(e){return e.get("msgid")===a&&e.get("fullname")===l});return!(!d||!d.length)||(c&&this.setChatRoomSubject(l,c),""===l||(this.model.createMessage(i,n,t),l!==this.model.get("nick")&&e.emit("message",t),!0))},fetchArchivedMessages:function(n){return e.features.findWhere({var:f.NS.MAM})?(this.addSpinner(),void t.archive.query(k.extend(n,{groupchat:!0}),function(e){this.clearSpinner(),e.length&&k.map(e,this.onChatRoomMessage.bind(this))}.bind(this),function(){this.clearSpinner(),e.log("Error while trying to fetch archived messages","error")}.bind(this))):void e.log("Attempted to fetch archived messages but this user's server doesn't support XEP-0313")}}),e.ChatRoomOccupant=Backbone.Model.extend({initialize:function(t){
this.set(k.extend({id:e.connection.getUniqueId()},t))}}),e.ChatRoomOccupantView=Backbone.View.extend({tagName:"li",initialize:function(){this.model.on("change",this.render,this),this.model.on("destroy",this.destroy,this)},render:function(){var t=e.templates.occupant(k.extend(this.model.toJSON(),{hint_occupant:j("Click to mention this user in your message."),desc_moderator:j("This user is a moderator."),desc_occupant:j("This user can send messages in this room."),desc_visitor:j("This user can NOT send messages in this room.")})),n=this.$el.parents();return n.length?(this.$el.replaceWith(t),this.setElement(n.first().children("#"+this.model.get("id")),!0),this.delegateEvents()):(this.$el.replaceWith(t),this.setElement(t,!0)),this},destroy:function(){this.$el.remove()}}),e.ChatRoomOccupants=Backbone.Collection.extend({model:e.ChatRoomOccupant}),e.ChatRoomOccupantsView=Backbone.Overview.extend({tagName:"div",className:"occupants",initialize:function(){this.model.on("add",this.onOccupantAdded,this)},render:function(){return this.$el.html(e.templates.chatroom_sidebar({allow_muc_invitations:e.allow_muc_invitations,label_invitation:j("Invite"),label_occupants:j("Occupants")})),e.allow_muc_invitations?this.initInviteWidget():this},onOccupantAdded:function(t){var n=this.get(t.get("id"));n?(delete n.model,n.model=t,n.initialize()):n=this.add(t.get("id"),new e.ChatRoomOccupantView({model:t})),this.$(".occupant-list").append(n.render().$el)},parsePresence:function(e){var t=f.getResourceFromJid(e.getAttribute("from")),n={nick:t,type:e.getAttribute("type"),states:[]};return k.each(e.childNodes,function(e){switch(e.nodeName){case"status":n.status=e.textContent||null;break;case"show":n.show=e.textContent||null;break;case"x":e.getAttribute("xmlns")===f.NS.MUC_USER&&k.each(e.childNodes,function(e){switch(e.nodeName){case"item":n.affiliation=e.getAttribute("affiliation"),n.role=e.getAttribute("role"),n.jid=e.getAttribute("jid"),n.nick=e.getAttribute("nick")||n.nick;break;case"status":e.getAttribute("code")&&n.states.push(e.getAttribute("code"))}})}}),n},findOccupant:function(e){var t=f.getBareJidFromJid(e.jid);return null!==t?this.model.where({jid:t}).pop():this.model.where({nick:e.nick}).pop()},updateOccupantsOnPresence:function(e){var t=this.parsePresence(e);if("error"===t.type)return!0;var n=this.findOccupant(t);switch(t.type){case"unavailable":n&&n.destroy();break;default:var i=f.getBareJidFromJid(t.jid),o=k.extend(t,{jid:i?i:void 0,resource:t.jid?f.getResourceFromJid(t.jid):void 0});n?n.save(o):this.model.create(o)}},initInviteWidget:function(){var t=this.$("input.invited-contact");return t.typeahead({minLength:1,highlight:!0},{name:"contacts-dataset",source:function(t,n){var i=[];k.each(e.roster.filter(x.contains(["fullname","jid"],t)),function(e){i.push({value:e.get("fullname"),jid:e.get("jid")})}),n(i)},templates:{suggestion:k.template('<p data-jid="{{jid}}">{{value}}</p>')}}),t.on("typeahead:selected",function(e,t,n){var i=prompt(j(N('You are about to invite %1$s to the chat room "%2$s". '),t.value,this.model.get("id"))+j("You may optionally include a message, explaining the reason for the invitation."));null!==i&&this.chatroomview.directInvite(t.jid,i),C(e.target).typeahead("val","")}.bind(this)),this}}),e.RoomsPanel=Backbone.View.extend({tagName:"div",className:"controlbox-pane",id:"chatrooms",events:{"submit form.add-chatroom":"createChatRoom","click input#show-rooms":"showRooms","click a.open-room":"createChatRoom","click a.room-info":"toggleRoomInfo","change input[name=server]":"setDomain","change input[name=nick]":"setNick"},initialize:function(e){this.$parent=e.$parent,this.model.on("change:muc_domain",this.onDomainChange,this),this.model.on("change:nick",this.onNickChange,this)},render:function(){this.$parent.append(this.$el.html(e.templates.room_panel({server_input_type:e.hide_muc_server&&"hidden"||"text",server_label_global_attr:e.hide_muc_server&&" hidden"||"",label_room_name:j("Room name"),label_nickname:j("Nickname"),label_server:j("Server"),label_join:j("Join Room"),label_show_rooms:j("Show rooms")}))),this.$tabs=this.$parent.parent().find("#controlbox-tabs");var t=e.chatboxes.get("controlbox");return this.$tabs.append(e.templates.chatrooms_tab({label_rooms:j("Rooms"),is_current:t.get("active-panel")===m})),t.get("active-panel")!==m&&this.$el.addClass("hidden"),this},onDomainChange:function(t){var n=this.$el.find("input.new-chatroom-server");n.val(t.get("muc_domain")),e.auto_list_rooms&&this.updateRoomsList()},onNickChange:function(e){var t=this.$el.find("input.new-chatroom-nick");t.val(e.get("nick"))},informNoRoomsFound:function(){var e=this.$el.find("#available-chatrooms");e.html("<dt>"+j("No rooms on %1$s",this.model.get("muc_domain"))+"</dt>"),C("input#show-rooms").show().siblings("span.spinner").remove()},onRoomsFound:function(t){var n,i,o,s,a=this.$el.find("#available-chatrooms");if(this.rooms=C(t).find("query").find("item"),this.rooms.length){for(a.html("<dt>"+j("Rooms on %1$s",this.model.get("muc_domain"))+"</dt>"),s=document.createDocumentFragment(),o=0;o<this.rooms.length;o++)n=f.unescapeNode(C(this.rooms[o]).attr("name")||C(this.rooms[o]).attr("jid")),i=C(this.rooms[o]).attr("jid"),s.appendChild(C(e.templates.room_item({name:n,jid:i,open_title:j("Click to open this room"),info_title:j("Show more information on this room")}))[0]);a.append(s),C("input#show-rooms").show().siblings("span.spinner").remove()}else this.informNoRoomsFound();return!0},updateRoomsList:function(){e.connection.sendIQ(g({to:this.model.get("muc_domain"),from:e.connection.jid,type:"get"}).c("query",{xmlns:f.NS.DISCO_ITEMS}),this.onRoomsFound.bind(this),this.informNoRoomsFound.bind(this))},showRooms:function(){var e=this.$el.find("#available-chatrooms"),t=this.$el.find("input.new-chatroom-server"),n=t.val();return n?(this.$el.find("input.new-chatroom-name").removeClass("error"),t.removeClass("error"),e.empty(),C("input#show-rooms").hide().after('<span class="spinner"/>'),this.model.save({muc_domain:n}),void this.updateRoomsList()):void t.addClass("error")},insertRoomInfo:function(t,n){var i=C(n);t.find("span.spinner").replaceWith(e.templates.room_description({desc:i.find('field[var="muc#roominfo_description"] value').text(),occ:i.find('field[var="muc#roominfo_occupants"] value').text(),hidden:i.find('feature[var="muc_hidden"]').length,membersonly:i.find('feature[var="muc_membersonly"]').length,moderated:i.find('feature[var="muc_moderated"]').length,nonanonymous:i.find('feature[var="muc_nonanonymous"]').length,open:i.find('feature[var="muc_open"]').length,passwordprotected:i.find('feature[var="muc_passwordprotected"]').length,persistent:i.find('feature[var="muc_persistent"]').length,publicroom:i.find('feature[var="muc_public"]').length,semianonymous:i.find('feature[var="muc_semianonymous"]').length,temporary:i.find('feature[var="muc_temporary"]').length,unmoderated:i.find('feature[var="muc_unmoderated"]').length,label_desc:j("Description:"),label_occ:j("Occupants:"),label_features:j("Features:"),label_requires_auth:j("Requires authentication"),label_hidden:j("Hidden"),label_requires_invite:j("Requires an invitation"),label_moderated:j("Moderated"),label_non_anon:j("Non-anonymous"),label_open_room:j("Open room"),label_permanent_room:j("Permanent room"),label_public:j("Public"),label_semi_anon:j("Semi-anonymous"),label_temp_room:j("Temporary room"),label_unmoderated:j("Unmoderated")}))},toggleRoomInfo:function(t){var n=t.target,i=C(n).parent("dd"),o=i.find("div.room-info");o.length?o.remove():(i.find("span.spinner").remove(),i.append('<span class="spinner hor_centered"/>'),e.connection.disco.info(C(n).attr("data-room-jid"),null,k.partial(this.insertRoomInfo,i)))},createChatRoom:function(t){t.preventDefault();var n,i,o,s,a;if("click"===t.type)n=C(t.target).text(),a=C(t.target).attr("data-room-jid");else{if(i=this.$el.find("input.new-chatroom-name"),s=this.$el.find("input.new-chatroom-server"),o=s.val(),n=i.val().trim(),i.val(""),!n||!o)return n||i.addClass("error"),void(o||s.addClass("error"));a=f.escapeNode(n.toLowerCase())+"@"+o.toLowerCase(),i.removeClass("error"),s.removeClass("error"),this.model.save({muc_domain:o})}e.chatboxviews.showChat({id:a,jid:a,name:n||f.unescapeNode(f.getNodeFromJid(a)),type:"chatroom",box_id:w(a)})},setDomain:function(e){this.model.save({muc_domain:e.target.value})},setNick:function(e){this.model.save({nick:e.target.value})}}),e.onDirectMUCInvitation=function(t){var n,i=C(t),o=i.children('x[xmlns="jabber:x:conference"]'),s=f.getBareJidFromJid(i.attr("from")),a=o.attr("jid"),r=o.attr("reason"),l=e.roster.get(s);if(e.auto_join_on_invite?n=!0:(l=l?l.get("fullname"):f.getNodeFromJid(s),n=r?confirm(j(N('%1$s has invited you to join a chat room: %2$s, and left the following reason: "%3$s"'),l,a,r)):confirm(j(N("%1$s has invited you to join a chat room: %2$s"),l,a))),n===!0){var c=e.chatboxviews.showChat({id:a,jid:a,name:f.unescapeNode(f.getNodeFromJid(a)),nick:f.unescapeNode(f.getNodeFromJid(e.connection.jid)),type:"chatroom",box_id:w(a),password:o.attr("password")});k.contains([f.Status.CONNECTING,f.Status.CONNECTED],c.get("connection_status"))||e.chatboxviews.get(a).join()}};var n=function(){k.each(e.auto_join_rooms,function(n){"string"==typeof n?t.rooms.open(n):"object"==typeof n?t.rooms.open(n.jid,n.nick):e.log('Invalid room criteria specified for "auto_join_rooms"',"error")})};if(e.on("chatBoxesFetched",n),e.allow_muc_invitations){var i=function(){e.connection.addHandler(function(t){return e.onDirectMUCInvitation(t),!0},"jabber:x:conference","message")};e.on("connected",i),e.on("reconnected",i)}var o=function(t,n,i){return t=t.toLowerCase(),e.wrappedChatBox(i(k.extend({id:t,jid:t,name:f.unescapeNode(f.getNodeFromJid(t)),type:"chatroom",box_id:w(t)},n)))};k.extend(t,{rooms:{close:function(t){if("undefined"==typeof t)e.chatboxviews.each(function(e){e.is_chatroom&&e.model&&e.close()});else if("string"==typeof t){var n=e.chatboxviews.get(t);n&&n.close()}else k.map(t,function(t){var n=e.chatboxviews.get(t);n&&n.close()})},open:function(t,n){"string"==typeof n?n={nick:n}:"undefined"==typeof n&&(n={}),k.isUndefined(n.maximize)&&(n.maximize=!1);var i=e.chatboxviews.showChat.bind(e.chatboxviews);if(!n.nick&&e.muc_nickname_from_jid&&(n.nick=f.getNodeFromJid(e.bare_jid)),"undefined"==typeof t)throw new TypeError("rooms.open: You need to provide at least one JID");return"string"==typeof t?o(t,n,i):k.map(t,k.partial(o,k,n,i))},get:function(t,n,i){if("string"==typeof n?n={nick:n}:"undefined"==typeof n&&(n={}),"undefined"==typeof t){var s=[];return e.chatboxes.each(function(t){"chatroom"===t.get("type")&&s.push(e.wrappedChatBox(t))}),s}var a=k.partial(e.chatboxviews.getChatBox.bind(e.chatboxviews),k,i);return n.nick||(n.nick=f.getNodeFromJid(e.bare_jid)),"string"==typeof t?o(t,n,a):k.map(t,k.partial(o,k,n,a))}}})}})}),define("tpl!chatroom_bookmark_form",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chatroom-form-container">\n    <form class="pure-form converse-form chatroom-form">\n        <fieldset>\n            <legend>'+(null==(__t=heading)?"":__t)+"</legend>\n            <label>"+(null==(__t=label_name)?"":__t)+'</label>\n            <input type="text" name="name" required="required"/>\n            <label>'+(null==(__t=label_autojoin)?"":__t)+'</label>\n            <input type="checkbox" name="autojoin"/>\n            <label>'+(null==(__t=label_nick)?"":__t)+'</label>\n            <input type="text" name="nick" value="'+(null==(__t=default_nick)?"":__t)+'"/>\n        </fieldset>\n        <fieldset>\n            <input class="pure-button button-primary" type="submit" value="'+(null==(__t=label_submit)?"":__t)+'"/>\n            <input class="pure-button button-cancel" type="button" value="'+(null==(__t=label_cancel)?"":__t)+'"/>\n        </fieldset>\n    </form>\n</div>\n';return __p}}),define("tpl!bookmark",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<dd class="available-chatroom">\n    <a class="open-room" data-room-jid="'+(null==(__t=jid)?"":__t)+'" title="'+(null==(__t=open_title)?"":__t)+'" href="#">'+(null==(__t=name)?"":__t)+'</a>\n    <a class="remove-bookmark icon-close" data-room-jid="'+(null==(__t=jid)?"":__t)+'" data-bookmark-name="'+(null==(__t=name)?"":__t)+'"\n       title="'+(null==(__t=info_remove)?"":__t)+'" href="#">&nbsp;</a>\n    <a class="room-info icon-room-info" data-room-jid="'+(null==(__t=jid)?"":__t)+'"\n       title="'+(null==(__t=info_title)?"":__t)+'" href="#">&nbsp;</a>\n</dd>\n';return __p}}),define("tpl!bookmarks_list",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a href="#" class="bookmarks-toggle icon-'+(null==(__t=toggle_state)?"":__t)+'" title="'+(null==(__t=desc_bookmarks)?"":__t)+'">'+(null==(__t=label_bookmarks)?"":__t)+'</a>\n<dl class="bookmarks rooms-list"></dl>\n';return __p}}),function(e,t){define("converse-bookmarks",["jquery","underscore","moment_with_locales","strophe","utils","converse-core","converse-api","converse-muc","tpl!chatroom_bookmark_form","tpl!bookmark","tpl!bookmarks_list"],t)}(this,function(e,t,n,i,o,s,a,r,l,c,d){var u=o.__.bind(s),h=o.___,p=a.env.Strophe,_=a.env.$iq,m=a.env.b64_sha1;s.templates.chatroom_bookmark_form=l,s.templates.bookmark=c,s.templates.bookmarks_list=d,a.plugins.add("converse-bookmarks",{overrides:{clearSession:function(){this.__super__.clearSession.apply(this,arguments),t.isUndefined(this.bookmarks)||this.bookmarks.browserStorage._clear()},ChatRoomView:{events:{"click .toggle-bookmark":"toggleBookmark"},initialize:function(){this.__super__.initialize.apply(this,arguments),this.model.on("change:bookmarked",this.onBookmarked,this),this.setBookmarkState()},render:function(e){if(this.__super__.render.apply(this,arguments),s.allow_bookmarks){var n=t("Bookmark this room"),i='<a class="chatbox-btn toggle-bookmark icon-pushpin '+(this.model.get("bookmarked")?'button-on"':'"')+'title="'+n+'"></a>';this.$el.find(".chat-head-chatroom .icon-wrench").before(i)}return this},checkForReservedNick:function(){if(t.isUndefined(s.bookmarks)||!s.allow_bookmarks)return this.__super__.checkForReservedNick.apply(this,arguments);var e=s.bookmarks.findWhere({jid:this.model.get("jid")});!t.isUndefined(e)&&e.get("nick")?this.join(this.model.get("nick")):this.__super__.checkForReservedNick.apply(this,arguments)},onBookmarked:function(){this.model.get("bookmarked")?this.$(".icon-pushpin").addClass("button-on"):this.$(".icon-pushpin").removeClass("button-on")},setBookmarkState:function(){if(!t.isUndefined(s.bookmarks)){var e=s.bookmarks.where({jid:this.model.get("jid")});e.length?this.model.save("bookmarked",!0):this.model.save("bookmarked",!1)}},renderBookmarkForm:function(){var e=this.$(".chatroom-body");e.children().addClass("hidden"),e.append(s.templates.chatroom_bookmark_form({heading:u("Bookmark this room"),label_name:u("The name for this bookmark:"),label_autojoin:u("Would you like this room to be automatically joined upon startup?"),label_nick:u("What should your nickname for this room be?"),default_nick:this.model.get("nick"),label_submit:u("Save"),label_cancel:u("Cancel")})),this.$(".chatroom-form").submit(this.onBookmarkFormSubmitted.bind(this)),this.$(".chatroom-form .button-cancel").on("click",this.cancelConfiguration.bind(this))},onBookmarkFormSubmitted:function(t){t.preventDefault();var n=e(t.target),i=this;s.bookmarks.createBookmark({jid:this.model.get("jid"),autojoin:n.find('input[name="autojoin"]').prop("checked"),name:n.find("input[name=name]").val(),nick:n.find("input[name=nick]").val()}),this.$el.find("div.chatroom-form-container").hide(function(){e(this).remove(),i.$(".chatroom-body").children().removeClass("hidden")})},toggleBookmark:function(e){e&&(e.preventDefault(),e.stopPropagation());var n=s.bookmarks.where({jid:this.model.get("jid")});n.length?(t.each(n,function(e){e.destroy()}),this.$(".icon-pushpin").removeClass("button-on")):this.renderBookmarkForm()}}},initialize:function(){var n=this.converse;this.updateSettings({allow_bookmarks:!0}),n.Bookmark=Backbone.Model,n.BookmarksList=Backbone.Model.extend({defaults:{"toggle-state":n.OPENED}}),n.Bookmarks=Backbone.Collection.extend({model:n.Bookmark,initialize:function(){this.on("add",t.compose(this.markRoomAsBookmarked,this.openBookmarkedRoom)),this.on("remove",this.markRoomAsUnbookmarked,this),this.on("remove",this.sendBookmarkStanza,this);var e="converse.room-bookmarks"+n.bare_jid;this.cached_flag=m(e+"fetched"),this.browserStorage=new Backbone.BrowserStorage[n.storage](m(e))},openBookmarkedRoom:function(e){return e.get("autojoin")&&a.rooms.open(e.get("jid"),e.get("nick")),e},fetchBookmarks:function(){var n=new e.Deferred,i=n.promise();return window.sessionStorage.getItem(this.browserStorage.name)?this.fetch({success:t.bind(this.onCachedBookmarksFetched,this,n),error:t.bind(this.onCachedBookmarksFetched,this,n)}):window.sessionStorage.getItem(this.cached_flag)?n.resolve():this.fetchBookmarksFromServer(n),i},onCachedBookmarksFetched:function(e){return e.resolve()},createBookmark:function(e){n.bookmarks.create(e),n.bookmarks.sendBookmarkStanza()},sendBookmarkStanza:function(){var e=_({type:"set",from:n.connection.jid}).c("pubsub",{xmlns:p.NS.PUBSUB}).c("publish",{node:"storage:bookmarks"}).c("item",{id:"current"}).c("storage",{xmlns:"storage:bookmarks"});this.each(function(t){e=e.c("conference",{name:t.get("name"),autojoin:t.get("autojoin"),jid:t.get("jid")}).c("nick").t(t.get("nick")).up().up()}),e.up().up().up(),e.c("publish-options").c("x",{xmlns:p.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("http://jabber.org/protocol/pubsub#publish-options").up().up().c("field",{var:"pubsub#persist_items"}).c("value").t("true").up().up().c("field",{var:"pubsub#access_model"}).c("value").t("whitelist"),n.connection.sendIQ(e,null,this.onBookmarkError.bind(this))},onBookmarkError:function(e){n.log("Error while trying to add bookmark","error"),n.log(e),this.reset(),this.fetchBookmarksFromServer(null),window.alert(u("Sorry, something went wrong while trying to save your bookmark."))},fetchBookmarksFromServer:function(e){var i=_({from:n.connection.jid,type:"get"}).c("pubsub",{xmlns:p.NS.PUBSUB}).c("items",{node:"storage:bookmarks"});n.connection.sendIQ(i,t.bind(this.onBookmarksReceived,this,e),t.bind(this.onBookmarksReceivedError,this,e))},markRoomAsBookmarked:function(e){var i=n.chatboxes.get(e.get("jid"));t.isUndefined(i)||i.save("bookmarked",!0)},markRoomAsUnbookmarked:function(e){var i=n.chatboxes.get(e.get("jid"));t.isUndefined(i)||i.save("bookmarked",!1)},onBookmarksReceived:function(n,i){var o=e(i).find('items[node="storage:bookmarks"] item[id="current"] storage conference'),s=this;if(t.each(o,function(e){s.create({jid:e.getAttribute("jid"),name:e.getAttribute("name"),autojoin:"true"===e.getAttribute("autojoin"),nick:e.querySelector("nick").textContent})}),!t.isUndefined(n))return n.resolve()},onBookmarksReceivedError:function(e,i){if(window.sessionStorage.setItem(this.cached_flag,!0),n.log("Error while fetching bookmarks"),n.log(i),!t.isUndefined(e))return e.reject()}}),n.BookmarksView=Backbone.View.extend({tagName:"div",className:"bookmarks-list",events:{"click .remove-bookmark":"removeBookmark","click .bookmarks-toggle":"toggleBookmarksList"},initialize:function(){this.model.on("add",this.renderBookmarkListElement,this),this.model.on("remove",this.removeBookmarkListElement,this);var e="converse.room-bookmarks"+n.bare_jid+"-list-model";this.list_model=new n.BookmarksList,this.list_model.id=e,this.list_model.browserStorage=new Backbone.BrowserStorage[n.storage](m(e)),this.list_model.fetch(),this.render()},render:function(e){this.$el.html(n.templates.bookmarks_list({toggle_state:this.list_model.get("toggle-state"),desc_bookmarks:u("Click to toggle the bookmarks list"),label_bookmarks:u("Bookmarked Rooms")})).hide(),this.list_model.get("toggle-state")!==n.OPENED&&this.$(".bookmarks").hide(),this.model.each(this.renderBookmarkListElement,this);var i=n.chatboxviews.get("controlbox");return t.isUndefined(i)||this.$el.prependTo(i.$("#chatrooms")),this.$el},removeBookmark:function(i){i.preventDefault();var o=e(i.target).data("bookmarkName"),s=e(i.target).data("roomJid");confirm(u(h('Are you sure you want to remove the bookmark "%1$s"?'),o))&&t.each(n.bookmarks.where({jid:s}),function(e){e.destroy()})},renderBookmarkListElement:function(t){var i=e(n.templates.bookmark({name:t.get("name"),jid:t.get("jid"),open_title:u("Click to open this room"),info_title:u("Show more information on this room"),info_remove:u("Remove this bookmark")}));this.$(".bookmarks").append(i),this.$el.is(":visible")||this.$el.show()},removeBookmarkListElement:function(e){this.$('[data-room-jid="'+e.get("jid")+'"]:first').parent().remove(),0===this.model.length&&this.$el.hide()},toggleBookmarksList:function(t){t&&t.preventDefault&&t.preventDefault();var i=e(t.target);i.hasClass("icon-opened")?(this.$(".bookmarks").slideUp("fast"),this.list_model.save({"toggle-state":n.CLOSED}),i.removeClass("icon-opened").addClass("icon-closed")):(i.removeClass("icon-closed").addClass("icon-opened"),this.$(".bookmarks").slideDown("fast"),this.list_model.save({"toggle-state":n.OPENED}))}});var i=function(){n.allow_bookmarks&&(n.bookmarks=new n.Bookmarks,n.bookmarks.fetchBookmarks().always(function(){n.bookmarksview=new n.BookmarksView({model:n.bookmarks})}))};n.on("chatBoxesFetched",i);var o=function(){n.allow_bookmarks&&(t.isUndefined(n.bookmarksview)?i():n.bookmarksview.render())};n.on("reconnected",o)}})}),function(e,t){define("converse-mam",["converse-core","converse-api","converse-chatview","converse-muc","strophe.rsm"],t)}(this,function(e,t){"use strict";var n=t.env.jQuery,i=t.env.Strophe,o=t.env.$iq,s=t.env._,a=t.env.moment,r=["max","first","last","after","before","index","count"],l=["with","start","end"];i.addNamespace("MAM","urn:xmpp:mam:0"),i.addNamespace("RSM","http://jabber.org/protocol/rsm"),t.plugins.add("converse-mam",{overrides:{Features:{addClientFeatures:function(){return e.connection.disco.addFeature(i.NS.MAM),this.__super__.addClientFeatures.apply(this,arguments)}},ChatBox:{getMessageAttributes:function(e,t,o){var s=this.__super__.getMessageAttributes.apply(this,arguments);return s.archive_id=n(o).find('result[xmlns="'+i.NS.MAM+'"]').attr("id"),s}},ChatBoxView:{render:function(){var e=this.__super__.render.apply(this,arguments);return this.disable_mam||this.$content.on("scroll",s.debounce(this.onScroll.bind(this),100)),e},afterMessagesFetched:function(){return this.disable_mam||!e.features.findWhere({var:i.NS.MAM})?this.__super__.afterMessagesFetched.apply(this,arguments):(this.model.messages.length<e.archived_messages_page_size&&this.fetchArchivedMessages({before:"",with:this.model.get("jid"),max:e.archived_messages_page_size}),this.__super__.afterMessagesFetched.apply(this,arguments))},fetchArchivedMessages:function(t){return e.features.findWhere({var:i.NS.MAM})?void(this.disable_mam||(this.addSpinner(),e.queryForArchivedMessages(t,function(t){this.clearSpinner(),t.length&&s.map(t,e.chatboxes.onMessage.bind(e.chatboxes))}.bind(this),function(){this.clearSpinner(),e.log("Error or timeout while trying to fetch archived messages","error")}.bind(this)))):void e.log("Attempted to fetch archived messages but this user's server doesn't support XEP-0313")},onScroll:function(t){0===n(t.target).scrollTop()&&this.model.messages.length&&this.fetchArchivedMessages({before:this.model.messages.at(0).get("archive_id"),with:this.model.get("jid"),max:e.archived_messages_page_size})}},ChatRoomView:{render:function(){var e=this.__super__.render.apply(this,arguments);return this.disable_mam||this.$content.on("scroll",s.debounce(this.onScroll.bind(this),100)),e}}},initialize:function(){this.updateSettings({archived_messages_page_size:"20",message_archiving:"never",message_archiving_timeout:8e3}),e.queryForArchivedMessages=function(t,c,d){var u,h=[];"function"==typeof t&&(c=t,d=c);var p=e.connection.getUniqueId(),_={type:"set"};if("undefined"!=typeof t&&t.groupchat){if(!t.with)throw new Error('You need to specify a "with" value containing the chat room JID, when querying groupchat messages.');_.to=t.with}var m=o(_).c("query",{xmlns:i.NS.MAM,queryid:p});"undefined"!=typeof t&&(m.c("x",{xmlns:i.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(i.NS.MAM).up().up(),t.with&&!t.groupchat&&m.c("field",{var:"with"}).c("value").t(t.with).up().up(),s.each(["start","end"],function(e){if(t[e]){if(u=a(t[e]),!u.isValid())throw new TypeError("archive.query: invalid date provided for: "+e);m.c("field",{var:e}).c("value").t(u.format()).up().up()}}),m.up(),t instanceof i.RSM?m.cnode(t.toXML()):s.intersection(r,s.keys(t)).length&&m.cnode(new i.RSM(t).toXML())),"function"==typeof c&&e.connection.addHandler(function(e){var o,a=n(e),r=a.find('fin[xmlns="'+i.NS.MAM+'"]');return r.length&&r.attr("queryid")===p?(o=new i.RSM({xml:r.find("set")[0]}),s.extend(o,s.pick(t,["max"])),s.extend(o,s.pick(t,l)),c(h,o),!1):(p===a.find("result").attr("queryid")&&h.push(e),!0)},i.NS.MAM),e.connection.sendIQ(m,null,d,e.message_archiving_timeout)},s.extend(t,{archive:{query:e.queryForArchivedMessages.bind(e)}}),e.onMAMError=function(t){n(t).find("feature-not-implemented").length?e.log("Message Archive Management (XEP-0313) not supported by this browser"):(e.log("An error occured while trying to set archiving preferences."),e.log(t))},e.onMAMPreferences=function(t,a){var r,l=n(a).find('prefs[xmlns="'+i.NS.MAM+'"]'),c=l.attr("default");c!==e.message_archiving?(r=o({type:"set"}).c("prefs",{xmlns:i.NS.MAM,default:e.message_archiving}),l.children().each(function(e,t){r.cnode(t).up()}),e.connection.sendIQ(r,s.partial(function(t,n){t.save({preferences:{default:e.message_archiving}})},t),e.onMAMError)):t.save({preferences:{default:e.message_archiving}})};var c=function(t,n){var a=n.get("preferences")||{};n.get("var")===i.NS.MAM&&a.default!==e.message_archiving&&e.connection.sendIQ(o({type:"get"}).c("prefs",{xmlns:i.NS.MAM}),s.partial(e.onMAMPreferences,n),s.partial(e.onMAMError,n))};e.on("serviceDiscovered",c.bind(e.features))}})}),function(e,t){define("converse-vcard",["converse-core","converse-api","strophe.vcard"],t)}(this,function(e,t){"use strict";var n=t.env.Strophe,i=t.env.jQuery,o=t.env._,s=t.env.moment;t.plugins.add("converse-vcard",{overrides:{Features:{addClientFeatures:function(){this.__super__.addClientFeatures.apply(this,arguments),e.use_vcards&&e.connection.disco.addFeature(n.NS.VCARD)}},RosterContacts:{createRequestingContact:function(t){var i=n.getBareJidFromJid(t.getAttribute("from"));e.getVCard(i,o.partial(e.createRequestingContactFromVCard,t),function(n,i){e.log("Error while retrieving vcard for "+i),e.createRequestingContactFromVCard(t,n,i)})}}},initialize:function(){this.updateSettings({use_vcards:!0}),e.createRequestingContactFromVCard=function(t,o,a,r,l,c,d){var u=n.getBareJidFromJid(a),h=i(t).children('nick[xmlns="'+n.NS.NICK+'"]').text(),p={jid:u,subscription:"none",ask:null,requesting:!0,fullname:r||h||u,image:l,image_type:c,url:d,vcard_updated:s().format()};e.roster.create(p),e.emit("contactRequest",p)},e.onVCardError=function(t,n,i){var o=e.roster.get(t);o&&o.save({vcard_updated:s().format()}),i&&i(n,t)},e.onVCardData=function(t,n,a){var r=i(n).find("vCard"),l=r.find("FN").text(),c=r.find("BINVAL").text(),d=r.find("TYPE").text(),u=r.find("URL").text();if(t){var h=e.roster.get(t);h&&(l=o.isEmpty(l)?h.get("fullname")||t:l,h.save({fullname:l,image_type:d,image:c,url:u,vcard_updated:s().format()}))}a&&a(n,t,l,c,d,u)},e.getVCard=function(t,n,i){e.use_vcards?e.connection.vcard.get(o.partial(e.onVCardData,t,o,n),t,o.partial(e.onVCardError,t,o,i)):n&&n(null,t)};var t=function(t,n){if(e.use_vcards){var i=n.model.get("jid"),o=e.roster.get(i);o&&!o.get("vcard_updated")&&e.getVCard(i,function(e,t,i,o,s,a){n.model.save({fullname:i||t,url:a,image_type:s,image:o})},function(){e.log("updateVCardForChatBox: Error occured while fetching vcard")})}};e.on("chatBoxInitialized",t);var a=function(t){t.get("vcard_updated")||e.getVCard(t.get("jid"))};e.on("initialized",function(){e.roster.on("add",a)});var r=function(){void 0===e.xmppstatus.get("fullname")&&e.getVCard(null,function(t,n,i){e.xmppstatus.save({fullname:i})})};e.on("statusInitialized",r)}})}),define("tpl!toolbar_otr",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",allow_otr&&(__p+='\n    <li class="toggle-otr '+(null==(__t=otr_status_class)?"":__t)+'" title="'+(null==(__t=otr_tooltip)?"":__t)+'">\n        <span class="chat-toolbar-text">'+(null==(__t=otr_translated_status)?"":__t)+"</span>\n        ",otr_status==UNENCRYPTED&&(__p+='\n            <span class="icon-unlocked"></span>\n        '),__p+="\n        ",otr_status==UNVERIFIED&&(__p+='\n            <span class="icon-lock"></span>\n        '),__p+="\n        ",otr_status==VERIFIED&&(__p+='\n            <span class="icon-lock"></span>\n        '),__p+="\n        ",otr_status==FINISHED&&(__p+='\n            <span class="icon-unlocked"></span>\n        '),__p+="\n        <ul>\n            ",otr_status==UNENCRYPTED&&(__p+='\n               <li><a class="start-otr" href="#">'+(null==(__t=label_start_encrypted_conversation)?"":__t)+"</a></li>\n            "),__p+="\n            ",otr_status!=UNENCRYPTED&&(__p+='\n               <li><a class="start-otr" href="#">'+(null==(__t=label_refresh_encrypted_conversation)?"":__t)+'</a></li>\n               <li><a class="end-otr" href="#">'+(null==(__t=label_end_encrypted_conversation)?"":__t)+'</a></li>\n               <li><a class="auth-otr" data-scheme="smp" href="#">'+(null==(__t=label_verify_with_smp)?"":__t)+"</a></li>\n            "),__p+="\n            ",otr_status==UNVERIFIED&&(__p+='\n               <li><a class="auth-otr" data-scheme="fingerprint" href="#">'+(null==(__t=label_verify_with_fingerprints)?"":__t)+"</a></li>\n            "),__p+='\n            <li><a href="http://www.cypherpunks.ca/otr/help/3.2.0/levels.php" target="_blank" rel="noopener">'+(null==(__t=label_whats_this)?"":__t)+"</a></li>\n        </ul>\n    </li>\n"),__p+="\n";return __p}}),function(e,t){define("converse-otr",["otr","converse-core","converse-api","tpl!toolbar_otr"],t)}(this,function(e,t,n,i){"use strict";t.templates.toolbar_otr=i;var o=n.env.Strophe,s=n.env.utils,a=n.env.b64_sha1,r=n.env.jQuery,l=n.env._,c=s.__.bind(t),d="undefined"!=typeof crypto&&("function"==typeof crypto.randomBytes||"function"==typeof crypto.getRandomValues),u=d&&"undefined"!=typeof CryptoJS&&"undefined"!=typeof e.OTR&&"undefined"!=typeof e.DSA,h=0,p=1,_=2,m=3,f={},g={};g[h]="unencrypted",g[p]="unverified",g[_]="verified",g[m]="finished",n.plugins.add("converse-otr",{overrides:{_initialize:function(){this.__super__._initialize.apply(this,arguments),this.otr=new this.OTR},registerGlobalEventHandlers:function(){this.__super__.registerGlobalEventHandlers(),r(document).click(function(){r(".toggle-otr ul").is(":visible")&&r(".toggle-otr ul",this).slideUp(),r(".toggle-smiley ul").is(":visible")&&r(".toggle-smiley ul",this).slideUp()})},wrappedChatBox:function(e){var t=this.__super__.wrappedChatBox.apply(this,arguments);if(e)return l.extend(t,{endOTR:e.endOTR.bind(e),initiateOTR:e.initiateOTR.bind(e)})},ChatBox:{initialize:function(){this.__super__.initialize.apply(this,arguments),"controlbox"!==this.get("box_id")&&this.save({otr_status:this.get("otr_status")||h})},shouldPlayNotification:function(e){return this.__super__.shouldPlayNotification.apply(this,arguments)&&!(s.isOTRMessage(e[0])&&!l.contains([p,_],this.get("otr_status")))},createMessage:function(e,t,n){var i=this.__super__.converse,o=e.children("body"),s=o.length>0?o.text():void 0;if(!s||!i.allow_otr)return this.__super__.createMessage.apply(this,arguments);
if(s.match(/^\?OTRv23?/))this.initiateOTR(s);else if(l.contains([p,_],this.get("otr_status")))this.otr.receiveMsg(s);else{if(!s.match(/^\?OTR/))return this.__super__.createMessage.apply(this,arguments);this.otr?this.otr.receiveMsg(s):this.initiateOTR(s)}},getSession:function(t){var n,i,o,s,r=this.__super__.converse,l=CryptoJS.lib.PasswordBasedCipher;if(r.cache_otr_key&&(n=r.otr.getSessionPassphrase(),"undefined"!=typeof n&&(i=window.sessionStorage[a(this.id+"instance_tag")],o=window.sessionStorage[a(this.id+"priv_key")],s=window.sessionStorage[a(this.connection.jid+"pass_check")],o&&i&&"undefined"!=typeof s))){var d=l.decrypt(CryptoJS.algo.AES,o,n),u=e.DSA.parsePrivate(d.toString(CryptoJS.enc.Latin1));if("match"===l.decrypt(CryptoJS.algo.AES,s,n).toString(CryptoJS.enc.Latin1))return this.trigger("showHelpMessages",[c("Re-establishing encrypted session")]),void t({key:u,instance_tag:i})}this.trigger("showHelpMessages",[c("Generating private key."),c("Your browser might become unresponsive.")],null,!0),window.setTimeout(function(){var n=e.OTR.makeInstanceTag();t({key:r.otr.generatePrivateKey.call(this,n),instance_tag:n})},500)},updateOTRStatus:function(t){switch(t){case e.OTR.CONST.STATUS_AKE_SUCCESS:this.otr.msgstate===e.OTR.CONST.MSGSTATE_ENCRYPTED&&this.save({otr_status:p});break;case e.OTR.CONST.STATUS_END_OTR:this.otr.msgstate===e.OTR.CONST.MSGSTATE_FINISHED?this.save({otr_status:m}):this.otr.msgstate===e.OTR.CONST.MSGSTATE_PLAINTEXT&&this.save({otr_status:h})}},onSMP:function(e,t){switch(e){case"question":this.otr.smpSecret(prompt(c("Authentication request from %1$s\n\nYour chat contact is attempting to verify your identity, by asking you the question below.\n\n%2$s",[this.get("fullname"),t])));break;case"trust":t===!0?this.save({otr_status:_}):(this.trigger("showHelpMessages",[c("Could not verify this user's identify.")],"error"),this.save({otr_status:p}));break;default:throw new TypeError("ChatBox.onSMP: Unknown type for SMP")}},initiateOTR:function(t){this.save({otr_status:h}),this.getSession(function(n){var i=this.__super__.converse;this.otr=new e.OTR({fragment_size:140,send_interval:200,priv:n.key,instance_tag:n.instance_tag,debug:this.debug}),this.otr.on("status",this.updateOTRStatus.bind(this)),this.otr.on("smp",this.onSMP.bind(this)),this.otr.on("ui",function(e){this.trigger("showReceivedOTRMessage",e)}.bind(this)),this.otr.on("io",function(e){this.trigger("sendMessage",new i.Message({message:e}))}.bind(this)),this.otr.on("error",function(e){this.trigger("showOTRError",e)}.bind(this)),this.trigger("showHelpMessages",[c("Exchanging private key with contact.")]),t?this.otr.receiveMsg(t):this.otr.sendQueryMsg()}.bind(this))},endOTR:function(){this.otr&&this.otr.endOtr(),this.save({otr_status:h})}},ChatBoxView:{events:{"click .toggle-otr":"toggleOTRMenu","click .start-otr":"startOTRFromToolbar","click .end-otr":"endOTR","click .auth-otr":"authOTR"},initialize:function(){var e=this.__super__.converse;this.__super__.initialize.apply(this,arguments),this.model.on("change:otr_status",this.onOTRStatusChanged,this),this.model.on("showOTRError",this.showOTRError,this),this.model.on("showSentOTRMessage",function(e){this.showMessage({message:e,sender:"me"})},this),this.model.on("showReceivedOTRMessage",function(e){this.showMessage({message:e,sender:"them"})},this),(l.contains([p,_],this.model.get("otr_status"))||e.use_otr_by_default)&&this.model.initiateOTR()},createMessageStanza:function(){var e=this.__super__.createMessageStanza.apply(this,arguments);return(this.model.get("otr_status")!==h||s.isOTRMessage(e.nodeTree))&&e.c("private",{xmlns:o.NS.CARBONS}).up().c("no-store",{xmlns:o.NS.HINTS}).up().c("no-permanent-store",{xmlns:o.NS.HINTS}).up().c("no-copy",{xmlns:o.NS.HINTS}),e},onMessageSubmitted:function(e){var t=this.__super__.converse;if(!t.connection.authenticated)return this.showHelpMessages(["Sorry, the connection has been lost, and your message could not be sent"],"error");var n=e.replace(/^\s*/,"").match(/^\/(.*)\s*$/);if(n){if(t.allow_otr&&"endotr"===n[1])return this.endOTR();if(t.allow_otr&&"otr"===n[1])return this.model.initiateOTR()}l.contains([p,_],this.model.get("otr_status"))?(this.model.otr.sendMsg(e),this.model.trigger("showSentOTRMessage",e)):this.__super__.onMessageSubmitted.apply(this,arguments)},onOTRStatusChanged:function(){this.renderToolbar().informOTRChange()},informOTRChange:function(){var e=this.model.toJSON(),t=[];return e.otr_status===h?t.push(c("Your messages are not encrypted anymore")):e.otr_status===p?t.push(c("Your messages are now encrypted but your contact's identity has not been verified.")):e.otr_status===_?t.push(c("Your contact's identify has been verified.")):e.otr_status===m&&t.push(c("Your contact has ended encryption on their end, you should do the same.")),this.showHelpMessages(t,"info",!1)},showOTRError:function(e){var t=this.__super__.converse;"Message cannot be sent at this time."===e?this.showHelpMessages([c("Your message could not be sent")],"error"):"Received an unencrypted message."===e?this.showHelpMessages([c("We received an unencrypted message")],"error"):"Received an unreadable encrypted message."===e?this.showHelpMessages([c("We received an unreadable encrypted message")],"error"):this.showHelpMessages(["Encryption error occured: "+e],"error"),t.log("OTR ERROR:"+e)},startOTRFromToolbar:function(e){r(e.target).parent().parent().slideUp(),e.stopPropagation(),this.model.initiateOTR()},endOTR:function(e){"undefined"!=typeof e&&(e.preventDefault(),e.stopPropagation()),this.model.endOTR()},authOTR:function(e){var t,n,i,o=this.__super__.converse,s=r(e.target).data().scheme;"fingerprint"===s?(t=confirm(c("Here are the fingerprints, please confirm them with %1$s, outside of this chat.\n\nFingerprint for you, %2$s: %3$s\n\nFingerprint for %1$s: %4$s\n\nIf you have confirmed that the fingerprints match, click OK, otherwise click Cancel.",[this.model.get("fullname"),o.xmppstatus.get("fullname")||o.bare_jid,this.model.otr.priv.fingerprint(),this.model.otr.their_priv_pk.fingerprint()])),t===!0?this.model.save({otr_status:_}):this.model.save({otr_status:p})):"smp"===s?(alert(c("You will be prompted to provide a security question and then an answer to that question.\n\nYour contact will then be prompted the same question and if they type the exact same answer (case sensitive), their identity will be verified.")),n=prompt(c("What is your security question?")),n&&(i=prompt(c("What is the answer to the security question?")),this.model.otr.smpSecret(i,n))):this.showHelpMessages([c("Invalid authentication scheme provided")],"error")},toggleOTRMenu:function(e){e.stopPropagation(),this.$el.find(".toggle-otr ul").slideToggle(200)},getOTRTooltip:function(){var e=this.model.toJSON();return e.otr_status===h?c("Your messages are not encrypted. Click here to enable OTR encryption."):e.otr_status===p?c("Your messages are encrypted, but your contact has not been verified."):e.otr_status===_?c("Your messages are encrypted and your contact verified."):e.otr_status===m?c("Your contact has closed their end of the private session, you should do the same"):void 0},renderToolbar:function(e,t){var n=this.__super__.converse;if(n.show_toolbar){var i=this.model.toJSON();return t=l.extend(t||{},{FINISHED:m,UNENCRYPTED:h,UNVERIFIED:p,VERIFIED:_,allow_otr:n.allow_otr&&!this.is_chatroom,label_end_encrypted_conversation:c("End encrypted conversation"),label_refresh_encrypted_conversation:c("Refresh encrypted conversation"),label_start_encrypted_conversation:c("Start encrypted conversation"),label_verify_with_fingerprints:c("Verify with fingerprints"),label_verify_with_smp:c("Verify with SMP"),label_whats_this:c("What's this?"),otr_status_class:g[i.otr_status],otr_tooltip:this.getOTRTooltip(),otr_translated_status:f[i.otr_status]}),this.__super__.renderToolbar.apply(this,arguments),this.$el.find(".chat-toolbar").append(n.templates.toolbar_otr(l.extend(this.model.toJSON(),t||{}))),this}}}},initialize:function(){var t=this.converse;f[h]=c("unencrypted"),f[p]=c("unverified"),f[_]=c("verified"),f[m]=c("finished"),c=s.__.bind(t);var n={allow_otr:!0,cache_otr_key:!1,use_otr_by_default:!1};l.extend(t.default_settings,n),l.extend(t,n),l.extend(t,l.pick(t.user_settings,Object.keys(n))),t.allow_otr=t.allow_otr&&u,t.use_otr_by_default=t.use_otr_by_default&&t.allow_otr,t.OTR=Backbone.Model.extend({getSessionPassphrase:function(){if("prebind"===t.authentication){var e=a(t.connection.jid),n=window.sessionStorage[e];return"undefined"==typeof n&&(n=Math.floor(4294967295*Math.random()).toString(),window.sessionStorage[e]=n),n}return t.connection.pass},generatePrivateKey:function(n){var i=new e.DSA,o=t.connection.jid;if(t.cache_otr_key){var s=CryptoJS.lib.PasswordBasedCipher,r=this.getSessionPassphrase();"undefined"!=typeof r&&(window.sessionStorage[a(o+"priv_key")]=s.encrypt(CryptoJS.algo.AES,i.packPrivate(),r).toString(),window.sessionStorage[a(o+"instance_tag")]=n,window.sessionStorage[a(o+"pass_check")]=s.encrypt(CryptoJS.algo.AES,"match",r).toString())}return i}})}})}),define("tpl!register_panel",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form id="converse-register" class="pure-form converse-form">\n    <span class="reg-feedback"></span>\n    <label>'+(null==(__t=label_domain)?"":__t)+'</label>\n    <input type="text" name="domain" placeholder="'+(null==(__t=domain_placeholder)?"":__t)+'">\n    <p class="form-help">'+(null==(__t=help_providers)?"":__t)+' <a href="'+(null==(__t=href_providers)?"":__t)+'" class="url" target="_blank" rel="noopener">'+(null==(__t=help_providers_link)?"":__t)+'</a>.</p>\n    <input class="pure-button button-primary" type="submit" value="'+(null==(__t=label_register)?"":__t)+'">\n</form>\n';return __p}}),define("tpl!register_tab",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li><a class="s" href="#register">'+(null==(__t=label_register)?"":__t)+"</a></li>\n";return __p}}),define("tpl!registration_form",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="provider-title">'+(null==(__t=domain)?"":__t)+"</p>\n<a href='https://xmpp.net/result.php?domain="+(null==(__t=domain)?"":__t)+"&amp;type=client'>\n    <img class=\"provider-score\" src='https://xmpp.net/badge.php?domain="+(null==(__t=domain)?"":__t)+"' alt='xmpp.net score' />\n</a>\n<p class=\"title\">"+(null==(__t=title)?"":__t)+'</p>\n<p class="instructions">'+(null==(__t=instructions)?"":__t)+"</p>\n";return __p}}),define("tpl!registration_request",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="spinner login-submit"/>\n<p class="info">'+(null==(__t=info_message)?"":__t)+'</p>\n<button class="pure-button button-cancel hor_centered">'+(null==(__t=cancel)?"":__t)+"</button>\n";return __p}}),function(e,t){define("converse-register",["converse-core","converse-api","tpl!form_username","tpl!register_panel","tpl!register_tab","tpl!registration_form","tpl!registration_request","converse-controlbox"],t)}(this,function(e,t,n,i,o,s,a){"use strict";e.templates.form_username=n,e.templates.register_panel=i,e.templates.register_tab=o,e.templates.registration_form=s,e.templates.registration_request=a;var r=t.env.Strophe,l=t.env.utils,c=t.env.$iq,d=t.env.jQuery,u=t.env._,h=l.__.bind(e);r.addNamespace("REGISTER","jabber:iq:register");var p=0;Object.keys(r.Status).forEach(function(e){p=Math.max(p,r.Status[e])}),r.Status.REGIFAIL=p+1,r.Status.REGISTERED=p+2,r.Status.CONFLICT=p+3,r.Status.NOTACCEPTABLE=p+5,t.plugins.add("converse-register",{overrides:{ControlBoxView:{renderLoginPanel:function(){this.__super__.renderLoginPanel.apply(this,arguments);var e=this.__super__.converse;return e.allow_registration&&(this.registerpanel=new e.RegisterPanel({$parent:this.$el.find(".controlbox-panes"),model:this}),this.registerpanel.render().$el.addClass("hidden")),this}}},initialize:function(){var e=this.converse;this.updateSettings({allow_registration:!0,domain_placeholder:h(" e.g. conversejs.org"),providers_link:"https://xmpp.net/directory.php"}),e.RegisterPanel=Backbone.View.extend({tagName:"div",id:"register",className:"controlbox-pane",events:{"submit form#converse-register":"onProviderChosen"},initialize:function(e){this.reset(),this.$parent=e.$parent,this.$tabs=e.$parent.parent().find("#controlbox-tabs"),this.registerHooks()},render:function(){return this.$parent.append(this.$el.html(e.templates.register_panel({label_domain:h("Your XMPP provider's domain name:"),label_register:h("Fetch registration form"),help_providers:h("Tip: A list of public XMPP providers is available"),help_providers_link:h("here"),href_providers:e.providers_link,domain_placeholder:e.domain_placeholder}))),this.$tabs.append(e.templates.register_tab({label_register:h("Register")})),this},registerHooks:function(){var t=e.connection,n=t._connect_cb.bind(t);t._connect_cb=function(e,t,i){this._registering?this.getRegistrationFields(e,t,i)&&(this._registering=!1):n(e,t,i)}.bind(this)},getRegistrationFields:function(t,n,i){e.log("sendQueryStanza was called");var o=e.connection;o.connected=!0;var s=o._proto._reqToData(t);if(s){if(o._proto._connect_cb(s)===r.Status.CONNFAIL)return!1;var a=s.getElementsByTagName("register"),l=s.getElementsByTagName("mechanism");return 0===a.length&&0===l.length?(o._proto._no_auth_received(n),!1):0===a.length?(o._changeConnectStatus(r.Status.REGIFAIL,h("Sorry, the given provider does not support in band account registration. Please try with a different provider.")),!0):(o._addSysHandler(this.onRegistrationFields.bind(this),null,"iq",null,null),o.send(c({type:"get"}).c("query",{xmlns:r.NS.REGISTER}).tree()),!0)}},onRegistrationFields:function(t){return 1!==t.getElementsByTagName("query").length?(e.connection._changeConnectStatus(r.Status.REGIFAIL,"unknown"),!1):(this.setFields(t),this.renderRegistrationForm(t),!1)},reset:function(e){var t={fields:{},urls:[],title:"",instructions:"",registered:!1,_registering:!1,domain:null,form_type:null};u.extend(this,t),e&&u.extend(this,u.pick(e,Object.keys(t)))},onProviderChosen:function(t){t&&t.preventDefault&&t.preventDefault();var n=d(t.target),i=n.find("input[name=domain]"),o=i.val();return o?(n.find("input[type=submit]").hide().after(e.templates.registration_request({cancel:h("Cancel"),info_message:h("Requesting a registration form from the XMPP server")})),n.find("button.cancel").on("click",this.cancelRegistration.bind(this)),this.reset({domain:r.getDomainFromJid(o),_registering:!0}),e.connection.connect(this.domain,"",this.onRegistering.bind(this)),!1):void i.addClass("error")},giveFeedback:function(e,t){this.$(".reg-feedback").attr("class","reg-feedback").text(e),t&&d(".reg-feedback").addClass(t)},onRegistering:function(t,n){var i;e.log("onRegistering"),u.contains([r.Status.DISCONNECTED,r.Status.CONNFAIL,r.Status.REGIFAIL,r.Status.NOTACCEPTABLE,r.Status.CONFLICT],t)?(e.log("Problem during registration: Strophe.Status is: "+t),this.cancelRegistration(),n?this.giveFeedback(n,"error"):this.giveFeedback(h('Something went wrong while establishing a connection with "%1$s". Are you sure it exists?',this.domain),"error")):t===r.Status.REGISTERED&&(e.log("Registered successfully."),e.connection.reset(),i=this,this.$("form").hide(function(){d(this).replaceWith('<span class="spinner centered"/>'),i.fields.password&&i.fields.username?(e.connection.connect(i.fields.username.toLowerCase()+"@"+i.domain.toLowerCase(),i.fields.password,e.onConnectStatusChanged),e.chatboxviews.get("controlbox").switchTab({target:i.$tabs.find(".current")}).giveFeedback(h("Now logging you in"))):e.chatboxviews.get("controlbox").renderLoginPanel().giveFeedback(h("Registered successfully")),i.reset()}))},renderRegistrationForm:function(t){var n,i,o=this.$("form"),s=d(t);o.empty().append(e.templates.registration_form({domain:this.domain,title:this.title,instructions:this.instructions})),"xform"===this.form_type?(n=s.find("field"),u.each(n,function(e){o.append(l.xForm2webForm.bind(this,d(e),s))}.bind(this))):(u.each(Object.keys(this.fields),function(t){"username"===t?i=e.templates.form_username({domain:" @"+this.domain,name:t,type:"text",label:t,value:"",required:1}):(o.append("<label>"+t+"</label>"),i=d('<input placeholder="'+t+'" name="'+t+'"></input>'),"password"!==t&&"email"!==t||i.attr("type",t)),o.append(i)}.bind(this)),u.each(this.urls,function(e){o.append(d('<a target="blank"></a>').attr("href",e).text(e))}.bind(this))),this.fields?(o.append('<input type="submit" class="pure-button button-primary" value="'+h("Register")+'"/>'),o.on("submit",this.submitRegistrationForm.bind(this)),o.append('<input type="button" class="pure-button button-cancel" value="'+h("Cancel")+'"/>'),o.find("input[type=button]").on("click",this.cancelRegistration.bind(this))):(o.append('<input type="button" class="submit" value="'+h("Return")+'"/>'),o.find("input[type=button]").on("click",this.cancelRegistration.bind(this)))},reportErrors:function(e){var t,n=this.$("form"),i=d(e).find("error text"),o=n.find(".form-errors");o.length?o.empty():(t='<legend class="form-errors"></legend>',n.find("p.instructions").length?n.find("p.instructions").append(t):n.prepend(t),o=n.find(".form-errors")),i.each(function(e,t){o.append(d("<p>").text(d(t).text()))}),i.length||o.append(d("<p>").text(h("The provider rejected your registration attempt. Please check the values you entered for correctness."))),o.show()},cancelRegistration:function(t){t&&t.preventDefault&&t.preventDefault(),e.connection.reset(),this.render()},submitRegistrationForm:function(t){t&&t.preventDefault&&t.preventDefault();var n=this.$("input.required:emptyVal");if(n.length)return void n.addClass("error");var i=d(t.target).find(":input:not([type=button]):not([type=submit])"),o=c({type:"set"}).c("query",{xmlns:r.NS.REGISTER});"xform"===this.form_type?(o.c("x",{xmlns:r.NS.XFORM,type:"submit"}),i.each(function(){o.cnode(l.webForm2xForm(this)).up()})):i.each(function(){var e=d(this);o.c(e.attr("name"),{},e.val())}),e.connection._addSysHandler(this._onRegisterIQ.bind(this),null,"iq",null,null),e.connection.send(o),this.setFields(o.tree())},setFields:function(e){var t,n=d(e).find("query");n.length>0&&(t=n.find('x[xmlns="'+r.NS.XFORM+'"]'),t.length>0?this._setFieldsFromXForm(t):this._setFieldsFromLegacy(n))},_setFieldsFromLegacy:function(e){e.children().each(function(e,t){var n=d(t);return"instructions"===t.tagName.toLowerCase()?void(this.instructions=r.getText(t)):"x"===t.tagName.toLowerCase()?void("jabber:x:oob"===n.attr("xmlns")&&n.find("url").each(function(e,t){this.urls.push(d(t).text())}.bind(this))):void(this.fields[t.tagName.toLowerCase()]=r.getText(t))}.bind(this)),this.form_type="legacy"},_setFieldsFromXForm:function(t){this.title=t.find("title").text(),this.instructions=t.find("instructions").text(),t.find("field").each(function(t,n){var i=n.getAttribute("var");i?this.fields[i.toLowerCase()]=d(n).children("value").text():e.log("WARNING: Found field we couldn't parse")}.bind(this)),this.form_type="xform"},_onRegisterIQ:function(t){var n=null,i=t.getElementsByTagName("query");if(i.length>0&&(i=i[0]),"error"===t.getAttribute("type")){if(e.log("Registration failed."),n=t.getElementsByTagName("error"),1!==n.length)return e.connection._changeConnectStatus(r.Status.REGIFAIL,"unknown"),!1;n=n[0].firstChild.tagName.toLowerCase(),"conflict"===n?e.connection._changeConnectStatus(r.Status.CONFLICT,n):"not-acceptable"===n?e.connection._changeConnectStatus(r.Status.NOTACCEPTABLE,n):e.connection._changeConnectStatus(r.Status.REGIFAIL,n),this.reportErrors(t)}else e.connection._changeConnectStatus(r.Status.REGISTERED,null);return!1},remove:function(){this.$tabs.empty(),this.$el.parent().empty()}})}})}),function(e,t){define("converse-ping",["converse-core","converse-api","strophe.ping"],t)}(this,function(e,t){"use strict";var n=t.env.Strophe,i=t.env._;t.plugins.add("converse-ping",{initialize:function(){var e=this.converse;this.updateSettings({ping_interval:180}),e.ping=function(t,i,o,s){return e.lastStanzaDate=new Date,"undefined"!=typeof t&&null!==t||(t=n.getDomainFromJid(e.bare_jid)),"undefined"==typeof s&&(s=null),"undefined"==typeof i&&(i=null),"undefined"==typeof o&&(o=null),!!e.connection&&(e.connection.ping.ping(t,i,o,s),!0)},e.pong=function(t){return e.lastStanzaDate=new Date,e.connection.ping.pong(t),!0},e.registerPongHandler=function(){e.connection.disco.addFeature(n.NS.PING),e.connection.ping.addPingHandler(e.pong)},e.registerPingHandler=function(){e.registerPongHandler(),e.ping_interval>0&&(e.connection.addHandler(function(){return e.lastStanzaDate=new Date,!0}),e.connection.addTimedHandler(1e3,function(){var t=new Date;return e.lastStanzaDate||(e.lastStanzaDate=t),!((t-e.lastStanzaDate)/1e3>e.ping_interval)||e.ping()}))},i.extend(t,{ping:function(t){e.ping(t)}});var o=function(){e.registerPingHandler()};e.on("connected",o),e.on("reconnected",o)}})}),function(e,t){define("converse-notification",["converse-core","converse-api"],t)}(this,function(e,t){"use strict";var n=t.env.jQuery,i=t.env.utils,o=t.env.Strophe,s=t.env._,a=i.__.bind(e),r=i.___;t.plugins.add("converse-notification",{initialize:function(){var e=this.converse;e.supports_html5_notification="Notification"in window,this.updateSettings({notify_all_room_messages:!1,show_desktop_notifications:!0,chatstate_notification_blacklist:[],play_sounds:!1,sounds_path:"/sounds/",notification_icon:"/logo/conversejs128.png"}),e.isOnlyChatStateNotification=function(t){return 0===t.find("body").length&&(0!==t.find(e.ACTIVE).length||0!==t.find(e.COMPOSING).length||0!==t.find(e.INACTIVE).length||0!==t.find(e.PAUSED).length||0!==t.find(e.GONE).length)},e.shouldNotifyOfGroupMessage=function(t){var n=e.notify_all_room_messages,i=t.attr("from"),a=o.getResourceFromJid(i),r=o.getBareJidFromJid(i),l=a&&o.unescapeNode(a)||"";if(""===l||t.find("delay").length>0)return!1;var c=e.chatboxes.get(r),d=t.children("body");if(!d.length)return!1;var u=new RegExp("\\b"+c.get("nick")+"\\b").test(d.text());return n=n===!0||s.isArray(n)&&s.contains(n,r),!(l===c.get("nick")||!n&&!u)},e.shouldNotifyOfMessage=function(t){if(i.isOTRMessage(t))return!1;var s=n(t),a=s.find("forwarded");if(a.length)return!1;if("groupchat"===s.attr("type"))return e.shouldNotifyOfGroupMessage(s);if(i.isHeadlineMessage(t))return!0;var r=o.getBareJidFromJid(s.attr("from"))===e.bare_jid;return!e.isOnlyChatStateNotification(s)&&!r},e.playSoundNotification=function(t){var n;e.play_sounds&&"undefined"!=typeof Audio&&(n=new Audio(e.sounds_path+"msg_received.ogg"),n.canPlayType("/audio/ogg")?n.play():(n=new Audio(e.sounds_path+"msg_received.mp3"),n.play()))},e.areDesktopNotificationsEnabled=function(t){var n=e.supports_html5_notification&&e.show_desktop_notifications&&"granted"===Notification.permission;return t?n:n&&"hidden"===e.windowState},e.showMessageNotification=function(t){var n,i,s,l,c=t.attr("from");if("headline"===t.attr("type")||c.indexOf("@")===-1)i=a(r("Notification from %1$s"),c);else if("groupchat"===t.attr("type"))i=a(r("%1$s says"),o.getResourceFromJid(c));else{if("undefined"==typeof e.roster)return void e.log("Could not send notification, because roster is undefined","error");s=o.getBareJidFromJid(t.attr("from")),l=e.roster.get(s),i=a(r("%1$s says"),l.get("fullname"))}n=new Notification(i,{body:t.children("body").text(),lang:e.i18n.locale_data.converse[""].lang,icon:e.notification_icon}),setTimeout(n.close.bind(n),5e3)},e.showChatStateNotification=function(t){if(!s.contains(e.chatstate_notification_blacklist,t.jid)){var n=t.chat_status,i=null;if("offline"===n?i=a("has gone offline"):"away"===n?i=a("has gone away"):"dnd"===n?i=a("is busy"):"online"===n&&(i=a("has come online")),null!==i){var o=new Notification(t.fullname,{body:i,lang:e.i18n.locale_data.converse[""].lang,icon:"logo/conversejs.png"});setTimeout(o.close.bind(o),5e3)}}},e.showContactRequestNotification=function(t){var n=new Notification(t.fullname,{body:a("wants to be your contact"),lang:e.i18n.locale_data.converse[""].lang,icon:"logo/conversejs.png"});setTimeout(n.close.bind(n),5e3)},e.showFeedbackNotification=function(t){if("error"===t.klass||"warn"===t.klass){var n=new Notification(t.subject,{body:t.message,lang:e.i18n.locale_data.converse[""].lang,icon:"logo/conversejs.png"});setTimeout(n.close.bind(n),5e3)}},e.handleChatStateNotification=function(t,n){e.areDesktopNotificationsEnabled()&&e.showChatStateNotification(n)},e.handleMessageNotification=function(t,i){var o=n(i);return!!e.shouldNotifyOfMessage(i)&&(e.playSoundNotification(o),void(e.areDesktopNotificationsEnabled()&&e.showMessageNotification(o)))},e.handleContactRequestNotification=function(t,n){e.areDesktopNotificationsEnabled(!0)&&e.showContactRequestNotification(n)},e.handleFeedback=function(t,n){e.areDesktopNotificationsEnabled(!0)&&e.showFeedbackNotification(n)},e.requestPermission=function(t){e.supports_html5_notification&&!s.contains(["denied","granted"],Notification.permission)&&Notification.requestPermission()},e.on("pluginsInitialized",function(){e.on("contactRequest",e.handleContactRequestNotification),e.on("contactStatusChanged",e.handleChatStateNotification),e.on("message",e.handleMessageNotification),e.on("feedback",e.handleFeedback),e.on("connected",e.requestPermission)})}})}),define("tpl!chatbox_minimize",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a class="chatbox-btn toggle-chatbox-button icon-minus" title="'+(null==(__t=info_minimize)?"":__t)+'"></a>\n';return __p}}),define("tpl!toggle_chats",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+(null==(__t=Minimized)?"":__t)+' <span id="minimized-count">('+(null==(__t=num_minimized)?"":__t)+')</span>\n<span class="unread-message-count"\n    ',num_unread||(__p+=' style="display: none" '),__p+='\n    href="#">'+(null==(__t=num_unread)?"":__t)+"</span>\n";return __p}}),define("tpl!trimmed_chat",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a class="chatbox-btn close-chatbox-button icon-close"></a>\n<a class="chat-head-message-count" \n    ',num_unread||(__p+=' style="display: none" '),__p+='\n    href="#">'+(null==(__t=num_unread)?"":__t)+'</a>\n<a href="#" class="restore-chat" title="'+(null==(__t=tooltip)?"":__t)+'">\n    '+(null==(__t=title)?"":__t)+"\n</a>\n";return __p}}),define("tpl!chats_panel",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a id="toggle-minimized-chats" href="#"></a>\n<div class="flyout minimized-chats-flyout"></div>\n';return __p}}),function(e,t){define("converse-minimize",["converse-core","converse-api","tpl!chatbox_minimize","tpl!toggle_chats","tpl!trimmed_chat","tpl!chats_panel","converse-controlbox","converse-chatview","converse-muc"],t)}(this,function(e,t,n,i,o,s){"use strict";e.templates.chatbox_minimize=n,e.templates.toggle_chats=i,e.templates.trimmed_chat=o,e.templates.chats_panel=s;var a=t.env.jQuery,r=t.env._,l=t.env.b64_sha1,c=t.env.moment,d=t.env.utils,u=d.__.bind(e);t.plugins.add("converse-minimize",{overrides:{initChatBoxes:function(){var t=this.__super__.initChatBoxes.apply(this,arguments);return e.minimized_chats=new e.MinimizedChats({model:e.chatboxes}),t},registerGlobalEventHandlers:function(){return a(window).on("resize",r.debounce(function(t){e.connection.connected&&e.chatboxviews.trimChats()},200)),this.__super__.registerGlobalEventHandlers.apply(this,arguments)},wrappedChatBox:function(e){if(e){var t=this.__super__.wrappedChatBox.apply(this,arguments);return t.maximize=e.maximize.bind(e),t.minimize=e.minimize.bind(e),t}},ChatBox:{initialize:function(){this.__super__.initialize.apply(this,arguments),"controlbox"!==this.get("id")&&this.save({minimized:this.get("minimized")||!1,time_minimized:this.get("time_minimized")||c()})},maximize:function(){this.save({minimized:!1,time_opened:c().valueOf()})},minimize:function(){this.save({minimized:!0,time_minimized:c().format()})}},ChatBoxView:{events:{"click .toggle-chatbox-button":"minimize"},initialize:function(){return this.model.on("change:minimized",this.onMinimizedChanged,this),this.__super__.initialize.apply(this,arguments)},_show:function(){this.__super__._show.apply(this,arguments),this.model.get("minimized")||e.chatboxviews.trimChats(this)},shouldShowOnTextMessage:function(){return!this.model.get("minimized")&&this.__super__.shouldShowOnTextMessage.apply(this,arguments)},setChatBoxHeight:function(e){if(!this.model.get("minimized"))return this.__super__.setChatBoxHeight.apply(this,arguments)},setChatBoxWidth:function(e){if(!this.model.get("minimized"))return this.__super__.setChatBoxWidth.apply(this,arguments)},onMinimizedChanged:function(e){e.get("minimized")?this.minimize():this.maximize()},maximize:function(){return this.$el.insertAfter(e.chatboxviews.get("controlbox").$el),this.show(),e.emit("chatBoxMaximized",this),this},minimize:function(t){t&&t.preventDefault&&t.preventDefault(),this.model.save({scroll:this.$content.scrollTop()}),this.setChatState(e.INACTIVE).model.minimize(),this.hide(),e.emit("chatBoxMinimized",this)}},ChatRoomView:{events:{"click .toggle-chatbox-button":"minimize"},initialize:function(){this.model.on("change:minimized",function(e){e.get("minimized")?this.hide():this.maximize()},this);var e=this.__super__.initialize.apply(this,arguments);return this.model.get("minimized")&&this.hide(),e}},ChatBoxes:{chatBoxMayBeShown:function(e){return this.__super__.chatBoxMayBeShown.apply(this,arguments)&&!e.get("minimized")}},ChatBoxViews:{showChat:function(e){var t=this.__super__.showChat.apply(this,arguments),n=!!r.isUndefined(e.maximize)||e.maximize;return t.get("minimized")&&n&&t.maximize(),t},getChatBoxWidth:function(e){return!e.model.get("minimized")&&e.$el.is(":visible")?e.$el.outerWidth(!0):0},getShownChats:function(){return this.filter(function(e){return!e.model.get("minimized")&&!e.model.get("closed")&&e.$el.is(":visible")})},trimChats:function(t){var n=this.getShownChats();if(!(e.no_trimming||n.length<=1)&&this.getChatBoxWidth(n[0])!==a("body").outerWidth(!0)){var i,o,s,l=e.minimized_chats.$el,c=r.contains(this.model.pluck("minimized"),!0)?l.outerWidth(!0):0,d=t?t.model.get("id"):null;o=r.reduce(this.xget(d),function(e,t){return e+this.getChatBoxWidth(t)}.bind(this),t?t.$el.outerWidth(!0):0),c+o>a("body").outerWidth(!0)&&(i=this.getOldestMaximizedChat([d]),i&&(s=this.get(i.get("id")),s&&s.hide(),i.minimize()))}},getOldestMaximizedChat:function(e){e.push("controlbox");for(var t=0,n=this.model.sort().at(t);r.contains(e,n.get("id"))||n.get("minimized")===!0;)if(t++,n=this.model.at(t),!n)return null;return n}}},initialize:function(){this.updateSettings({no_trimming:!1}),e.MinimizedChatBoxView=Backbone.View.extend({tagName:"div",className:"chat-head",events:{"click .close-chatbox-button":"close","click .restore-chat":"restore"},initialize:function(){this.model.messages.on("add",function(e){e.get("message")&&this.updateUnreadMessagesCounter()},this),this.model.on("change:minimized",this.clearUnreadMessagesCounter,this),this.model.on("showReceivedOTRMessage",this.updateUnreadMessagesCounter,this),this.model.on("showSentOTRMessage",this.updateUnreadMessagesCounter,this)},render:function(){var t=r.extend(this.model.toJSON(),{tooltip:u("Click to restore this chat")});return"chatroom"===this.model.get("type")?(t.title=this.model.get("name"),this.$el.addClass("chat-head-chatroom")):(t.title=this.model.get("fullname"),this.$el.addClass("chat-head-chatbox")),this.$el.html(e.templates.trimmed_chat(t))},clearUnreadMessagesCounter:function(){this.model.set({
num_unread:0}),this.render()},updateUnreadMessagesCounter:function(){this.model.set({num_unread:this.model.get("num_unread")+1}),this.render()},close:function(t){t&&t.preventDefault&&t.preventDefault(),this.remove();var n=e.chatboxviews.get(this.model.get("id"));return n?n.close():(this.model.destroy(),e.emit("chatBoxClosed",this)),this},restore:r.debounce(function(e){e&&e.preventDefault&&e.preventDefault(),this.model.messages.off("add",null,this),this.remove(),this.model.maximize()},200,!0)}),e.MinimizedChats=Backbone.Overview.extend({tagName:"div",id:"minimized-chats",className:"hidden",events:{"click #toggle-minimized-chats":"toggle"},initialize:function(){this.render(),this.initToggle(),this.model.on("add",this.onChanged,this),this.model.on("destroy",this.removeChat,this),this.model.on("change:minimized",this.onChanged,this),this.model.on("change:num_unread",this.updateUnreadMessagesCounter,this)},tearDown:function(){return this.model.off("add",this.onChanged),this.model.off("destroy",this.removeChat),this.model.off("change:minimized",this.onChanged),this.model.off("change:num_unread",this.updateUnreadMessagesCounter),this},initToggle:function(){this.toggleview=new e.MinimizedChatsToggleView({model:new e.MinimizedChatsToggle});var t=l("converse.minchatstoggle"+e.bare_jid);this.toggleview.model.id=t,this.toggleview.model.browserStorage=new Backbone.BrowserStorage[e.storage](t),this.toggleview.model.fetch()},render:function(){return this.el.parentElement||(this.el.innerHTML=e.templates.chats_panel(),e.chatboxviews.el.appendChild(this.el)),0===this.keys().length?(this.el.classList.add("hidden"),e.chatboxviews.trimChats.bind(e.chatboxviews)):this.keys().length>0&&!this.$el.is(":visible")&&(this.el.classList.remove("hidden"),e.chatboxviews.trimChats()),this.$el},toggle:function(e){e&&e.preventDefault&&e.preventDefault(),this.toggleview.model.save({collapsed:!this.toggleview.model.get("collapsed")}),this.$(".minimized-chats-flyout").toggle()},onChanged:function(e){"controlbox"!==e.get("id")&&(e.get("minimized")?this.addChat(e):this.get(e.get("id"))&&this.removeChat(e))},addChat:function(t){var n=this.get(t.get("id"));if(!n||0===n.$el.parent().length){var i=new e.MinimizedChatBoxView({model:t});this.$(".minimized-chats-flyout").append(i.render()),this.add(t.get("id"),i),this.toggleview.model.set({num_minimized:this.keys().length}),this.render()}},removeChat:function(e){this.remove(e.get("id")),this.toggleview.model.set({num_minimized:this.keys().length}),this.render()},updateUnreadMessagesCounter:function(){var e,t=this.model.pluck("num_unread"),n=0;for(e=0;e<t.length;e++)n+=t[e];this.toggleview.model.set({num_unread:n}),this.render()}}),e.MinimizedChatsToggle=Backbone.Model.extend({initialize:function(){this.set({collapsed:this.get("collapsed")||!1,num_minimized:this.get("num_minimized")||0,num_unread:this.get("num_unread")||0})}}),e.MinimizedChatsToggleView=Backbone.View.extend({el:"#toggle-minimized-chats",initialize:function(){this.model.on("change:num_minimized",this.render,this),this.model.on("change:num_unread",this.render,this),this.$flyout=this.$el.siblings(".minimized-chats-flyout")},render:function(){return this.$el.html(e.templates.toggle_chats(r.extend(this.model.toJSON(),{Minimized:u("Minimized")}))),this.model.get("collapsed")?this.$flyout.hide():this.$flyout.show(),this.$el}});var t=function(t,n){var i=n.$el.find(".toggle-chatbox-button"),o=e.templates.chatbox_minimize(r.extend({info_minimize:u("Minimize this chat box")}));i.length?i.replaceWith(o):n.$el.find(".close-chatbox-button").after(o)};e.on("chatBoxOpened",t),e.on("chatRoomOpened",t),e.on("controlBoxOpened",function(t,n){e.connection.connected&&e.chatboxviews.trimChats(n)})}})}),function(e,t){define("converse-dragresize",["converse-core","converse-api","converse-chatview","converse-muc","converse-controlbox"],t)}(this,function(e,t){"use strict";var n=t.env.jQuery,i=t.env._;t.plugins.add("converse-dragresize",{overrides:{registerGlobalEventHandlers:function(){return n(document).on("mousemove",function(e){return!this.resizing||!this.allow_dragresize||(e.preventDefault(),void this.resizing.chatbox.resizeChatBox(e))}.bind(this)),n(document).on("mouseup",function(e){if(!this.resizing||!this.allow_dragresize)return!0;e.preventDefault();var t=this.applyDragResistance(this.resizing.chatbox.height,this.resizing.chatbox.model.get("default_height")),n=this.applyDragResistance(this.resizing.chatbox.width,this.resizing.chatbox.model.get("default_width"));this.connection.connected?(this.resizing.chatbox.model.save({height:t}),this.resizing.chatbox.model.save({width:n})):(this.resizing.chatbox.model.set({height:t}),this.resizing.chatbox.model.set({width:n})),this.resizing=null}.bind(this)),this.__super__.registerGlobalEventHandlers.apply(this,arguments)},ChatBox:{initialize:function(){var t=this.__super__.initialize.apply(this,arguments),n=this.get("height"),i=this.get("width"),o="controlbox"===this.get("id")?this.set.bind(this):this.save.bind(this);return o({height:e.applyDragResistance(n,this.get("default_height")),width:e.applyDragResistance(i,this.get("default_width"))}),t}},ChatBoxView:{events:{"mousedown .dragresize-top":"onStartVerticalResize","mousedown .dragresize-left":"onStartHorizontalResize","mousedown .dragresize-topleft":"onStartDiagonalResize"},initialize:function(){n(window).on("resize",i.debounce(this.setDimensions.bind(this),100)),this.__super__.initialize.apply(this,arguments)},render:function(){var e=this.__super__.render.apply(this,arguments);return this.setWidth(),e},setWidth:function(){this.model.get("width")&&this.$el.css("width",this.model.get("width"))},_show:function(){this.initDragResize().setDimensions(),this.__super__._show.apply(this,arguments)},initDragResize:function(){var t=this.$el.find(".box-flyout");if("undefined"==typeof this.model.get("height")){var n=t.height(),i=t.width();this.model.set("height",n),this.model.set("default_height",n),this.model.set("width",i),this.model.set("default_width",i)}var o=t.css("min-width"),s=t.css("min-height");return this.model.set("min_width",o.endsWith("px")?Number(o.replace(/px$/,"")):0),this.model.set("min_height",s.endsWith("px")?Number(s.replace(/px$/,"")):0),this.prev_pageY=0,this.prev_pageX=0,e.connection.connected&&(this.height=this.model.get("height"),this.width=this.model.get("width")),this},setDimensions:function(){this.adjustToViewport(),this.setChatBoxHeight(this.model.get("height")),this.setChatBoxWidth(this.model.get("width"))},setChatBoxHeight:function(t){t=t?e.applyDragResistance(t,this.model.get("default_height"))+"px":"",this.$el.children(".box-flyout")[0].style.height=t},setChatBoxWidth:function(t){t=t?e.applyDragResistance(t,this.model.get("default_width"))+"px":"",this.$el[0].style.width=t,this.$el.children(".box-flyout")[0].style.width=t},adjustToViewport:function(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),t=Math.max(document.documentElement.clientHeight,window.innerHeight||0);e<=480?(this.model.set("height",void 0),this.model.set("width",void 0)):e<=this.model.get("width")?this.model.set("width",void 0):t<=this.model.get("height")&&this.model.set("height",void 0)},onStartVerticalResize:function(t){return!e.allow_dragresize||(this.height=this.$el.children(".box-flyout").height(),e.resizing={chatbox:this,direction:"top"},void(this.prev_pageY=t.pageY))},onStartHorizontalResize:function(t){return!e.allow_dragresize||(this.width=this.$el.children(".box-flyout").width(),e.resizing={chatbox:this,direction:"left"},void(this.prev_pageX=t.pageX))},onStartDiagonalResize:function(t){this.onStartHorizontalResize(t),this.onStartVerticalResize(t),e.resizing.direction="topleft"},resizeChatBox:function(t){var n;0===e.resizing.direction.indexOf("top")&&(n=t.pageY-this.prev_pageY,n&&(this.height=this.height-n>(this.model.get("min_height")||0)?this.height-n:this.model.get("min_height"),this.prev_pageY=t.pageY,this.setChatBoxHeight(this.height))),e.resizing.direction.indexOf("left")!==-1&&(n=this.prev_pageX-t.pageX,n&&(this.width=this.width+n>(this.model.get("min_width")||0)?this.width+n:this.model.get("min_width"),this.prev_pageX=t.pageX,this.setChatBoxWidth(this.width)))}},ControlBoxView:{events:{"mousedown .dragresize-top":"onStartVerticalResize","mousedown .dragresize-left":"onStartHorizontalResize","mousedown .dragresize-topleft":"onStartDiagonalResize"},initialize:function(){n(window).on("resize",i.debounce(this.setDimensions.bind(this),100)),this.__super__.initialize.apply(this,arguments)},renderLoginPanel:function(){var e=this.__super__.renderLoginPanel.apply(this,arguments);return this.initDragResize().setDimensions(),e},renderContactsPanel:function(){var e=this.__super__.renderContactsPanel.apply(this,arguments);return this.initDragResize().setDimensions(),e}},ChatRoomView:{events:{"mousedown .dragresize-top":"onStartVerticalResize","mousedown .dragresize-left":"onStartHorizontalResize","mousedown .dragresize-topleft":"onStartDiagonalResize"},initialize:function(){n(window).on("resize",i.debounce(this.setDimensions.bind(this),100)),this.__super__.initialize.apply(this,arguments)},render:function(){var e=this.__super__.render.apply(this,arguments);return this.setWidth(),e}}},initialize:function(){var e=this.converse;this.updateSettings({allow_dragresize:!0}),e.applyDragResistance=function(e,t){if("undefined"!=typeof e){if("undefined"==typeof t)return e;var n=10;return e!==t&&Math.abs(e-t)<n?t:e}}}})}),function(e,t){define("converse-headline",["converse-core","converse-api","converse-chatview"],t)}(this,function(e,t){"use strict";var n=t.env.jQuery,i=t.env._,o=t.env.utils,s=o.__.bind(e),a=function(t){var i=n(t),s=i.attr("from");return o.isHeadlineMessage(t)&&(e.chatboxes.create({id:s,jid:s,fullname:s,type:"headline"}).createMessage(i,void 0,t),e.emit("message",t)),!0};t.plugins.add("converse-headline",{overrides:{ChatBoxViews:{onChatBoxAdded:function(t){var n=this.get(t.get("id"));return n||"headline"!==t.get("type")?this.__super__.onChatBoxAdded.apply(this,arguments):(n=new e.HeadlinesBoxView({model:t}),this.add(t.get("id"),n),n)}}},initialize:function(){e.HeadlinesBoxView=e.ChatBoxView.extend({className:"chatbox headlines",events:{"click .close-chatbox-button":"close","click .toggle-chatbox-button":"minimize","keypress textarea.chat-textarea":"keyPressed","mousedown .dragresize-top":"onStartVerticalResize","mousedown .dragresize-left":"onStartHorizontalResize","mousedown .dragresize-topleft":"onStartDiagonalResize"},initialize:function(){"undefined"!=typeof this.setDimensions&&n(window).on("resize",i.debounce(this.setDimensions.bind(this),100)),this.disable_mam=!0,this.model.messages.on("add",this.onMessageAdded,this),this.model.on("show",this.show,this),this.model.on("destroy",this.hide,this),this.model.on("change:minimized",this.onMinimizedChanged,this),this.render().fetchMessages().insertIntoDOM().hide(),e.emit("chatBoxInitialized",this)},render:function(){return this.$el.attr("id",this.model.get("box_id")).html(e.templates.chatbox(i.extend(this.model.toJSON(),{show_toolbar:e.show_toolbar,show_textarea:!1,title:this.model.get("fullname"),unread_msgs:s("You have unread messages"),info_close:s("Close this box"),info_minimize:s("Minimize this box"),label_personal_message:""}))),"undefined"!=typeof this.setWidth&&n(window).on("resize",i.debounce(this.setWidth.bind(this),100)),this.$content=this.$el.find(".chat-content"),e.emit("chatBoxOpened",this),o.refreshWebkit(),this}});var t=function(){e.connection.addHandler(a,null,"message")};e.on("connected",t),e.on("reconnected",t)}})}),angular.module("converse",[]).service("converse",function(){var e=new $.Deferred,t=new $.Deferred,n=new $.Deferred,i=e.promise(),o=t.promise(),s=n.promise(),a={waitUntilLoaded:_.constant(i),initialize:function(e){this.waitUntilLoaded().done(_.partial(this.api.initialize,e))},waitUntilConnected:_.constant(o),waitUntilRosterFetched:_.constant(s)};return define("converse",["converse-api","locales","converse-chatview","converse-controlbox","converse-bookmarks","converse-mam","converse-muc","converse-vcard","converse-otr","converse-register","converse-ping","converse-notification","converse-minimize","converse-dragresize","converse-headline"],function(e){return a.api=e,deferred.resolve()}),require(["converse"]),a}),require(["converse"]),define("jquery",[],function(){return jQuery}),define("jquery-private",[],function(){return jQuery}),define("jquery.browser",[],function(){return jQuery}),define("typeahead",[],function(){return jQuery}),define("underscore",[],function(){return _}),define("moment_with_locales",[],function(){return moment}),define("strophe",[],function(){return{Strophe:Strophe,$build:$build,$iq:$iq,$msg:$msg,$pres:$pres,SHA1:SHA1,Base64:Base64,MD5:MD5,b64_hmac_sha1:SHA1.b64_hmac_sha1,b64_sha1:SHA1.b64_sha1,str_hmac_sha1:SHA1.str_hmac_sha1,str_sha1:SHA1.str_sha1}});var strophePlugin=function(){return Strophe},emptyFunction=function(){};define("strophe.disco",["strophe"],strophePlugin),define("strophe.ping",["strophe"],strophePlugin),define("strophe.rsm",["strophe"],strophePlugin),define("strophe.vcard",["strophe"],strophePlugin),define("backbone",[],emptyFunction),define("backbone.browserStorage",["backbone"],emptyFunction),define("backbone.overview",["backbone"],emptyFunction),define("otr",[],function(){return{DSA:DSA,OTR:OTR}}),define("locales",[],emptyFunction);
